<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: haproxy | Evoup`s Blog]]></title>
  <link href="http://evoupsight.com/blog/categories/haproxy/atom.xml" rel="self"/>
  <link href="http://evoupsight.com/"/>
  <updated>2016-08-03T17:05:06+08:00</updated>
  <id>http://evoupsight.com/</id>
  <author>
    <name><![CDATA[Evoup`s Blog]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[用haproxy分单个端口到多个应用]]></title>
    <link href="http://evoupsight.com/blog/2013/10/31/use-haproxy-split-one-port-to-two-servers/"/>
    <updated>2013-10-31T10:57:00+08:00</updated>
    <id>http://evoupsight.com/blog/2013/10/31/use-haproxy-split-one-port-to-two-servers</id>
    <content type="html"><![CDATA[<p>今天实验了一下鼎鼎大名号称七层负载均衡的haproxy软件，果然是强得五体投地。如果要对多种协议进行负载均衡的路由到不同的server，haproxy非常合适了。</p>

<!-- more -->

<h3 id="haproxy">haproxy的安装</h3>

<p><code>bash
wget http://haproxy.1wt.eu/download/1.4/src/haproxy-1.4.24.tar.gz
tar xzf haproxy-1.4.24.tar.gz
cd haproxy-1.4.24
gmake TARGET=freebsd
sudo gmake install
</code></p>

<p>配置</p>

<p>```bash
global
    maxconn 5120
    chroot /usr/local/haproxy14
    daemon
    quiet
    nbproc 2
    pidfile /usr/local/haproxy14/run/haproxy.pid</p>

<p>defaults
    timeout connect 5s
    timeout client 50s
    timeout server 20s
    log 127.0.0.1 local3 err #日志级别[err warning info debug]</p>

<p>listen http
    bind :8080
    timeout client 1h
    tcp-request inspect-delay 2s
    acl is_http req_proto_http
    tcp-request content accept if is_http
    server server-http :8081
    use_backend tcpserver if !is_http</p>

<p>backend tcpserver
    mode tcp
    timeout server 1h
    server server-tcp :13081
```</p>

<p>实现的功能是对8080端口的socket请求，如果判断协议为http则路由到8081，如果为其他未知的tcp协议则路由到13081所在的socket服务器端口。</p>

<h3 id="section">参考链接</h3>

<p><a href="http://cbonte.github.io/haproxy-dconv/configuration-1.4.html">HAProxy Configuration Manual</a></p>
]]></content>
  </entry>
  
</feed>
