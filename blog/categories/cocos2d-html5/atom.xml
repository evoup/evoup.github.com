<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: cocos2d-html5 | Evoup`s Blog]]></title>
  <link href="http://evoupsight.com/blog/categories/cocos2d-html5/atom.xml" rel="self"/>
  <link href="http://evoupsight.com/"/>
  <updated>2014-01-24T18:21:49+08:00</updated>
  <id>http://evoupsight.com/</id>
  <author>
    <name><![CDATA[Your Name]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[cocos2d-html5-2.2.2初探]]></title>
    <link href="http://evoupsight.com/blog/2014/01/23/cocos2d-html52-dot-2-2-first-exploration/"/>
    <updated>2014-01-23T13:14:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/01/23/cocos2d-html52-dot-2-2-first-exploration</id>
    <content type="html"><![CDATA[<p>准备用最新的cocos2d-html5 2.2.2的框架作为游戏开发引擎，整个引擎还是逻辑相当清晰好理解。</p>

<p>翻了几篇官网几篇文章，发现对应的教程没有同步起来，比如说这篇：
<a href="http://www.gamefromscratch.com/post/2012/06/08/Cocos2D-HTML-Tutorial-3All-about-sprites-and-positioning.aspx">http://www.gamefromscratch.com/post/2012/06/08/Cocos2D-HTML-Tutorial-3All-about-sprites-and-positioning.aspx</a></p>

<!-- more -->


<p>其间有这么一段代码
<code>js
s.src = c.engineDir + 'platform/jsloader.js';
</code>
可以看到在cocos2d目录下没有这个文件，OMG! 淡定缓一缓神，让我们耐心点，这里教你一步一步来改写,我们首先来讲解HelloWorld：</p>

<p>首先看2.2.2的helloworld的代码分布情况：</p>

<p><img src="/images/evoup/cocos2d-html5_2.2.2_code_layout.png" alt="Alt text" /></p>

<p>其中项目必须的文件有cocos2d（cocos2d引擎）、extensions（GUI的扩展）、external（外部引擎如box2d）、lib（cocos2d基本库）。</p>

<p>接下来在根目录下仿照HelloHTML5World中的布局开始做一个项目，就叫做helloworld吧。
首先是index.html
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>index.html </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="ni">&amp;lt;</span>!DOCTYPE html&gt;
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span><span class="ni">&amp;lt;</span>meta charset=&quot;utf-8&quot;<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>title<span class="ni">&amp;gt;</span>hello cocos2d-html5<span class="ni">&amp;lt;</span>/title<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>link rel=&quot;icon&quot; type=&quot;iamge/GIF&quot; href=&quot;res/favicon.ico&quot;/<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>meta name=&quot;viewport&quot; content=&quot;user-scalable=no&quot; /<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>meta name=&quot;apple-mobile-web-app-capable&quot; content=&quot;yes&quot; /<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>meta name=&quot;full-screen&quot; content=&quot;yes&quot; /<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>meta name=&quot;screen-orientation&quot; content=&quot;portrait&quot; /<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>meta name=&quot;x5-fullscreen&quot; content=&quot;true&quot; /<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>meta name=&quot;360-fullscreen&quot; content=&quot;true&quot; /<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>style<span class="ni">&amp;gt;</span>
</span><span class='line'>    body, canvas, div {
</span><span class='line'>        -moz-user-select: none;
</span><span class='line'>        -webkit-user-select: none;
</span><span class='line'>        -ms-user-select: none;
</span><span class='line'>        -khtml-user-select: none;
</span><span class='line'>        -webkit-tap-highlight-color: rgba(0,0,0,0);
</span><span class='line'>    }
</span><span class='line'><span class="ni">&amp;lt;</span>/style<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body</span> <span class="na">style=</span><span class="s">&quot;padding:0; margin: 0; background: #000;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;canvas</span> <span class="na">id=</span><span class="s">&quot;gameCanvas&quot;</span> <span class="na">width=</span><span class="s">&quot;800&quot;</span> <span class="na">height=</span><span class="s">&quot;450&quot;</span><span class="nt">&gt;&lt;/canvas&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;cocos2d.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>解释:</h4>

<p><code>html
&lt;meta name="viewport" content="user-scalable=no" /&gt;
</code></p>

<p>viewport这个是移动端的meta设置，content设置为user-scalable=no代表在移动设备上 不可缩放。</p>

<p><code>html
&lt;meta name="apple-mobile-web-app-capable" content="yes" /&gt;
</code></p>

<p>apple-mobile-web-app-capable这个是移动端的参数，全屏模式下content设置为yes，否则不用设置。可以通过window.navigator.standalone属性来得知是否网页是否处于全屏模式。</p>

<p><code>html
&lt;meta name="full-screen" content="yes" /&gt;
</code></p>

<p>这个是给某些浏览器的全屏设置，比如说ucweb</p>

<p><code>html
&lt;meta name="screen-orientation" content="portrait" /&gt;
</code>
screen-orientation这个meta参数代表移动端的屏幕朝向，有2个portrait和landscape，分别代表竖向和横向,这portrait是竖向了。</p>

<p><code>html
&lt;meta name="x5-fullscreen" content="true" /&gt;
</code>
这个是腾讯qq浏览器的全屏</p>

<p><code>html
&lt;meta name="360-fullscreen" content="true" /&gt;
</code>
360浏览器的全屏</p>

<p>```html</p>



<p>```
其中-moz-user-select、-webkit-user-select、-ms-user-select和-khtml-user-select都取值none，代表文字都不选中。而-webkit-tap-highlight-color: rgba(0,0,0,0);其中rgba的最后一个参数0代表点击一个链接或者通过JavaScript定义可点击元素的时候禁止出现灰色背景。
最后从同域引入cocos2d.js。</p>

<hr />

<p>接着创建第二个文件cocos2d.js
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>cocos2d.js </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nb">document</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">COCOS2D_DEBUG</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="c1">//0 to turn debug off, 1 for basic debug, and 2 for full debug</span>
</span><span class='line'>    <span class="nx">box2d</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">chipmunk</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">showFPS</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">frameRate</span><span class="o">:</span><span class="mi">60</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">loadExtension</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">renderMode</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>       <span class="c1">//Choose of RenderMode: 0(default), 1(Canvas only), 2(WebGL only)</span>
</span><span class='line'>    <span class="nx">tag</span><span class="o">:</span><span class="s1">&#39;gameCanvas&#39;</span><span class="p">,</span> <span class="c1">//the dom element to run cocos2d on</span>
</span><span class='line'>    <span class="nx">engineDir</span><span class="o">:</span><span class="s1">&#39;../cocos2d/&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c1">//SingleEngineFile:&#39;&#39;,</span>
</span><span class='line'>    <span class="nx">appFiles</span><span class="o">:</span><span class="p">[</span>
</span><span class='line'>        <span class="s1">&#39;src/resource.js&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;src/myApp.js&#39;</span><span class="c1">//add your own files in order here</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">).</span><span class="nx">getContext</span><span class="p">){</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">s</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&amp;lt;h2&amp;gt;Your browser does not support HTML5 canvas!&amp;lt;/h2&amp;gt;&#39;</span> <span class="o">+</span>
</span><span class='line'>        <span class="s1">&#39;&amp;lt;p&amp;gt;Google Chrome is a browser that combines a minimal design with sophisticated technology to make the web faster, safer, and easier.Click the logo to download.&amp;lt;/p&amp;gt;&#39;</span> <span class="o">+</span>
</span><span class='line'>        <span class="s1">&#39;&amp;lt;a href=&quot;http://www.google.com/chrome&quot; target=&quot;_blank&quot;&amp;gt;&amp;lt;img src=&quot;http://www.google.com/intl/zh-CN/chrome/assets/common/images/chrome_logo_2x.png&quot; border=&quot;0&quot;/&amp;gt;&amp;lt;/a&amp;gt;&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">tag</span><span class="p">).</span><span class="nx">parentNode</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">p</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">p</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">border</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">p</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">tag</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">d</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//first load engine file if specified</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="cm">/*********Delete this section if you have packed all files into one*******/</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">SingleEngineFile</span> <span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span> <span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">engineDir</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">s</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">SingleEngineFile</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">engineDir</span> <span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span> <span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">SingleEngineFile</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">s</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">engineDir</span> <span class="o">+</span> <span class="s1">&#39;jsloader.js&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;You must specify either the single engine file OR the engine directory in &quot;cocos2d.js&quot;&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="cm">/*********Delete this section if you have packed all files into one*******/</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//s.src = &#39;Packed_Release_File.js&#39;; //IMPORTANT: Un-comment this line if you have packed all files into one</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">document</span><span class="p">.</span><span class="nx">ccConfig</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">s</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;cocos2d-html5&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">d</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//else if single file specified, load singlefile</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">})();</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h4>解释:</h4>

<p>这整个就是一个匿名函数,然后调用的写法。</p>

<p>首先创建一个局部变量d，赋值为document
<code>js
var d = document;
</code></p>

<p>然后创建一个c对象，提供全部配置信息
```js
var c = {</p>

<pre><code>COCOS2D_DEBUG:2, //0 to turn debug off, 1 for basic debug, and 2 for full debug
box2d:false,
chipmunk:false,
showFPS:true,
frameRate:60,
loadExtension:false,
renderMode:0,       //Choose of RenderMode: 0(default), 1(Canvas only), 2(WebGL only)
tag:'gameCanvas', //the dom element to run cocos2d on
engineDir:'../cocos2d/',
//SingleEngineFile:'',
appFiles:[
    'src/resource.js',
    'src/myApp.js'//add your own files in order here
]
</code></pre>

<p>};
```</p>

<p>其中:
COCOS2D_DEBUG为调试等级（0关闭，1基本，2完全）；
box2d为是否采用box2d物理引擎，这里不使用设置为no；
chipmunk为一款物理引擎，同样不使用；
showFPS是否显示FPS，是；
loadExtension是否加载扩展，否；
renderMode渲染，0为默认，1为仅Canvas方式，2为仅WebGL方式;
tag为运行cocos2d的dom元素;
engineDir为cocos2d的引擎目录;
appFiles为一个列表，目前存2个文件的地址，src/resource.js和src/myApp.js;</p>

<p>下面这段为html5探测代码，如果探测失败，会出出现一个google的chrome浏览器的logo
```js
if(!d.createElement(&lsquo;canvas&rsquo;).getContext){</p>

<pre><code>var s = d.createElement('div');
s.innerHTML = '&lt;h2&gt;Your browser does not support HTML5 canvas!&lt;/h2&gt;' +
    '&lt;p&gt;Google Chrome is a browser that combines a minimal design with sophisticated technology to make the web faster, safer, and easier.Click the logo to download.&lt;/p&gt;' +
    '&lt;a href="http://www.google.com/chrome" target="_blank"&gt;&lt;img src="http://www.google.com/intl/zh-CN/chrome/assets/common/images/chrome_logo_2x.png" border="0"/&gt;&lt;/a&gt;';
var p = d.getElementById(c.tag).parentNode;
p.style.background = 'none';
p.style.border = 'none';
p.insertBefore(s,d.getElementById(c.tag));

d.body.style.background = '#ffffff';
return;
</code></pre>

<p>}
```</p>

<p>再看下一段
```js
window.addEventListener(&lsquo;DOMContentLoaded&rsquo;, function () {</p>

<pre><code>this.removeEventListener('DOMContentLoaded', arguments.callee, false);
//first load engine file if specified
var s = d.createElement('script');
/*********Delete this section if you have packed all files into one*******/
if (c.SingleEngineFile &amp;&amp; !c.engineDir) {
s.src = c.SingleEngineFile;
}
else if (c.engineDir &amp;&amp; !c.SingleEngineFile) {
s.src = c.engineDir + 'jsloader.js';
}
else {
alert('You must specify either the single engine file OR the engine directory in "cocos2d.js"');
}
/*********Delete this section if you have packed all files into one*******/

//s.src = 'Packed_Release_File.js'; //IMPORTANT: Un-comment this line if you have packed all files into one

document.ccConfig = c;
s.id = 'cocos2d-html5';
d.body.appendChild(s);
//else if single file specified, load singlefile
</code></pre>

<p>});
```</p>

<p>这段创建了DOMContentLoaded事件侦听器，干掉全部DOM对象。SingleEngineFile这个参数是如果要把cocos2d这个文件夹下的引擎程序打包成一个文件，则需要指定这个文件的路径。指定好了引擎路径engineDir为../cocos2d这个文件夹，然后加载jsloader.js,然后把配置文件存到document.ccConfig元素中去。
接着把cocos2d-html5这个id赋到创建到script标签上，然后加载到body标签中。</p>

<hr />

<p>接着创建主程序文件main.js,注意这还不是实现逻辑，而是cocos2d-html5初始化的套路。</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>main.js </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">cocos2dApp</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="nx">config</span><span class="o">:</span><span class="nb">document</span><span class="p">[</span><span class="s1">&#39;ccConfig&#39;</span><span class="p">],</span>
</span><span class='line'><span class="nx">ctor</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">scene</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">startScene</span> <span class="o">=</span> <span class="nx">scene</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">cc</span><span class="p">.</span><span class="nx">COCOS2D_DEBUG</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">[</span><span class="s1">&#39;COCOS2D_DEBUG&#39;</span><span class="p">];</span>
</span><span class='line'>    <span class="nx">cc</span><span class="p">.</span><span class="nx">initDebugSetting</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">cc</span><span class="p">.</span><span class="nx">setup</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]);</span>
</span><span class='line'>    <span class="nx">cc</span><span class="p">.</span><span class="nx">AppController</span><span class="p">.</span><span class="nx">shareAppController</span><span class="p">().</span><span class="nx">didFinishLaunchingWithOptions</span><span class="p">();</span>
</span><span class='line'><span class="p">},</span>
</span><span class='line'><span class="nx">applicationDidFinishLaunching</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">RenderDoesnotSupport</span><span class="p">()){</span>
</span><span class='line'>        <span class="c1">//show Information to user</span>
</span><span class='line'>        <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Browser doesn&#39;t support WebGL&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">// initialize director</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">director</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Director</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">cc</span><span class="p">.</span><span class="nx">EGLView</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">resizeWithBrowserSize</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">cc</span><span class="p">.</span><span class="nx">EGLView</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">setDesignResolutionSize</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">RESOLUTION_POLICY</span><span class="p">.</span><span class="nx">SHOW_ALL</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// turn on display FPS</span>
</span><span class='line'>    <span class="nx">director</span><span class="p">.</span><span class="nx">setDisplayStats</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">[</span><span class="s1">&#39;showFPS&#39;</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// set FPS. the default value is 1.0/60 if you don&#39;t call this</span>
</span><span class='line'>    <span class="nx">director</span><span class="p">.</span><span class="nx">setAnimationInterval</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">[</span><span class="s1">&#39;frameRate&#39;</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//load resources</span>
</span><span class='line'>    <span class="nx">cc</span><span class="p">.</span><span class="nx">LoaderScene</span><span class="p">.</span><span class="nx">preload</span><span class="p">(</span><span class="nx">g_resources</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">director</span><span class="p">.</span><span class="nx">replaceScene</span><span class="p">(</span><span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">startScene</span><span class="p">());</span>
</span><span class='line'>    <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">});</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myApp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cocos2dApp</span><span class="p">(</span><span class="nx">HelloWorldScene</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>主要的功能都在cc.Application.extend中实现。首先config配置参数为document[&lsquo;ccConfig&rsquo;]
然后看ctor：（顾名思义：config to run 配置转为启动）以scene为参数的匿名函数，先调用_super()方法这个引擎方法进行初始化，然后指定startScene开始场景为scene。调试等级cc.COCOS2D_DEBUG为cocos2d.js中指定的调试等级，cc.initDebugSetting为初始化调试设置，cc.setup(this.config[&lsquo;tag&rsquo;])在名为tag的dom对象上创建cavas,cc.AppController.shareAppController().didFinishLaunchingWithOptions();这个是仿照cocos2d-iphone的函数命名的启动函数（顾名思义：就是启动结束会加载的函数）。</p>

<p>在正式进入写代码之前，稍等再看一下applicationDidFinishLaunching这个函数</p>

<p>先检查渲染是否支持，不支持就弹出“Browser doesn`t support WebGL”</p>

<p>```javascript
if(cc.RenderDoesnotSupport()){</p>

<pre><code>//show Information to user
alert("Browser doesn't support WebGL");
return false;
</code></pre>

<p>}
```</p>

<p>初始化director
<code>javascript
// initialize director
var director = cc.Director.getInstance();
</code></p>

<p>重置浏览器大小
<code>javascript
cc.EGLView.getInstance().resizeWithBrowserSize(true);
cc.EGLView.getInstance().setDesignResolutionSize(800, 450, cc.RESOLUTION_POLICY.SHOW_ALL);
</code>
打开显卡FPS
<code>javascript
// turn on display FPS
director.setDisplayStats(this.config['showFPS']);
</code></p>
]]></content>
  </entry>
  
</feed>
