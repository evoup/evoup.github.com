<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>基于netsnmp的agent开发 - Evoup`s Blog</title>
  <meta name="author" content="Evoup`s Blog">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://evoupsight.com/blog/2014/08/03/netsnmp-daemon-dev">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Evoup`s Blog" type="application/atom+xml">

  <link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">


  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>
  

</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Evoup`s Blog</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
                <li >
                    <a href="/blog/opensource">开源项目</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="http://google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:evoupsight.com">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <article class="hentry" role="article">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-08-03T17:59:00+08:00" pubdate data-updated="true">Aug 3<span>rd</span>, 2014</time>
        
      </p>
    
    
    <h1 class="entry-title">
        基于netsnmp的agent开发
        
    </h1>
    
  </header>


<div class="entry-content clearfix"><p>防止遗忘，实现一个snmp agent，基于ucd-netsnmp，可以无需netsnmp单独运行，加了点获取其他信息的代码。</p>

<!-- more -->


<p>struct.h</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#ifndef UCD_SNMP_STRUCT</span>
</span><span class='line'><span class="cp">#define UCD_SNMP_STRUCT</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define STRMAX 1024</span>
</span><span class='line'><span class="cp">#define SHPROC 1</span>
</span><span class='line'><span class="cp">#define EXECPROC 2</span>
</span><span class='line'><span class="cp">#define PASSTHRU 3</span>
</span><span class='line'><span class="cp">#define PASSTHRU_PERSIST 4</span>
</span><span class='line'><span class="cp">#define MIBMAX 30</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">extensible</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">char</span>            <span class="n">name</span><span class="p">[</span><span class="n">STRMAX</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">char</span>            <span class="n">command</span><span class="p">[</span><span class="n">STRMAX</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">char</span>            <span class="n">fixcmd</span><span class="p">[</span><span class="n">STRMAX</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">int</span>             <span class="n">type</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span>             <span class="n">result</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">char</span>            <span class="n">output</span><span class="p">[</span><span class="n">STRMAX</span><span class="p">];</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">extensible</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">long</span>   <span class="n">miboid</span><span class="p">[</span><span class="n">MIBMAX</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">size_t</span>          <span class="n">miblen</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span>             <span class="n">pid</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">struct</span> <span class="n">myproc</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">char</span>            <span class="n">name</span><span class="p">[</span><span class="n">STRMAX</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">char</span>            <span class="n">fixcmd</span><span class="p">[</span><span class="n">STRMAX</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">int</span>             <span class="n">min</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span>             <span class="n">max</span><span class="p">;</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">myproc</span>  <span class="o">*</span><span class="n">next</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * struct mibinfo </span>
</span><span class='line'><span class="cm"> * {</span>
</span><span class='line'><span class="cm"> * int numid;</span>
</span><span class='line'><span class="cm"> * unsigned long mibid[10];</span>
</span><span class='line'><span class="cm"> * char *name;</span>
</span><span class='line'><span class="cm"> * void (*handle) ();</span>
</span><span class='line'><span class="cm"> * };</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#endif</span>
</span></code></pre></td></tr></table></div></figure>


<p>example.h</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> *  Template MIB group interface - example.h</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * Don&#39;t include ourselves twice </span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="cp">#ifndef _MIBGROUP_EXAMPLE_H</span>
</span><span class='line'><span class="cp">#define _MIBGROUP_EXAMPLE_H</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#ifdef __cplusplus</span>
</span><span class='line'><span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="p">{</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * We use &#39;header_generic&#39; from the util_funcs module,</span>
</span><span class='line'><span class="cm">     *  so make sure this module is included in the agent.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'><span class="n">config_require</span><span class="p">(</span><span class="n">util_funcs</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * Declare our publically-visible functions.</span>
</span><span class='line'><span class="cm">     * Typically, these will include the initialization and shutdown functions,</span>
</span><span class='line'><span class="cm">     *  the main request callback routine and any writeable object methods.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * Function prototypes are provided for the callback routine (&#39;FindVarMethod&#39;)</span>
</span><span class='line'><span class="cm">     *  and writeable object methods (&#39;WriteMethod&#39;).</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>     <span class="kt">void</span>     <span class="n">init_example</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span><span class='line'>     <span class="n">FindVarMethod</span> <span class="n">var_example</span><span class="p">;</span>
</span><span class='line'>     <span class="n">WriteMethod</span> <span class="n">write_exampleint</span><span class="p">;</span>
</span><span class='line'>     <span class="n">WriteMethod</span> <span class="n">write_exampletrap</span><span class="p">;</span>
</span><span class='line'>     <span class="n">WriteMethod</span> <span class="n">write_exampletrap2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * Magic number definitions.</span>
</span><span class='line'><span class="cm">     * These must be unique for each object implemented within a</span>
</span><span class='line'><span class="cm">     *  single mib module callback routine.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * Typically, these will be the last OID sub-component for</span>
</span><span class='line'><span class="cm">     *  each entry, or integers incrementing from 1.</span>
</span><span class='line'><span class="cm">     *  (which may well result in the same values anyway).</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * Here, the second and third objects are form a &#39;sub-table&#39; and</span>
</span><span class='line'><span class="cm">     *   the magic numbers are chosen to match these OID sub-components.</span>
</span><span class='line'><span class="cm">     * This is purely for programmer convenience.</span>
</span><span class='line'><span class="cm">     * All that really matters is that the numbers are unique.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define  EXAMPLESTRING       1</span>
</span><span class='line'><span class="cp">#define EXAMPLEINTEGER       21</span>
</span><span class='line'><span class="cp">#define  EXAMPLEOBJECTID         22</span>
</span><span class='line'><span class="cp">#define EXAMPLETIMETICKS 3</span>
</span><span class='line'><span class="cp">#define  EXAMPLEIPADDRESS        4</span>
</span><span class='line'><span class="cp">#define EXAMPLECOUNTER       5</span>
</span><span class='line'><span class="cp">#define  EXAMPLEGAUGE            6</span>
</span><span class='line'><span class="cp">#define  EXAMPLETRIGGERTRAP      7</span>
</span><span class='line'><span class="cp">#define  EXAMPLETRIGGERTRAP2     8</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#ifdef __cplusplus</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#endif                          </span><span class="cm">/* _MIBGROUP_EXAMPLE_H */</span><span class="cp"></span>
</span></code></pre></td></tr></table></div></figure>


<p>example.c</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
<span class='line-number'>317</span>
<span class='line-number'>318</span>
<span class='line-number'>319</span>
<span class='line-number'>320</span>
<span class='line-number'>321</span>
<span class='line-number'>322</span>
<span class='line-number'>323</span>
<span class='line-number'>324</span>
<span class='line-number'>325</span>
<span class='line-number'>326</span>
<span class='line-number'>327</span>
<span class='line-number'>328</span>
<span class='line-number'>329</span>
<span class='line-number'>330</span>
<span class='line-number'>331</span>
<span class='line-number'>332</span>
<span class='line-number'>333</span>
<span class='line-number'>334</span>
<span class='line-number'>335</span>
<span class='line-number'>336</span>
<span class='line-number'>337</span>
<span class='line-number'>338</span>
<span class='line-number'>339</span>
<span class='line-number'>340</span>
<span class='line-number'>341</span>
<span class='line-number'>342</span>
<span class='line-number'>343</span>
<span class='line-number'>344</span>
<span class='line-number'>345</span>
<span class='line-number'>346</span>
<span class='line-number'>347</span>
<span class='line-number'>348</span>
<span class='line-number'>349</span>
<span class='line-number'>350</span>
<span class='line-number'>351</span>
<span class='line-number'>352</span>
<span class='line-number'>353</span>
<span class='line-number'>354</span>
<span class='line-number'>355</span>
<span class='line-number'>356</span>
<span class='line-number'>357</span>
<span class='line-number'>358</span>
<span class='line-number'>359</span>
<span class='line-number'>360</span>
<span class='line-number'>361</span>
<span class='line-number'>362</span>
<span class='line-number'>363</span>
<span class='line-number'>364</span>
<span class='line-number'>365</span>
<span class='line-number'>366</span>
<span class='line-number'>367</span>
<span class='line-number'>368</span>
<span class='line-number'>369</span>
<span class='line-number'>370</span>
<span class='line-number'>371</span>
<span class='line-number'>372</span>
<span class='line-number'>373</span>
<span class='line-number'>374</span>
<span class='line-number'>375</span>
<span class='line-number'>376</span>
<span class='line-number'>377</span>
<span class='line-number'>378</span>
<span class='line-number'>379</span>
<span class='line-number'>380</span>
<span class='line-number'>381</span>
<span class='line-number'>382</span>
<span class='line-number'>383</span>
<span class='line-number'>384</span>
<span class='line-number'>385</span>
<span class='line-number'>386</span>
<span class='line-number'>387</span>
<span class='line-number'>388</span>
<span class='line-number'>389</span>
<span class='line-number'>390</span>
<span class='line-number'>391</span>
<span class='line-number'>392</span>
<span class='line-number'>393</span>
<span class='line-number'>394</span>
<span class='line-number'>395</span>
<span class='line-number'>396</span>
<span class='line-number'>397</span>
<span class='line-number'>398</span>
<span class='line-number'>399</span>
<span class='line-number'>400</span>
<span class='line-number'>401</span>
<span class='line-number'>402</span>
<span class='line-number'>403</span>
<span class='line-number'>404</span>
<span class='line-number'>405</span>
<span class='line-number'>406</span>
<span class='line-number'>407</span>
<span class='line-number'>408</span>
<span class='line-number'>409</span>
<span class='line-number'>410</span>
<span class='line-number'>411</span>
<span class='line-number'>412</span>
<span class='line-number'>413</span>
<span class='line-number'>414</span>
<span class='line-number'>415</span>
<span class='line-number'>416</span>
<span class='line-number'>417</span>
<span class='line-number'>418</span>
<span class='line-number'>419</span>
<span class='line-number'>420</span>
<span class='line-number'>421</span>
<span class='line-number'>422</span>
<span class='line-number'>423</span>
<span class='line-number'>424</span>
<span class='line-number'>425</span>
<span class='line-number'>426</span>
<span class='line-number'>427</span>
<span class='line-number'>428</span>
<span class='line-number'>429</span>
<span class='line-number'>430</span>
<span class='line-number'>431</span>
<span class='line-number'>432</span>
<span class='line-number'>433</span>
<span class='line-number'>434</span>
<span class='line-number'>435</span>
<span class='line-number'>436</span>
<span class='line-number'>437</span>
<span class='line-number'>438</span>
<span class='line-number'>439</span>
<span class='line-number'>440</span>
<span class='line-number'>441</span>
<span class='line-number'>442</span>
<span class='line-number'>443</span>
<span class='line-number'>444</span>
<span class='line-number'>445</span>
<span class='line-number'>446</span>
<span class='line-number'>447</span>
<span class='line-number'>448</span>
<span class='line-number'>449</span>
<span class='line-number'>450</span>
<span class='line-number'>451</span>
<span class='line-number'>452</span>
<span class='line-number'>453</span>
<span class='line-number'>454</span>
<span class='line-number'>455</span>
<span class='line-number'>456</span>
<span class='line-number'>457</span>
<span class='line-number'>458</span>
<span class='line-number'>459</span>
<span class='line-number'>460</span>
<span class='line-number'>461</span>
<span class='line-number'>462</span>
<span class='line-number'>463</span>
<span class='line-number'>464</span>
<span class='line-number'>465</span>
<span class='line-number'>466</span>
<span class='line-number'>467</span>
<span class='line-number'>468</span>
<span class='line-number'>469</span>
<span class='line-number'>470</span>
<span class='line-number'>471</span>
<span class='line-number'>472</span>
<span class='line-number'>473</span>
<span class='line-number'>474</span>
<span class='line-number'>475</span>
<span class='line-number'>476</span>
<span class='line-number'>477</span>
<span class='line-number'>478</span>
<span class='line-number'>479</span>
<span class='line-number'>480</span>
<span class='line-number'>481</span>
<span class='line-number'>482</span>
<span class='line-number'>483</span>
<span class='line-number'>484</span>
<span class='line-number'>485</span>
<span class='line-number'>486</span>
<span class='line-number'>487</span>
<span class='line-number'>488</span>
<span class='line-number'>489</span>
<span class='line-number'>490</span>
<span class='line-number'>491</span>
<span class='line-number'>492</span>
<span class='line-number'>493</span>
<span class='line-number'>494</span>
<span class='line-number'>495</span>
<span class='line-number'>496</span>
<span class='line-number'>497</span>
<span class='line-number'>498</span>
<span class='line-number'>499</span>
<span class='line-number'>500</span>
<span class='line-number'>501</span>
<span class='line-number'>502</span>
<span class='line-number'>503</span>
<span class='line-number'>504</span>
<span class='line-number'>505</span>
<span class='line-number'>506</span>
<span class='line-number'>507</span>
<span class='line-number'>508</span>
<span class='line-number'>509</span>
<span class='line-number'>510</span>
<span class='line-number'>511</span>
<span class='line-number'>512</span>
<span class='line-number'>513</span>
<span class='line-number'>514</span>
<span class='line-number'>515</span>
<span class='line-number'>516</span>
<span class='line-number'>517</span>
<span class='line-number'>518</span>
<span class='line-number'>519</span>
<span class='line-number'>520</span>
<span class='line-number'>521</span>
<span class='line-number'>522</span>
<span class='line-number'>523</span>
<span class='line-number'>524</span>
<span class='line-number'>525</span>
<span class='line-number'>526</span>
<span class='line-number'>527</span>
<span class='line-number'>528</span>
<span class='line-number'>529</span>
<span class='line-number'>530</span>
<span class='line-number'>531</span>
<span class='line-number'>532</span>
<span class='line-number'>533</span>
<span class='line-number'>534</span>
<span class='line-number'>535</span>
<span class='line-number'>536</span>
<span class='line-number'>537</span>
<span class='line-number'>538</span>
<span class='line-number'>539</span>
<span class='line-number'>540</span>
<span class='line-number'>541</span>
<span class='line-number'>542</span>
<span class='line-number'>543</span>
<span class='line-number'>544</span>
<span class='line-number'>545</span>
<span class='line-number'>546</span>
<span class='line-number'>547</span>
<span class='line-number'>548</span>
<span class='line-number'>549</span>
<span class='line-number'>550</span>
<span class='line-number'>551</span>
<span class='line-number'>552</span>
<span class='line-number'>553</span>
<span class='line-number'>554</span>
<span class='line-number'>555</span>
<span class='line-number'>556</span>
<span class='line-number'>557</span>
<span class='line-number'>558</span>
<span class='line-number'>559</span>
<span class='line-number'>560</span>
<span class='line-number'>561</span>
<span class='line-number'>562</span>
<span class='line-number'>563</span>
<span class='line-number'>564</span>
<span class='line-number'>565</span>
<span class='line-number'>566</span>
<span class='line-number'>567</span>
<span class='line-number'>568</span>
<span class='line-number'>569</span>
<span class='line-number'>570</span>
<span class='line-number'>571</span>
<span class='line-number'>572</span>
<span class='line-number'>573</span>
<span class='line-number'>574</span>
<span class='line-number'>575</span>
<span class='line-number'>576</span>
<span class='line-number'>577</span>
<span class='line-number'>578</span>
<span class='line-number'>579</span>
<span class='line-number'>580</span>
<span class='line-number'>581</span>
<span class='line-number'>582</span>
<span class='line-number'>583</span>
<span class='line-number'>584</span>
<span class='line-number'>585</span>
<span class='line-number'>586</span>
<span class='line-number'>587</span>
<span class='line-number'>588</span>
<span class='line-number'>589</span>
<span class='line-number'>590</span>
<span class='line-number'>591</span>
<span class='line-number'>592</span>
<span class='line-number'>593</span>
<span class='line-number'>594</span>
<span class='line-number'>595</span>
<span class='line-number'>596</span>
<span class='line-number'>597</span>
<span class='line-number'>598</span>
<span class='line-number'>599</span>
<span class='line-number'>600</span>
<span class='line-number'>601</span>
<span class='line-number'>602</span>
<span class='line-number'>603</span>
<span class='line-number'>604</span>
<span class='line-number'>605</span>
<span class='line-number'>606</span>
<span class='line-number'>607</span>
<span class='line-number'>608</span>
<span class='line-number'>609</span>
<span class='line-number'>610</span>
<span class='line-number'>611</span>
<span class='line-number'>612</span>
<span class='line-number'>613</span>
<span class='line-number'>614</span>
<span class='line-number'>615</span>
<span class='line-number'>616</span>
<span class='line-number'>617</span>
<span class='line-number'>618</span>
<span class='line-number'>619</span>
<span class='line-number'>620</span>
<span class='line-number'>621</span>
<span class='line-number'>622</span>
<span class='line-number'>623</span>
<span class='line-number'>624</span>
<span class='line-number'>625</span>
<span class='line-number'>626</span>
<span class='line-number'>627</span>
<span class='line-number'>628</span>
<span class='line-number'>629</span>
<span class='line-number'>630</span>
<span class='line-number'>631</span>
<span class='line-number'>632</span>
<span class='line-number'>633</span>
<span class='line-number'>634</span>
<span class='line-number'>635</span>
<span class='line-number'>636</span>
<span class='line-number'>637</span>
<span class='line-number'>638</span>
<span class='line-number'>639</span>
<span class='line-number'>640</span>
<span class='line-number'>641</span>
<span class='line-number'>642</span>
<span class='line-number'>643</span>
<span class='line-number'>644</span>
<span class='line-number'>645</span>
<span class='line-number'>646</span>
<span class='line-number'>647</span>
<span class='line-number'>648</span>
<span class='line-number'>649</span>
<span class='line-number'>650</span>
<span class='line-number'>651</span>
<span class='line-number'>652</span>
<span class='line-number'>653</span>
<span class='line-number'>654</span>
<span class='line-number'>655</span>
<span class='line-number'>656</span>
<span class='line-number'>657</span>
<span class='line-number'>658</span>
<span class='line-number'>659</span>
<span class='line-number'>660</span>
<span class='line-number'>661</span>
<span class='line-number'>662</span>
<span class='line-number'>663</span>
<span class='line-number'>664</span>
<span class='line-number'>665</span>
<span class='line-number'>666</span>
<span class='line-number'>667</span>
<span class='line-number'>668</span>
<span class='line-number'>669</span>
<span class='line-number'>670</span>
<span class='line-number'>671</span>
<span class='line-number'>672</span>
<span class='line-number'>673</span>
<span class='line-number'>674</span>
<span class='line-number'>675</span>
<span class='line-number'>676</span>
<span class='line-number'>677</span>
<span class='line-number'>678</span>
<span class='line-number'>679</span>
<span class='line-number'>680</span>
<span class='line-number'>681</span>
<span class='line-number'>682</span>
<span class='line-number'>683</span>
<span class='line-number'>684</span>
<span class='line-number'>685</span>
<span class='line-number'>686</span>
<span class='line-number'>687</span>
<span class='line-number'>688</span>
<span class='line-number'>689</span>
<span class='line-number'>690</span>
<span class='line-number'>691</span>
<span class='line-number'>692</span>
<span class='line-number'>693</span>
<span class='line-number'>694</span>
<span class='line-number'>695</span>
<span class='line-number'>696</span>
<span class='line-number'>697</span>
<span class='line-number'>698</span>
<span class='line-number'>699</span>
<span class='line-number'>700</span>
<span class='line-number'>701</span>
<span class='line-number'>702</span>
<span class='line-number'>703</span>
<span class='line-number'>704</span>
<span class='line-number'>705</span>
<span class='line-number'>706</span>
<span class='line-number'>707</span>
<span class='line-number'>708</span>
<span class='line-number'>709</span>
<span class='line-number'>710</span>
<span class='line-number'>711</span>
<span class='line-number'>712</span>
<span class='line-number'>713</span>
<span class='line-number'>714</span>
<span class='line-number'>715</span>
<span class='line-number'>716</span>
<span class='line-number'>717</span>
<span class='line-number'>718</span>
<span class='line-number'>719</span>
<span class='line-number'>720</span>
<span class='line-number'>721</span>
<span class='line-number'>722</span>
<span class='line-number'>723</span>
<span class='line-number'>724</span>
<span class='line-number'>725</span>
<span class='line-number'>726</span>
<span class='line-number'>727</span>
<span class='line-number'>728</span>
<span class='line-number'>729</span>
<span class='line-number'>730</span>
<span class='line-number'>731</span>
<span class='line-number'>732</span>
<span class='line-number'>733</span>
<span class='line-number'>734</span>
<span class='line-number'>735</span>
<span class='line-number'>736</span>
<span class='line-number'>737</span>
<span class='line-number'>738</span>
<span class='line-number'>739</span>
<span class='line-number'>740</span>
<span class='line-number'>741</span>
<span class='line-number'>742</span>
<span class='line-number'>743</span>
<span class='line-number'>744</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> *  Template MIB group implementation - example.c</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * include important headers </span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="cp">#include &lt;net-snmp/net-snmp-config.h&gt;</span>
</span><span class='line'><span class="cp">#if HAVE_STDLIB_H</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'><span class="cp">#if HAVE_STRING_H</span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;</span>
</span><span class='line'><span class="cp">#else</span>
</span><span class='line'><span class="cp">#include &lt;strings.h&gt;</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * needed by util_funcs.h </span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="cp">#if TIME_WITH_SYS_TIME</span>
</span><span class='line'><span class="cp"># ifdef WIN32</span>
</span><span class='line'><span class="cp">#  include &lt;sys/timeb.h&gt;</span>
</span><span class='line'><span class="cp"># else</span>
</span><span class='line'><span class="cp">#  include &lt;sys/time.h&gt;</span>
</span><span class='line'><span class="cp"># endif</span>
</span><span class='line'><span class="cp"># include &lt;time.h&gt;</span>
</span><span class='line'><span class="cp">#else</span>
</span><span class='line'><span class="cp"># if HAVE_SYS_TIME_H</span>
</span><span class='line'><span class="cp">#  include &lt;sys/time.h&gt;</span>
</span><span class='line'><span class="cp"># else</span>
</span><span class='line'><span class="cp">#  include &lt;time.h&gt;</span>
</span><span class='line'><span class="cp"># endif</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#if HAVE_WINSOCK_H</span>
</span><span class='line'><span class="cp">#include &lt;winsock.h&gt;</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'><span class="cp">#if HAVE_NETINET_IN_H</span>
</span><span class='line'><span class="cp">#include &lt;netinet/in.h&gt;</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;net-snmp/net-snmp-includes.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;net-snmp/agent/net-snmp-agent-includes.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * header_generic() comes from here </span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="cp">#include &quot;/usr/include/net-snmp/agent/util_funcs.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * include our .h file </span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="cp">#include &quot;example.h&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>   <span class="cm">/*</span>
</span><span class='line'><span class="cm">    *  Certain objects can be set via configuration file directives.</span>
</span><span class='line'><span class="cm">    *  These variables hold the values for such objects, as they need to</span>
</span><span class='line'><span class="cm">    *   be accessible to both the config handlers, and the callback routine.</span>
</span><span class='line'><span class="cm">    */</span>
</span><span class='line'><span class="cp">#define EXAMPLE_STR_LEN  300</span>
</span><span class='line'><span class="cp">#define EXAMPLE_STR_DEFAULT  &quot;life the universe and everything&quot;</span>
</span><span class='line'><span class="kt">int</span>             <span class="n">example_int</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span><span class='line'><span class="kt">char</span>            <span class="n">example_str</span><span class="p">[</span><span class="n">EXAMPLE_STR_LEN</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * Forward declarations for the config handlers </span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'><span class="kt">void</span>            <span class="nf">example_parse_config_exampleint</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">token</span><span class="p">,</span>
</span><span class='line'>                                                <span class="kt">char</span> <span class="o">*</span><span class="n">cptr</span><span class="p">);</span>
</span><span class='line'><span class="kt">void</span>            <span class="nf">example_parse_config_examplestr</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">token</span><span class="p">,</span>
</span><span class='line'>                                                <span class="kt">char</span> <span class="o">*</span><span class="n">cptr</span><span class="p">);</span>
</span><span class='line'><span class="kt">void</span>            <span class="nf">example_free_config_exampleint</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span><span class='line'><span class="kt">void</span>            <span class="nf">example_free_config_examplestr</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/*********************</span>
</span><span class='line'><span class="cm">  *</span>
</span><span class='line'><span class="cm">  *  Initialisation &amp; common implementation functions</span>
</span><span class='line'><span class="cm">  *</span>
</span><span class='line'><span class="cm">  *********************/</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * This array structure defines a representation of the</span>
</span><span class='line'><span class="cm">     *  MIB being implemented.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * The type of the array is &#39;struct variableN&#39;, where N is</span>
</span><span class='line'><span class="cm">     *  large enough to contain the longest OID sub-component</span>
</span><span class='line'><span class="cm">     *  being loaded.  This will normally be the maximum value</span>
</span><span class='line'><span class="cm">     *  of the fifth field in each line.  In this case, the second</span>
</span><span class='line'><span class="cm">     *  and third entries are both of size 2, so we&#39;re using</span>
</span><span class='line'><span class="cm">     *  &#39;struct variable2&#39;</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * The supported values for N are listed in &lt;agent/var_struct.h&gt;</span>
</span><span class='line'><span class="cm">     *  If the value you need is not listed there, simply use the</span>
</span><span class='line'><span class="cm">     *  next largest that is.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * The format of each line is as follows</span>
</span><span class='line'><span class="cm">     *  (using the first entry as an example):</span>
</span><span class='line'><span class="cm">     *      1: EXAMPLESTRING:</span>
</span><span class='line'><span class="cm">     *          The magic number defined in the example header file.</span>
</span><span class='line'><span class="cm">     *          This is passed to the callback routine and is used</span>
</span><span class='line'><span class="cm">     *            to determine which object is being queried.</span>
</span><span class='line'><span class="cm">     *      2: ASN_OCTET_STR:</span>
</span><span class='line'><span class="cm">     *          The type of the object.</span>
</span><span class='line'><span class="cm">     *          Valid types are listed in &lt;snmp_impl.h&gt;</span>
</span><span class='line'><span class="cm">     *      3: RONLY (or RWRITE):</span>
</span><span class='line'><span class="cm">     *          Whether this object can be SET or not.</span>
</span><span class='line'><span class="cm">     *      4: var_example:</span>
</span><span class='line'><span class="cm">     *          The callback routine, used when the object is queried.</span>
</span><span class='line'><span class="cm">     *          This will usually be the same for all objects in a module</span>
</span><span class='line'><span class="cm">     *            and is typically defined later in this file.</span>
</span><span class='line'><span class="cm">     *      5: 1:</span>
</span><span class='line'><span class="cm">     *          The length of the OID sub-component (the next field)</span>
</span><span class='line'><span class="cm">     *      6: {1}:</span>
</span><span class='line'><span class="cm">     *          The OID sub-components of this entry.</span>
</span><span class='line'><span class="cm">     *          In other words, the bits of the full OID that differ</span>
</span><span class='line'><span class="cm">     *            between the various entries of this array.</span>
</span><span class='line'><span class="cm">     *          This value is appended to the common prefix (defined later)</span>
</span><span class='line'><span class="cm">     *            to obtain the full OID of each entry.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'><span class="k">struct</span> <span class="n">variable2</span> <span class="n">example_variables</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">{</span><span class="n">EXAMPLESTRING</span><span class="p">,</span> <span class="n">ASN_OCTET_STR</span><span class="p">,</span> <span class="n">RONLY</span><span class="p">,</span> <span class="n">var_example</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="mi">1</span><span class="p">}},</span>
</span><span class='line'>    <span class="p">{</span><span class="n">EXAMPLEINTEGER</span><span class="p">,</span> <span class="n">ASN_INTEGER</span><span class="p">,</span> <span class="n">RWRITE</span><span class="p">,</span> <span class="n">var_example</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">}},</span>
</span><span class='line'>    <span class="p">{</span><span class="n">EXAMPLEOBJECTID</span><span class="p">,</span> <span class="n">ASN_OBJECT_ID</span><span class="p">,</span> <span class="n">RONLY</span><span class="p">,</span> <span class="n">var_example</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">}},</span>
</span><span class='line'>    <span class="p">{</span><span class="n">EXAMPLETIMETICKS</span><span class="p">,</span> <span class="n">ASN_TIMETICKS</span><span class="p">,</span> <span class="n">RONLY</span><span class="p">,</span> <span class="n">var_example</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="mi">3</span><span class="p">}},</span>
</span><span class='line'>    <span class="p">{</span><span class="n">EXAMPLEIPADDRESS</span><span class="p">,</span> <span class="n">ASN_IPADDRESS</span><span class="p">,</span> <span class="n">RONLY</span><span class="p">,</span> <span class="n">var_example</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="mi">4</span><span class="p">}},</span>
</span><span class='line'>    <span class="p">{</span><span class="n">EXAMPLECOUNTER</span><span class="p">,</span> <span class="n">ASN_COUNTER</span><span class="p">,</span> <span class="n">RONLY</span><span class="p">,</span> <span class="n">var_example</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="mi">5</span><span class="p">}},</span>
</span><span class='line'>    <span class="p">{</span><span class="n">EXAMPLEGAUGE</span><span class="p">,</span> <span class="n">ASN_GAUGE</span><span class="p">,</span> <span class="n">RONLY</span><span class="p">,</span> <span class="n">var_example</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="mi">6</span><span class="p">}},</span>
</span><span class='line'>    <span class="p">{</span><span class="n">EXAMPLETRIGGERTRAP</span><span class="p">,</span> <span class="n">ASN_INTEGER</span><span class="p">,</span> <span class="n">RWRITE</span><span class="p">,</span> <span class="n">var_example</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="mi">7</span><span class="p">}},</span>
</span><span class='line'>    <span class="p">{</span><span class="n">EXAMPLETRIGGERTRAP2</span><span class="p">,</span> <span class="n">ASN_INTEGER</span><span class="p">,</span> <span class="n">RWRITE</span><span class="p">,</span> <span class="n">var_example</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="mi">8</span><span class="p">}}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * This array defines the OID of the top of the mib tree that we&#39;re</span>
</span><span class='line'><span class="cm">     *  registering underneath.</span>
</span><span class='line'><span class="cm">     * Note that this needs to be the correct size for the OID being </span>
</span><span class='line'><span class="cm">     *  registered, so that the length of the OID can be calculated.</span>
</span><span class='line'><span class="cm">     *  The format given here is the simplest way to achieve this.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'><span class="n">oid</span>             <span class="n">example_variables_oid</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">254</span> <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * This function is called at the time the agent starts up</span>
</span><span class='line'><span class="cm">     *  to do any initializations that might be required.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * In theory it is optional and can be omitted if no</span>
</span><span class='line'><span class="cm">     *  initialization is needed.  In practise, every module</span>
</span><span class='line'><span class="cm">     *  will need to register itself (or the objects being</span>
</span><span class='line'><span class="cm">     *  implemented will not appear in the MIB tree), and this</span>
</span><span class='line'><span class="cm">     *  registration is typically done here.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * If this function is added or removed, you must re-run</span>
</span><span class='line'><span class="cm">     *  the configure script, to detect this change.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'><span class="kt">void</span>
</span><span class='line'><span class="nf">init_example</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * Register ourselves with the agent to handle our mib tree.</span>
</span><span class='line'><span class="cm">     * The arguments are:</span>
</span><span class='line'><span class="cm">     *    descr:   A short description of the mib group being loaded.</span>
</span><span class='line'><span class="cm">     *    var:     The variable structure to load.</span>
</span><span class='line'><span class="cm">     *                  (the name of the variable structure defined above)</span>
</span><span class='line'><span class="cm">     *    vartype: The type of this variable structure</span>
</span><span class='line'><span class="cm">     *    theoid:  The OID pointer this MIB is being registered underneath.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="n">REGISTER_MIB</span><span class="p">(</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="n">example_variables</span><span class="p">,</span> <span class="n">variable2</span><span class="p">,</span>
</span><span class='line'>                 <span class="n">example_variables_oid</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     *  Register config handlers for the two objects that can be set</span>
</span><span class='line'><span class="cm">     *   via configuration file directive.</span>
</span><span class='line'><span class="cm">     *  Also set a default value for the string object.  Note that the</span>
</span><span class='line'><span class="cm">     *   example integer variable was initialised above.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="n">strncpy</span><span class="p">(</span><span class="n">example_str</span><span class="p">,</span> <span class="n">EXAMPLE_STR_DEFAULT</span><span class="p">,</span> <span class="n">EXAMPLE_STR_LEN</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">snmpd_register_config_handler</span><span class="p">(</span><span class="s">&quot;exampleint&quot;</span><span class="p">,</span>
</span><span class='line'>                                  <span class="n">example_parse_config_exampleint</span><span class="p">,</span>
</span><span class='line'>                                  <span class="n">example_free_config_exampleint</span><span class="p">,</span>
</span><span class='line'>                                  <span class="s">&quot;exampleint value&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">snmpd_register_config_handler</span><span class="p">(</span><span class="s">&quot;examplestr&quot;</span><span class="p">,</span>
</span><span class='line'>                                  <span class="n">example_parse_config_examplestr</span><span class="p">,</span>
</span><span class='line'>                                  <span class="n">example_free_config_examplestr</span><span class="p">,</span>
</span><span class='line'>                                  <span class="s">&quot;examplestr value&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">snmpd_register_config_handler</span><span class="p">(</span><span class="s">&quot;examplestring&quot;</span><span class="p">,</span>
</span><span class='line'>                                  <span class="n">example_parse_config_examplestr</span><span class="p">,</span>
</span><span class='line'>                                  <span class="n">example_free_config_examplestr</span><span class="p">,</span>
</span><span class='line'>                                  <span class="s">&quot;examplestring value&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * One common requirement is to read values from the kernel.</span>
</span><span class='line'><span class="cm">     * This is usually initialised here, to speed up access when the</span>
</span><span class='line'><span class="cm">     *  information is read in, as a response to an incoming request.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * This module doesn&#39;t actually use this mechanism,</span>
</span><span class='line'><span class="cm">     * so this call is commented out here.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * auto_nlist( &quot;example_symbol&quot;, 0, 0 ); </span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/*********************</span>
</span><span class='line'><span class="cm">  *</span>
</span><span class='line'><span class="cm">  *  Configuration file handling functions</span>
</span><span class='line'><span class="cm">  *</span>
</span><span class='line'><span class="cm">  *********************/</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span>
</span><span class='line'><span class="nf">example_parse_config_exampleint</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">token</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cptr</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">example_int</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">cptr</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span>
</span><span class='line'><span class="nf">example_parse_config_examplestr</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">token</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cptr</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * Make sure the string fits in the space allocated for it.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">cptr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">EXAMPLE_STR_LEN</span><span class="p">)</span>
</span><span class='line'>        <span class="n">strcpy</span><span class="p">(</span><span class="n">example_str</span><span class="p">,</span> <span class="n">cptr</span><span class="p">);</span>
</span><span class='line'>    <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * Truncate the string if necessary.</span>
</span><span class='line'><span class="cm">         * An alternative approach would be to log an error,</span>
</span><span class='line'><span class="cm">         *  and discard this value altogether.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="n">strncpy</span><span class="p">(</span><span class="n">example_str</span><span class="p">,</span> <span class="n">cptr</span><span class="p">,</span> <span class="n">EXAMPLE_STR_LEN</span> <span class="o">-</span> <span class="mi">4</span><span class="p">);</span>
</span><span class='line'>        <span class="n">example_str</span><span class="p">[</span><span class="n">EXAMPLE_STR_LEN</span> <span class="o">-</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="n">strcat</span><span class="p">(</span><span class="n">example_str</span><span class="p">,</span> <span class="s">&quot;...&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">example_str</span><span class="p">[</span><span class="n">EXAMPLE_STR_LEN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * We don&#39;t need to do anything special when closing down </span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'><span class="kt">void</span>
</span><span class='line'><span class="nf">example_free_config_exampleint</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span>
</span><span class='line'><span class="nf">example_free_config_examplestr</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/*********************</span>
</span><span class='line'><span class="cm">  *</span>
</span><span class='line'><span class="cm">  *  System specific implementation functions</span>
</span><span class='line'><span class="cm">  *</span>
</span><span class='line'><span class="cm">  *********************/</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * Define the callback function used in the example_variables structure.</span>
</span><span class='line'><span class="cm">     * This is called whenever an incoming request refers to an object</span>
</span><span class='line'><span class="cm">     *  within this sub-tree.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * Four of the parameters are used to pass information in.</span>
</span><span class='line'><span class="cm">     * These are:</span>
</span><span class='line'><span class="cm">     *    vp      The entry from the &#39;example_variables&#39; array for the</span>
</span><span class='line'><span class="cm">     *             object being queried.</span>
</span><span class='line'><span class="cm">     *    name    The OID from the request.</span>
</span><span class='line'><span class="cm">     *    length  The length of this OID.</span>
</span><span class='line'><span class="cm">     *    exact   A flag to indicate whether this is an &#39;exact&#39; request</span>
</span><span class='line'><span class="cm">     *             (GET/SET) or an &#39;inexact&#39; one (GETNEXT/GETBULK).</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * Four of the parameters are used to pass information back out.</span>
</span><span class='line'><span class="cm">     * These are:</span>
</span><span class='line'><span class="cm">     *    name     The OID being returned.</span>
</span><span class='line'><span class="cm">     *    length   The length of this OID.</span>
</span><span class='line'><span class="cm">     *    var_len  The length of the answer being returned.</span>
</span><span class='line'><span class="cm">     *    write_method   A pointer to the SET function for this object.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * Note that name &amp; length serve a dual purpose in both roles.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>
</span><span class='line'><span class="n">u_char</span>         <span class="o">*</span>
</span><span class='line'><span class="nf">var_example</span><span class="p">(</span><span class="k">struct</span> <span class="n">variable</span> <span class="o">*</span><span class="n">vp</span><span class="p">,</span>
</span><span class='line'>            <span class="n">oid</span> <span class="o">*</span> <span class="n">name</span><span class="p">,</span>
</span><span class='line'>            <span class="kt">size_t</span> <span class="o">*</span> <span class="n">length</span><span class="p">,</span>
</span><span class='line'>            <span class="kt">int</span> <span class="n">exact</span><span class="p">,</span> <span class="kt">size_t</span> <span class="o">*</span> <span class="n">var_len</span><span class="p">,</span> <span class="n">WriteMethod</span> <span class="o">**</span> <span class="n">write_method</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     *  The result returned from this function needs to be a pointer to</span>
</span><span class='line'><span class="cm">     *    static data (so that it can be accessed from outside).</span>
</span><span class='line'><span class="cm">     *  Define suitable variables for any type of data we may return.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="k">static</span> <span class="kt">char</span>     <span class="n">string</span><span class="p">[</span><span class="n">EXAMPLE_STR_LEN</span><span class="p">];</span>    <span class="cm">/* for EXAMPLESTRING   */</span>
</span><span class='line'>    <span class="k">static</span> <span class="n">oid</span>      <span class="n">oid_ret</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="cm">/* for EXAMPLEOBJECTID */</span>
</span><span class='line'>    <span class="k">static</span> <span class="kt">long</span>     <span class="n">long_ret</span><span class="p">;</span>   <span class="cm">/* for everything else */</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * Before returning an answer, we need to check that the request</span>
</span><span class='line'><span class="cm">     *  refers to a valid instance of this object.  The utility routine</span>
</span><span class='line'><span class="cm">     *  &#39;header_generic&#39; can be used to do this for scalar objects.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * This routine &#39;header_simple_table&#39; does the same thing for &quot;simple&quot;</span>
</span><span class='line'><span class="cm">     *  tables. (See the AGENT.txt file for the definition of a simple table).</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * Both these utility routines also set up default values for the</span>
</span><span class='line'><span class="cm">     *  return arguments (assuming the check succeeded).</span>
</span><span class='line'><span class="cm">     * The name and length are set suitably for the current object,</span>
</span><span class='line'><span class="cm">     *  var_len assumes that the result is an integer of some form,</span>
</span><span class='line'><span class="cm">     *  and write_method assumes that the object cannot be set.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * If these assumptions are correct, this callback routine simply</span>
</span><span class='line'><span class="cm">     * needs to return a pointer to the appropriate value (using &#39;long_ret&#39;).</span>
</span><span class='line'><span class="cm">     * Otherwise, &#39;var_len&#39; and/or &#39;write_method&#39; should be set suitably.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="n">DEBUGMSGTL</span><span class="p">((</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="s">&quot;var_example entered</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">));</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">header_generic</span><span class="p">(</span><span class="n">vp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">exact</span><span class="p">,</span> <span class="n">var_len</span><span class="p">,</span> <span class="n">write_method</span><span class="p">)</span> <span class="o">==</span>
</span><span class='line'>        <span class="n">MATCH_FAILED</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * Many object will need to obtain data from the operating system in</span>
</span><span class='line'><span class="cm">     *  order to return the appropriate value.  Typically, this is done</span>
</span><span class='line'><span class="cm">     *  here - immediately following the &#39;header&#39; call, and before the</span>
</span><span class='line'><span class="cm">     *  switch statement. This is particularly appropriate if a single </span>
</span><span class='line'><span class="cm">     *  interface call can return data for all the objects supported.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * This example module does not rely on external data, so no such</span>
</span><span class='line'><span class="cm">     *  calls are needed in this case.  </span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * Now use the magic number from the variable pointer &#39;vp&#39; to</span>
</span><span class='line'><span class="cm">     *  select the particular object being queried.</span>
</span><span class='line'><span class="cm">     * In each case, one of the static objects is set up with the</span>
</span><span class='line'><span class="cm">     *  appropriate information, and returned mapped to a &#39;u_char *&#39;</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="n">vp</span><span class="o">-&gt;</span><span class="n">magic</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">EXAMPLESTRING</span>:
</span><span class='line'>        <span class="n">sprintf</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">example_str</span><span class="p">);</span>
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * Note that the assumption that the answer will be an</span>
</span><span class='line'><span class="cm">         *  integer does not hold true in this case, so the length</span>
</span><span class='line'><span class="cm">         *  of the answer needs to be set explicitly.           </span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="o">*</span><span class="n">var_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="p">)</span> <span class="n">string</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">EXAMPLEINTEGER</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * Here the length assumption is correct, but the</span>
</span><span class='line'><span class="cm">         *  object is writeable, so we need to set the</span>
</span><span class='line'><span class="cm">         *  write_method pointer as well as the current value.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="n">long_ret</span> <span class="o">=</span> <span class="n">example_int</span><span class="p">;</span>
</span><span class='line'>        <span class="o">*</span><span class="n">write_method</span> <span class="o">=</span> <span class="n">write_exampleint</span><span class="p">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">long_ret</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">EXAMPLEOBJECTID</span>:
</span><span class='line'>        <span class="n">oid_ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>        <span class="n">oid_ret</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'>        <span class="n">oid_ret</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
</span><span class='line'>        <span class="n">oid_ret</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>        <span class="n">oid_ret</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span><span class='line'>        <span class="n">oid_ret</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">oid_ret</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">oid_ret</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * Again, the assumption regarding the answer length is wrong.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="o">*</span><span class="n">var_len</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">oid</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="p">)</span> <span class="n">oid_ret</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">EXAMPLETIMETICKS</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * Here both assumptions are correct,</span>
</span><span class='line'><span class="cm">         *  so we just need to set up the answer.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="n">long_ret</span> <span class="o">=</span> <span class="mi">363136200</span><span class="p">;</span>   <span class="cm">/* 42 days, 42 minutes and 42.0 seconds */</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">long_ret</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">EXAMPLEIPADDRESS</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * ipaddresses get returned as a long.  ick </span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * we&#39;re returning 127.0.0.1 </span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="n">long_ret</span> <span class="o">=</span> <span class="n">ntohl</span><span class="p">(</span><span class="n">INADDR_LOOPBACK</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">long_ret</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">EXAMPLECOUNTER</span>:
</span><span class='line'>        <span class="n">long_ret</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">long_ret</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">EXAMPLEGAUGE</span>:
</span><span class='line'>        <span class="n">long_ret</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>          <span class="cm">/* Do we detect a theme running through these answers? */</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">long_ret</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">EXAMPLETRIGGERTRAP</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * This object is essentially &quot;write-only&quot;.</span>
</span><span class='line'><span class="cm">         * It only exists to trigger the sending of a trap.</span>
</span><span class='line'><span class="cm">         * Reading it will always return 0.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="n">long_ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="o">*</span><span class="n">write_method</span> <span class="o">=</span> <span class="n">write_exampletrap</span><span class="p">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">long_ret</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">EXAMPLETRIGGERTRAP2</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * This object is essentially &quot;write-only&quot;.</span>
</span><span class='line'><span class="cm">         * It only exists to trigger the sending of a v2 trap.</span>
</span><span class='line'><span class="cm">         * Reading it will always return 0.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="n">long_ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="o">*</span><span class="n">write_method</span> <span class="o">=</span> <span class="n">write_exampletrap2</span><span class="p">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">long_ret</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nl">default:</span>
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         *  This will only be triggered if there&#39;s a problem with</span>
</span><span class='line'><span class="cm">         *   the coding of the module.  SNMP requests that reference</span>
</span><span class='line'><span class="cm">         *   a non-existant OID will be directed elsewhere.</span>
</span><span class='line'><span class="cm">         *  If this branch is reached, log an error, so that</span>
</span><span class='line'><span class="cm">         *   the problem can be investigated.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="n">DEBUGMSGTL</span><span class="p">((</span><span class="s">&quot;snmpd&quot;</span><span class="p">,</span> <span class="s">&quot;unknown sub-id %d in examples/var_example</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">vp</span><span class="o">-&gt;</span><span class="n">magic</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * If we fall through to here, fail by returning NULL.</span>
</span><span class='line'><span class="cm">     * This is essentially a continuation of the &#39;default&#39; case above.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/*********************</span>
</span><span class='line'><span class="cm">  *</span>
</span><span class='line'><span class="cm">  *  Writeable object SET handling routines</span>
</span><span class='line'><span class="cm">  *</span>
</span><span class='line'><span class="cm">  *********************/</span>
</span><span class='line'><span class="kt">int</span>
</span><span class='line'><span class="nf">write_exampleint</span><span class="p">(</span><span class="kt">int</span> <span class="n">action</span><span class="p">,</span>
</span><span class='line'>                 <span class="n">u_char</span> <span class="o">*</span> <span class="n">var_val</span><span class="p">,</span>
</span><span class='line'>                 <span class="n">u_char</span> <span class="n">var_val_type</span><span class="p">,</span>
</span><span class='line'>                 <span class="kt">size_t</span> <span class="n">var_val_len</span><span class="p">,</span>
</span><span class='line'>                 <span class="n">u_char</span> <span class="o">*</span> <span class="n">statP</span><span class="p">,</span> <span class="n">oid</span> <span class="o">*</span> <span class="n">name</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">name_len</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * Define an arbitrary maximum permissible value </span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'><span class="cp">#define MAX_EXAMPLE_INT  100</span>
</span><span class='line'>    <span class="k">static</span> <span class="kt">long</span>     <span class="n">intval</span><span class="p">;</span>
</span><span class='line'>    <span class="k">static</span> <span class="kt">long</span>     <span class="n">old_intval</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">RESERVE1</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         *  Check that the value being set is acceptable</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">var_val_type</span> <span class="o">!=</span> <span class="n">ASN_INTEGER</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">DEBUGMSGTL</span><span class="p">((</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="s">&quot;%x not integer type&quot;</span><span class="p">,</span> <span class="n">var_val_type</span><span class="p">));</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">SNMP_ERR_WRONGTYPE</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">var_val_len</span> <span class="o">&gt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">long</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">DEBUGMSGTL</span><span class="p">((</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="s">&quot;wrong length %x&quot;</span><span class="p">,</span> <span class="n">var_val_len</span><span class="p">));</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">SNMP_ERR_WRONGLENGTH</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">intval</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">long</span> <span class="o">*</span><span class="p">)</span> <span class="n">var_val</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;you have set the value :%ld&quot;</span><span class="p">,</span><span class="n">intval</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">intval</span> <span class="o">&gt;</span> <span class="n">MAX_EXAMPLE_INT</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">DEBUGMSGTL</span><span class="p">((</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="s">&quot;wrong value %x&quot;</span><span class="p">,</span> <span class="n">intval</span><span class="p">));</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">SNMP_ERR_WRONGVALUE</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">RESERVE2</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         *  This is conventially where any necesary</span>
</span><span class='line'><span class="cm">         *   resources are allocated (e.g. calls to malloc)</span>
</span><span class='line'><span class="cm">         *  Here, we are using static variables</span>
</span><span class='line'><span class="cm">         *   so don&#39;t need to worry about this.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">FREE</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         *  This is where any of the above resources</span>
</span><span class='line'><span class="cm">         *   are freed again (because one of the other</span>
</span><span class='line'><span class="cm">         *   values being SET failed for some reason).</span>
</span><span class='line'><span class="cm">         *  Again, since we are using static variables</span>
</span><span class='line'><span class="cm">         *   we don&#39;t need to worry about this either.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">ACTION</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         *  Set the variable as requested.</span>
</span><span class='line'><span class="cm">         *   Note that this may need to be reversed,</span>
</span><span class='line'><span class="cm">         *   so save any information needed to do this.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="n">old_intval</span> <span class="o">=</span> <span class="n">example_int</span><span class="p">;</span>
</span><span class='line'>        <span class="n">example_int</span> <span class="o">=</span> <span class="n">intval</span><span class="p">;</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">UNDO</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         *  Something failed, so re-set the</span>
</span><span class='line'><span class="cm">         *   variable to its previous value</span>
</span><span class='line'><span class="cm">         *  (and free any allocated resources).</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="n">example_int</span> <span class="o">=</span> <span class="n">old_intval</span><span class="p">;</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">COMMIT</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         *  Everything worked, so we can discard any</span>
</span><span class='line'><span class="cm">         *   saved information, and make the change</span>
</span><span class='line'><span class="cm">         *   permanent (e.g. write to the config file).</span>
</span><span class='line'><span class="cm">         *  We also free any allocated resources.</span>
</span><span class='line'><span class="cm">         *</span>
</span><span class='line'><span class="cm">         *  In this case, there&#39;s nothing to do.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">SNMP_ERR_NOERROR</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span>
</span><span class='line'><span class="nf">write_exampletrap</span><span class="p">(</span><span class="kt">int</span> <span class="n">action</span><span class="p">,</span>
</span><span class='line'>                  <span class="n">u_char</span> <span class="o">*</span> <span class="n">var_val</span><span class="p">,</span>
</span><span class='line'>                  <span class="n">u_char</span> <span class="n">var_val_type</span><span class="p">,</span>
</span><span class='line'>                  <span class="kt">size_t</span> <span class="n">var_val_len</span><span class="p">,</span>
</span><span class='line'>                  <span class="n">u_char</span> <span class="o">*</span> <span class="n">statP</span><span class="p">,</span> <span class="n">oid</span> <span class="o">*</span> <span class="n">name</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">name_len</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">long</span>            <span class="n">intval</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">DEBUGMSGTL</span><span class="p">((</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="s">&quot;write_exampletrap entered: action=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="n">action</span><span class="p">));</span>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">RESERVE1</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         *  The only acceptable value is the integer 1</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">var_val_type</span> <span class="o">!=</span> <span class="n">ASN_INTEGER</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">DEBUGMSGTL</span><span class="p">((</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="s">&quot;%x not integer type&quot;</span><span class="p">,</span> <span class="n">var_val_type</span><span class="p">));</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">SNMP_ERR_WRONGTYPE</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">var_val_len</span> <span class="o">&gt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">long</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">DEBUGMSGTL</span><span class="p">((</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="s">&quot;wrong length %x&quot;</span><span class="p">,</span> <span class="n">var_val_len</span><span class="p">));</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">SNMP_ERR_WRONGLENGTH</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">intval</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">long</span> <span class="o">*</span><span class="p">)</span> <span class="n">var_val</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">intval</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">DEBUGMSGTL</span><span class="p">((</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="s">&quot;wrong value %x&quot;</span><span class="p">,</span> <span class="n">intval</span><span class="p">));</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">SNMP_ERR_WRONGVALUE</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">RESERVE2</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * No resources are required.... </span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">FREE</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * ... so no resources need be freed </span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">ACTION</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         *  Having triggered the sending of a trap,</span>
</span><span class='line'><span class="cm">         *   it would be impossible to revoke this,</span>
</span><span class='line'><span class="cm">         *   so we can&#39;t actually invoke the action here.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">UNDO</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * We haven&#39;t done anything yet,</span>
</span><span class='line'><span class="cm">         * so there&#39;s nothing to undo </span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">COMMIT</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         *  Everything else worked, so it&#39;s now safe</span>
</span><span class='line'><span class="cm">         *   to trigger the trap.</span>
</span><span class='line'><span class="cm">         *  Note that this is *only* acceptable since</span>
</span><span class='line'><span class="cm">         *   the trap sending routines are &quot;failsafe&quot;.</span>
</span><span class='line'><span class="cm">         *  (In fact, they can fail, but they return no</span>
</span><span class='line'><span class="cm">         *   indication of this, which is the next best thing!)</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="n">DEBUGMSGTL</span><span class="p">((</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="s">&quot;write_exampletrap sending the trap</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">));</span>
</span><span class='line'>        <span class="n">send_easy_trap</span><span class="p">(</span><span class="n">SNMP_TRAP_ENTERPRISESPECIFIC</span><span class="p">,</span> <span class="mi">99</span><span class="p">);</span>
</span><span class='line'>        <span class="n">DEBUGMSGTL</span><span class="p">((</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="s">&quot;write_exampletrap trap sent</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">));</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">SNMP_ERR_NOERROR</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * this documents how to send a SNMPv2 (and higher) trap via the</span>
</span><span class='line'><span class="cm"> * send_v2trap() API.</span>
</span><span class='line'><span class="cm"> * </span>
</span><span class='line'><span class="cm"> * Coding SNMP-v2 Trap:</span>
</span><span class='line'><span class="cm"> * </span>
</span><span class='line'><span class="cm"> * The SNMPv2-Trap PDU contains at least a pair of object names and</span>
</span><span class='line'><span class="cm"> * values: - sysUpTime.0 whose value is the time in hundredths of a</span>
</span><span class='line'><span class="cm"> * second since the netwok management portion of system was last</span>
</span><span class='line'><span class="cm"> * reinitialized.  - snmpTrapOID.0 which is part of the trap group SNMPv2</span>
</span><span class='line'><span class="cm"> * MIB whose value is the object-id of the specific trap you have defined</span>
</span><span class='line'><span class="cm"> * in your own MIB.  Other variables can be added to caracterize the</span>
</span><span class='line'><span class="cm"> * trap.</span>
</span><span class='line'><span class="cm"> * </span>
</span><span class='line'><span class="cm"> * The function send_v2trap adds automaticallys the two objects but the</span>
</span><span class='line'><span class="cm"> * value of snmpTrapOID.0 is 0.0 by default. If you want to add your trap</span>
</span><span class='line'><span class="cm"> * name, you have to reconstruct this object and to add your own</span>
</span><span class='line'><span class="cm"> * variable.</span>
</span><span class='line'><span class="cm"> * </span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span>
</span><span class='line'><span class="nf">write_exampletrap2</span><span class="p">(</span><span class="kt">int</span> <span class="n">action</span><span class="p">,</span>
</span><span class='line'>                   <span class="n">u_char</span> <span class="o">*</span> <span class="n">var_val</span><span class="p">,</span>
</span><span class='line'>                   <span class="n">u_char</span> <span class="n">var_val_type</span><span class="p">,</span>
</span><span class='line'>                   <span class="kt">size_t</span> <span class="n">var_val_len</span><span class="p">,</span>
</span><span class='line'>                   <span class="n">u_char</span> <span class="o">*</span> <span class="n">statP</span><span class="p">,</span> <span class="n">oid</span> <span class="o">*</span> <span class="n">name</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">name_len</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">long</span>            <span class="n">intval</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * these variales will be used when we send the trap </span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="n">oid</span>             <span class="n">objid_snmptrap</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">};</span>     <span class="cm">/* snmpTrapOID.0 */</span>
</span><span class='line'>    <span class="n">oid</span>             <span class="n">demo_trap</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">990</span> <span class="p">};</span>  <span class="cm">/*demo-trap */</span>
</span><span class='line'>    <span class="n">oid</span>             <span class="n">example_string_oid</span><span class="p">[]</span> <span class="o">=</span>
</span><span class='line'>        <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">};</span>
</span><span class='line'>    <span class="k">static</span> <span class="n">netsnmp_variable_list</span> <span class="n">var_trap</span><span class="p">;</span>
</span><span class='line'>    <span class="k">static</span> <span class="n">netsnmp_variable_list</span> <span class="n">var_obj</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">DEBUGMSGTL</span><span class="p">((</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="s">&quot;write_exampletrap2 entered: action=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="n">action</span><span class="p">));</span>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">RESERVE1</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         *  The only acceptable value is the integer 1</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">var_val_type</span> <span class="o">!=</span> <span class="n">ASN_INTEGER</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">DEBUGMSGTL</span><span class="p">((</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="s">&quot;%x not integer type&quot;</span><span class="p">,</span> <span class="n">var_val_type</span><span class="p">));</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">SNMP_ERR_WRONGTYPE</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">var_val_len</span> <span class="o">&gt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">long</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">DEBUGMSGTL</span><span class="p">((</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="s">&quot;wrong length %x&quot;</span><span class="p">,</span> <span class="n">var_val_len</span><span class="p">));</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">SNMP_ERR_WRONGLENGTH</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">intval</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">long</span> <span class="o">*</span><span class="p">)</span> <span class="n">var_val</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">intval</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">DEBUGMSGTL</span><span class="p">((</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="s">&quot;wrong value %x&quot;</span><span class="p">,</span> <span class="n">intval</span><span class="p">));</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">SNMP_ERR_WRONGVALUE</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">RESERVE2</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * No resources are required.... </span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">FREE</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * ... so no resources need be freed </span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">ACTION</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         *  Having triggered the sending of a trap,</span>
</span><span class='line'><span class="cm">         *   it would be impossible to revoke this,</span>
</span><span class='line'><span class="cm">         *   so we can&#39;t actually invoke the action here.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">UNDO</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * We haven&#39;t done anything yet,</span>
</span><span class='line'><span class="cm">         * so there&#39;s nothing to undo </span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="n">COMMIT</span>:
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         *  Everything else worked, so it&#39;s now safe</span>
</span><span class='line'><span class="cm">         *   to trigger the trap.</span>
</span><span class='line'><span class="cm">         *  Note that this is *only* acceptable since</span>
</span><span class='line'><span class="cm">         *   the trap sending routines are &quot;failsafe&quot;.</span>
</span><span class='line'><span class="cm">         *  (In fact, they can fail, but they return no</span>
</span><span class='line'><span class="cm">         *   indication of this, which is the next best thing!)</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * trap definition objects </span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">var_trap</span><span class="p">.</span><span class="n">next_variable</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">var_obj</span><span class="p">;</span>      <span class="cm">/* next variable */</span>
</span><span class='line'>        <span class="n">var_trap</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">objid_snmptrap</span><span class="p">;</span> <span class="cm">/* snmpTrapOID.0 */</span>
</span><span class='line'>        <span class="n">var_trap</span><span class="p">.</span><span class="n">name_length</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">objid_snmptrap</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">oid</span><span class="p">);</span>    <span class="cm">/* number of sub-ids */</span>
</span><span class='line'>        <span class="n">var_trap</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ASN_OBJECT_ID</span><span class="p">;</span>
</span><span class='line'>        <span class="n">var_trap</span><span class="p">.</span><span class="n">val</span><span class="p">.</span><span class="n">objid</span> <span class="o">=</span> <span class="n">demo_trap</span><span class="p">;</span> <span class="cm">/* demo-trap objid */</span>
</span><span class='line'>        <span class="n">var_trap</span><span class="p">.</span><span class="n">val_len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">demo_trap</span><span class="p">);</span>   <span class="cm">/* length in bytes (not number of subids!) */</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/*</span>
</span><span class='line'><span class="cm">         * additional objects </span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>        <span class="n">var_obj</span><span class="p">.</span><span class="n">next_variable</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>   <span class="cm">/* No more variables after this one */</span>
</span><span class='line'>        <span class="n">var_obj</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">example_string_oid</span><span class="p">;</span>
</span><span class='line'>        <span class="n">var_obj</span><span class="p">.</span><span class="n">name_length</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">example_string_oid</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">oid</span><span class="p">);</span> <span class="cm">/* number of sub-ids */</span>
</span><span class='line'>        <span class="n">var_obj</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ASN_OCTET_STR</span><span class="p">;</span>   <span class="cm">/* type of variable */</span>
</span><span class='line'>        <span class="n">var_obj</span><span class="p">.</span><span class="n">val</span><span class="p">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">example_str</span><span class="p">;</span>       <span class="cm">/* value */</span>
</span><span class='line'>        <span class="n">var_obj</span><span class="p">.</span><span class="n">val_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">example_str</span><span class="p">);</span>
</span><span class='line'>        <span class="n">DEBUGMSGTL</span><span class="p">((</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="s">&quot;write_exampletrap2 sending the v2 trap</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">));</span>
</span><span class='line'>        <span class="n">send_v2trap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">var_trap</span><span class="p">);</span>
</span><span class='line'>        <span class="n">DEBUGMSGTL</span><span class="p">((</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="s">&quot;write_exampletrap2 v2 trap sent</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">SNMP_ERR_NOERROR</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>example-demon.c</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cm">/*主函数：foxmail_new.c */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;net-snmp/net-snmp-config.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;net-snmp/net-snmp-includes.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;net-snmp/agent/net-snmp-agent-includes.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;signal.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &quot;example.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define MYDEBUG </span>
</span><span class='line'><span class="cp">#ifdef MYDEBUG</span>
</span><span class='line'>  <span class="err">#</span><span class="n">define</span> <span class="n">myprintf</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">a</span><span class="p">...)</span>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s,%s(),%d:&quot;</span> <span class="n">fmt</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__FILE__</span><span class="p">,</span><span class="n">__FUNCTION__</span><span class="p">,</span><span class="n">__LINE__</span><span class="p">,</span> <span class="err">##</span><span class="n">a</span><span class="p">)</span>
</span><span class='line'><span class="cp">#else</span>
</span><span class='line'>  <span class="err">#</span><span class="n">define</span> <span class="n">myprintf</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">a</span><span class="p">...)</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">int</span> <span class="n">keep_running</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">RETSIGTYPE</span>
</span><span class='line'>
</span><span class='line'><span class="nf">stop_server</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">keep_running</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span> <span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">agentx_subagent</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="cm">/* change this if you want to be a SNMP master agent */</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">background</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* change this if you want to run in the background */</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">syslog</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* change this if you want to use syslog */</span>
</span><span class='line'>
</span><span class='line'><span class="n">myprintf</span><span class="p">(</span><span class="s">&quot;it is ok</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="cm">/* print log errors to syslog or stderr */</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">syslog</span><span class="p">)</span>
</span><span class='line'>    <span class="n">snmp_enable_calllog</span><span class="p">();</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="n">snmp_enable_stderrlog</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//myprintf(&quot;it is ok \n&quot;);</span>
</span><span class='line'>  <span class="cm">/* we&#39;re an agentx subagent? */</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">agentx_subagent</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* make us a agentx client. */</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">netsnmp_ds_set_boolean</span><span class="p">(</span><span class="n">NETSNMP_DS_APPLICATION_ID</span><span class="p">,</span> <span class="n">NETSNMP_DS_AGENT_ROLE</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* run in background, if requested */</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">background</span> <span class="o">&amp;&amp;</span> <span class="n">netsnmp_daemonize</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">!</span><span class="n">syslog</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Initialize tcpip, if necessary */</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">SOCK_STARTUP</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Initialize the agent library */</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">init_agent</span><span class="p">(</span><span class="s">&quot;example-demon&quot;</span><span class="p">);</span>
</span><span class='line'><span class="n">init_system_mib</span><span class="p">();</span>
</span><span class='line'><span class="n">init_sysORTable</span><span class="p">();</span>
</span><span class='line'><span class="n">init_at</span><span class="p">();</span>
</span><span class='line'><span class="n">init_snmp_mib</span><span class="p">();</span>
</span><span class='line'><span class="n">init_tcp</span><span class="p">();</span>
</span><span class='line'><span class="n">init_icmp</span><span class="p">();</span>
</span><span class='line'><span class="n">init_ip</span><span class="p">();</span>
</span><span class='line'><span class="n">init_udp</span><span class="p">();</span>
</span><span class='line'><span class="n">init_vacm_vars</span><span class="p">();</span>
</span><span class='line'><span class="n">init_memory</span><span class="p">();</span>
</span><span class='line'><span class="n">init_proc</span><span class="p">();</span>
</span><span class='line'><span class="n">init_versioninfo</span><span class="p">();</span>
</span><span class='line'><span class="n">init_pass</span><span class="p">();</span>
</span><span class='line'><span class="n">init_pass_persist</span><span class="p">();</span>
</span><span class='line'><span class="n">init_disk</span><span class="p">();</span>
</span><span class='line'><span class="n">init_loadave</span><span class="p">();</span>
</span><span class='line'><span class="n">init_extensible</span><span class="p">();</span>
</span><span class='line'><span class="n">init_errormib</span><span class="p">();</span>
</span><span class='line'><span class="n">init_file</span><span class="p">();</span>
</span><span class='line'><span class="n">init_snmpEngine</span><span class="p">();</span>
</span><span class='line'><span class="n">init_snmpMPDStats</span><span class="p">();</span>
</span><span class='line'><span class="n">init_usmStats</span><span class="p">();</span>
</span><span class='line'><span class="n">init_usmUser</span><span class="p">();</span>
</span><span class='line'><span class="n">init_var_route</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Initialize our mib code here */</span>
</span><span class='line'>
</span><span class='line'><span class="n">init_example</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* initialize vacm/usm access control  */</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">agentx_subagent</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span>  <span class="n">init_vacm_vars</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span>  <span class="n">init_usmUser</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* Example-demon will be used to read example-demon.conf files. */</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">init_snmp</span><span class="p">(</span><span class="s">&quot;example-demon&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* If we&#39;re going to be a snmp master agent, initial the ports */</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">agentx_subagent</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">init_master_agent</span><span class="p">();</span>  <span class="cm">/* open the port to listen on (defaults to udp:161) */</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* In case we recevie a request to stop (kill -TERM or kill -INT) */</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">keep_running</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">signal</span><span class="p">(</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">stop_server</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">signal</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">stop_server</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">snmp_log</span><span class="p">(</span><span class="n">LOG_INFO</span><span class="p">,</span><span class="s">&quot;example-demon is up and running.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* your main loop here... */</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="n">keep_running</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* if you use select(), see snmp_select_info() in snmp_api(3) */</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*     --- OR ---  */</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">agent_check_and_process</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="cm">/* 0 == don&#39;t block */</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* at shutdown time */</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">snmp_shutdown</span><span class="p">(</span><span class="s">&quot;example-demon&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">SOCK_CLEANUP</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>example-demon.conf</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">###############################################################################</span>
</span><span class='line'><span class="cp"># Access Control</span>
</span><span class='line'><span class="cp">###############################################################################</span>
</span><span class='line'>
</span><span class='line'><span class="cp"># sec.name source community</span>
</span><span class='line'><span class="n">rocommunity</span> <span class="n">public</span>
</span><span class='line'><span class="n">rwcommunity</span> <span class="mi">223323</span>
</span><span class='line'><span class="cp">####</span>
</span><span class='line'><span class="cp"># Second, map the security names into group names:</span>
</span><span class='line'>
</span><span class='line'><span class="cp"># sec.model sec.name</span>
</span><span class='line'><span class="n">group</span> <span class="n">MyRWGroup</span> <span class="n">v1</span> <span class="n">local</span>
</span><span class='line'><span class="n">group</span> <span class="n">MyRWGroup</span> <span class="n">v2c</span> <span class="n">local</span>
</span><span class='line'><span class="n">group</span> <span class="n">MyRWGroup</span> <span class="n">usm</span> <span class="n">local</span>
</span><span class='line'><span class="n">group</span> <span class="n">MyROGroup</span> <span class="n">v1</span> <span class="n">mynetwork</span>
</span><span class='line'><span class="n">group</span> <span class="n">MyROGroup</span> <span class="n">v2c</span> <span class="n">mynetwork</span>
</span><span class='line'><span class="n">group</span> <span class="n">MyROGroup</span> <span class="n">usm</span> <span class="n">mynetwork</span>
</span><span class='line'>
</span><span class='line'><span class="cp">####</span>
</span><span class='line'><span class="cp"># Third, create a view for us to let the groups have rights to:</span>
</span><span class='line'>
</span><span class='line'><span class="cp"># incl/excl subtree mask</span>
</span><span class='line'><span class="n">view</span> <span class="n">all</span> <span class="n">included</span> <span class="mf">.1</span> <span class="mi">80</span>
</span><span class='line'>
</span><span class='line'><span class="cp">####</span>
</span><span class='line'><span class="cp"># Finally, grant the 2 groups access to the 1 view with different</span>
</span><span class='line'><span class="cp"># write permissions:</span>
</span><span class='line'>
</span><span class='line'><span class="cp"># context sec.model sec.level match read write notif</span>
</span><span class='line'><span class="n">access</span> <span class="n">MyROGroup</span> <span class="s">&quot;&quot;</span> <span class="n">any</span> <span class="n">noauth</span> <span class="n">exact</span> <span class="n">all</span> <span class="n">none</span> <span class="n">none</span>
</span><span class='line'><span class="n">access</span> <span class="n">MyRWGroup</span> <span class="s">&quot;&quot;</span> <span class="n">any</span> <span class="n">noauth</span> <span class="n">exact</span> <span class="n">all</span> <span class="n">all</span> <span class="n">none</span>
</span><span class='line'>
</span><span class='line'><span class="n">agentaddress</span> <span class="mi">161</span>
</span></code></pre></td></tr></table></div></figure>


<p>Makefile</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='makefile'><span class='line'><span class="nv">CC</span><span class="o">=</span>gcc
</span><span class='line'><span class="nv">OBJS2</span><span class="o">=</span>example-demon.o example.o
</span><span class='line'><span class="nv">TARGETS</span><span class="o">=</span>example-demon
</span><span class='line'>
</span><span class='line'><span class="nv">CFLAGS</span><span class="o">=</span>-I. <span class="sb">`</span>net-snmp-config --cflags<span class="sb">`</span>
</span><span class='line'><span class="nv">BUILDLIBS</span><span class="o">=</span><span class="sb">`</span>net-snmp-config --libs<span class="sb">`</span>
</span><span class='line'><span class="nv">BUILDAGENTLIBS</span><span class="o">=</span><span class="sb">`</span>net-snmp-config --agent-libs<span class="sb">`</span>
</span><span class='line'>
</span><span class='line'><span class="c"># shared library flags (assumes gcc)</span>
</span><span class='line'><span class="nv">DLFLAGS</span><span class="o">=</span>-fPIC –shared
</span><span class='line'>
</span><span class='line'><span class="nf">all</span><span class="o">:</span> <span class="m">$(TARGETS)</span>
</span><span class='line'>
</span><span class='line'><span class="nf">example-demon</span><span class="o">:</span> <span class="m">$(OBJS2)</span>
</span><span class='line'>  <span class="k">$(</span>CC<span class="k">)</span> -o example-demon <span class="k">$(</span>OBJS2<span class="k">)</span> <span class="k">$(</span>BUILDAGENTLIBS<span class="k">)</span>
</span><span class='line'>
</span><span class='line'><span class="nf">clean</span><span class="o">:</span>
</span><span class='line'>  rm <span class="k">$(</span>OBJS2<span class="k">)</span> <span class="k">$(</span>OBJS2<span class="k">)</span> <span class="k">$(</span>TARGETS<span class="k">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>目前无法获取到系统load，以后用到再深入。</p>

<p>参考文章
《Snmp Agent开发流程》
<a href="http://blog.csdn.net/ytz_linuxer/article/details/5985534">http://blog.csdn.net/ytz_linuxer/article/details/5985534</a></p>

<p>《网管SNMP Agent的快速开发》
<a href="http://www.wangchao.net.cn/bbsdetail_53491.html">http://www.wangchao.net.cn/bbsdetail_53491.html</a></p>

<p>《SNMP监控一些常用OID的总结》
<a href="http://www.cnblogs.com/aspx-net/p/3554044.html">http://www.cnblogs.com/aspx-net/p/3554044.html</a></p>

<p>《与大家分享uclinux上的ucd-snmp开发过程》
<a href="http://bbs.chinaunix.net/thread-2112856-1-1.html">http://bbs.chinaunix.net/thread-2112856-1-1.html</a></p>
</div>


      <footer>
        <p class="meta text-muted">
          
  

<span class="glyphicon glyphicon-user"></span> <span class="byline author vcard">Posted by <span class="fn">Evoup`s Blog</span></span>

          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-08-03T17:59:00+08:00" pubdate data-updated="true">Aug 3<span>rd</span>, 2014</time>
          

<span class="glyphicon glyphicon-tags"></span>&nbsp;
<span class="categories">
  
    <a class='category' href='/blog/categories/monitor/'>monitor</a>
  
</span>


        </p>
        
          <div class="bshare-custom"><a title="分享到QQ空间" class="bshare-qzone"></a><a title="分享到新浪微博" class="bshare-sinaminiblog"></a><a title="分享到人人网" class="bshare-renren"></a><a title="分享到腾讯微博" class="bshare-qqmb"></a><a title="分享到网易微博" class="bshare-neteasemb"></a><a title="更多平台" class="bshare-more bshare-more-icon more-style-addthis"></a><span class="BSHARE_COUNT bshare-share-count">0</span></div><script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/buttonLite.js#style=-1&amp;uuid=&amp;pophcol=2&amp;lang=zh"></script><script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/bshareC0.js"></script>
        
        
          <ul class="meta text-muted pager">
            
            <li class="previous"><a href="/blog/2014/07/31/compile-cdh47-hive-contrib/" title="Previous Post: 编译cdh47下hive的contrib源码">&laquo; 编译cdh47下hive的contrib源码</a></li>
            
            
            <li class="next"><a href="/blog/2014/08/30/hiveserver2-maven-config/" title="Next Post: hiveserver2的maven配置，使用cdh版本">hiveserver2的maven配置，使用cdh版本 &raquo;</a></li>
            
          </ul>
        
      </footer>
    </article>

  <section id="comment">
    <h1>发表评论</h1>
    <!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"evoupsight"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->
  </section>

  </div>

  
  <aside class="sidebar col-md-3">
    
      <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">最新发表</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/2016/07/12/latex-vim-pratice/">Linux下latex中文配置小记</a>
    
    <a class="list-group-item " href="/blog/2015/04/21/javascript-class-define-5-method/">五类方法定义javascript类</a>
    
    <a class="list-group-item " href="/blog/2015/04/21/sync-fork-github/">同步github分支过来的代码库</a>
    
    <a class="list-group-item " href="/blog/2014/09/16/sqoop-dump-to-mysql/">Sqoop导出hive数据到mysql</a>
    
    <a class="list-group-item " href="/blog/2014/08/30/hiveserver2-maven-config/">Hiveserver2的maven配置，使用cdh版本</a>
    
  </div>
</section>


<section>
<h1>分类</h1>
<span class='categories_tag'> <a href='/blog/categories/android' style='font-size: 118.75%'>Android(5)</a>  <a href='/blog/categories/c-language' style='font-size: 137.5%'>C-language(10)</a>  <a href='/blog/categories/cocos2d-html5' style='font-size: 107.5%'>Cocos2d-html5(2)</a>  <a href='/blog/categories/cocos2d-iphone' style='font-size: 103.75%'>Cocos2d-iphone(1)</a>  <a href='/blog/categories/cocos2d-js' style='font-size: 107.5%'>Cocos2d-js(2)</a>  <a href='/blog/categories/cocos2d-x' style='font-size: 111.25%'>Cocos2d-x(3)</a>  <a href='/blog/categories/cplusplus' style='font-size: 122.5%'>Cplusplus(6)</a>  <a href='/blog/categories/erlang' style='font-size: 160.0%'>Erlang(16)</a>  <a href='/blog/categories/freebsd' style='font-size: 133.75%'>Freebsd(9)</a>  <a href='/blog/categories/gamedev-cg' style='font-size: 111.25%'>Gamedev-cg(3)</a>  <a href='/blog/categories/gcc' style='font-size: 103.75%'>Gcc(1)</a>  <a href='/blog/categories/golang' style='font-size: 107.5%'>Golang(2)</a>  <a href='/blog/categories/hadoop' style='font-size: 152.5%'>Hadoop(14)</a>  <a href='/blog/categories/haproxy' style='font-size: 103.75%'>Haproxy(1)</a>  <a href='/blog/categories/hbase' style='font-size: 115.0%'>Hbase(4)</a>  <a href='/blog/categories/hive' style='font-size: 118.75%'>Hive(5)</a>  <a href='/blog/categories/java' style='font-size: 126.25%'>Java(7)</a>  <a href='/blog/categories/javascript' style='font-size: 115.0%'>Javascript(4)</a>  <a href='/blog/categories/latex' style='font-size: 103.75%'>Latex(1)</a>  <a href='/blog/categories/linux' style='font-size: 107.5%'>Linux(2)</a>  <a href='/blog/categories/maven' style='font-size: 107.5%'>Maven(2)</a>  <a href='/blog/categories/mongodb' style='font-size: 103.75%'>Mongodb(1)</a>  <a href='/blog/categories/monitor' style='font-size: 137.5%'>Monitor(10)</a>  <a href='/blog/categories/mysql' style='font-size: 118.75%'>Mysql(5)</a>  <a href='/blog/categories/nginx' style='font-size: 130.0%'>Nginx(8)</a>  <a href='/blog/categories/nosql' style='font-size: 103.75%'>Nosql(1)</a>  <a href='/blog/categories/octopress' style='font-size: 115.0%'>Octopress(4)</a>  <a href='/blog/categories/php' style='font-size: 148.75%'>Php(13)</a>  <a href='/blog/categories/python' style='font-size: 103.75%'>Python(1)</a>  <a href='/blog/categories/rrdtool' style='font-size: 126.25%'>Rrdtool(7)</a>  <a href='/blog/categories/shell' style='font-size: 130.0%'>Shell(8)</a>  <a href='/blog/categories/socket-server' style='font-size: 111.25%'>Socket server(3)</a>  <a href='/blog/categories/version-control' style='font-size: 126.25%'>Version_control(7)</a>  <a href='/blog/categories/vim' style='font-size: 122.5%'>Vim(6)</a>  <a href='/blog/categories/vmware' style='font-size: 103.75%'>Vmware(1)</a>  <a href='/blog/categories/zookeeper' style='font-size: 115.0%'>Zookeeper(4)</a> </span>
</section>

<section>
    <h1>新浪微博</h1>
    <ul id="weibo">
    <li>
    <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=2839412552&verifier=2533dcd4&dpc=1"></iframe>
    </li>
    </ul>
</section><section>
    <h1>友情链接</h1>
    <ul>
        <li>
            <a href="http://www.konanblog.info" target=_BLANK>Konan`s blog</a>
        </li>
    </ul>
	    <ul>
        <li>
            <a href="http://www.yrzhll.com/" target=_BLANK>蝶姐's Blog</a>
        </li>
    </ul>
</section><section>
<!--<h1>我的豆瓣主页</h1>-->
<div>
<!--<script type="text/javascript" src="http://www.douban.com/service/badge/evoupYin/?show=wishlist&n=9&columns=3&hidelogo=yes&cat=movie|book" ></script>-->
<script type="text/javascript" src="http://www.douban.com/service/badge/evoupYin/?selection=random&picsize=small&show=collection&n=3&cat=movie%7Cbook%7Cmusic&columns=3"></script>
</div>
</section>




<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">最近访客</h3>
  </div>
  <div class="list-group">
    <ul class="ds-recent-visitors" data-num-items="10" ></ul>    
  </div>
</section>

    
  </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2016 - Evoup`s Blog<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    <script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>









<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F2793871dfb78c3a9ad26e39cae55c3a6' type='text/javascript'%3E%3C/script%3E"));
</script>

  </body>
</html>
