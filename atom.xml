<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Evoup`s Blog]]></title>
  <link href="http://evoupsight.com/atom.xml" rel="self"/>
  <link href="http://evoupsight.com/"/>
  <updated>2014-02-12T17:57:09+08:00</updated>
  <id>http://evoupsight.com/</id>
  <author>
    <name><![CDATA[Evoup`s Blog]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[64位freebsd8.1下安装ffmpeg和php扩展]]></title>
    <link href="http://evoupsight.com/blog/2014/02/12/freebsd8-dot-1amd64-install-ffmpeg-and-php-extension/"/>
    <updated>2014-02-12T17:27:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/02/12/freebsd8-dot-1amd64-install-ffmpeg-and-php-extension</id>
    <content type="html"><![CDATA[<p>帮同事解决一个开源音视频转换处理软件ffmpeg在freebsd8.1下安装的问题，我也是装了2个下午，绕了个圈子下载了个没用的扩展浪费时间。</p>

<!-- more -->


<h3>环境freebsd8.1 amd64</h3>

<p>我拿个了干净的系统做试验，安装的时候选择了develop模式和customize，customize里只选择了ports,然后php是装在了/usr/local/php53目录下。</p>

<h3>安装过程描述</h3>

<h4>ffmpeg的安装</h4>

<p>主要采用pkg_add ffmpeg.tbz的方式来安装。
然后看报错的依赖缺少啥一个一个装上去，途中需要的包可以通过下面的命令来获取：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>fetch ftp://ftp.fi.freebsd.org/pub/FreeBSD/ports/amd64/packages-8.1-release/Latest/ffmpeg.tbz
</span><span class='line'>fetch ftp://ftp.fi.freebsd.org/pub/FreeBSD/ports/amd64/packages-8.1-release/Latest/x264.tbz
</span></code></pre></td></tr></table></div></figure>


<p>采用pkg_add快速安装包
安装的时候反正就是不断用下面的语句试探</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo pkg_add ffmpeg.tbz
</span></code></pre></td></tr></table></div></figure>


<p>用pkg_add一个一个装，直到ffmpeg安装完成。</p>

<p>如果你也是这么装，那么全部东西下完，大概有这么多依赖OMG</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>&gt;ls
</span><span class='line'>damageproto.tbz  gpac-libgpac.tbz  libXau.tbz      libdrm.tbz            libvorbis.tbz   png.tbz               xvid.tbz
</span><span class='line'>dri2proto.tbz    jpeg.tbz          libXdamage.tbz  libiconv.tbz          libxcb.tbz      schroedinger.tbz
</span><span class='line'>expat.tbz        kbproto.tbz       libXdmcp.tbz    libogg.tbz            libxml.tbz      x264.tbz
</span><span class='line'>faad2.tbz        libGL.tbz         libXext.tbz     libpthread-stubs.tbz  libxml2.tbz     xextproto.tbz
</span><span class='line'>ffmpeg.tbz       libGLU.tbz        libXfixes.tbz   libtheora.tbz         orc.tbz         xf86vidmodeproto.tbz
</span><span class='line'>fixesproto.tbz   libX11.tbz        libXxf86vm.tbz  libtool.tbz           pkg-config.tbz  xproto.tbz
</span></code></pre></td></tr></table></div></figure>


<p>嫌麻烦的可以先下好软件然后批量装</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>find . -name <span class="s2">&quot;*.tbz&quot;</span> -exec pkg_add <span class="o">{}</span> <span class="se">\;</span>
</span></code></pre></td></tr></table></div></figure>


<p>当然也免不了部分手动来部分包，窃喜~</p>

<hr />

<h4>ffmpeg-php的安装</h4>

<p>装php，./configure的时候出现出错，查看config.log
<code>/usr/bin/ld: cannot find -liconv</code>
需要再用pkg_add安装libxml，重新安装libiconv，用port安装，谈到要安装libtool213,再用pkg_add去装，卸掉libiconv，重新用port安装，下载php5.3编译通过，再去下载ffmpeg-php，用phpize的方式编译成动态库，会报告少autoconf，此时在到port里安装autoconf213，会让安装perl，等待安装完成就是。</p>

<p>下载正确的扩展,不要用sf那个2005年的扩展，不能用。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>fetch http://downloads.sourceforge.net/project/ffmpeg-php/ffmpeg-php/0.6.0/ffmpeg-php-0.6.0.tbz2
</span><span class='line'>tar xjf ffmpeg-php-0.6.0.tbz2
</span><span class='line'><span class="nb">cd </span>ffmpeg-php
</span><span class='line'>phpize
</span></code></pre></td></tr></table></div></figure>


<p>在phpize的时候可能出现</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>evoup@freebsd81amd64 ffmpeg<span class="o">]</span>&gt;/usr/local/php53/bin/phpize
</span><span class='line'>Configuring <span class="k">for</span>:
</span><span class='line'>PHP Api Version:         20090626
</span><span class='line'>Zend Module Api No:      20090626
</span><span class='line'>Zend Extension Api No:   220090626
</span><span class='line'>Cannot find autoconf. Please check your autoconf installation and the
</span><span class='line'><span class="nv">$PHP_AUTOCONF</span> environment variable. Then, rerun this script.
</span></code></pre></td></tr></table></div></figure>


<p>此时需要在环境变量中指定好autoconf和autoheader的路径，我是加载.cshrc文件中</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>setenv PHP_AUTOCONF <span class="s2">&quot;/usr/local/bin/autoconf&quot;</span>
</span><span class='line'>setenv PHP_AUTOHEADER <span class="s2">&quot;/usr/local/bin/autoheader&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>完事之后不要忘记重载~/.cshrc</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">source</span> ~/.cshrc
</span></code></pre></td></tr></table></div></figure>


<p>phpize完了之后可以开始configure了</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>./configure --with-php-cofig<span class="o">=</span>/usr/local/php53/bin/php-config
</span><span class='line'>/usr/local/include/ffmpeg/avcodec.h:30:30: error: libavutil/avutil.h: No such file or directory
</span></code></pre></td></tr></table></div></figure>


<p>其实这个是ffmpeg安装好应该有的库</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>locate avutil.h
</span><span class='line'>/usr/home/evoup/software/libavutil/avutil.h
</span><span class='line'>/usr/local/include/ffmpeg/avutil.h
</span><span class='line'>/usr/local/include/libavutil/avutil.h
</span></code></pre></td></tr></table></div></figure>


<p>怎么装上去？嘿嘿，直接把相关的路径做软连接</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo ln -s /usr/local/include/libavcodec/ /usr/include/libavcodec/
</span><span class='line'>sudo ln -s /usr/local/include/libavcodec/ /usr/include/libavcodec
</span><span class='line'>sudo ln -s /usr/local/include/libavdevice/ /usr/include/libavdevice
</span><span class='line'>sudo ln -s /usr/local/include/libavfilter/ /usr/include/libavfilter
</span><span class='line'>sudo ln -s /usr/local/include/libavformat/ /usr/include/libavformat
</span><span class='line'>sudo ln -s /usr/local/include/libavutil/ /usr/include/libavutil
</span></code></pre></td></tr></table></div></figure>


<p>然后再次</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>make
</span><span class='line'>sudo make install
</span><span class='line'>Installing shared extensions:     /usr/local/php53/lib/php/extensions/no-debug-non-zts-20090626/
</span></code></pre></td></tr></table></div></figure>


<p>安装ok,接下来加载到php,要做的是看下php的ini位置，放进去就是</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>/usr/local/php53/bin/php -i | grep Conf
</span><span class='line'>Configure <span class="nv">Command</span> <span class="o">=</span>&gt;  <span class="s1">&#39;./configure&#39;</span>  <span class="s1">&#39;--prefix=/usr/local/php53&#39;</span>
</span><span class='line'>Configuration File <span class="o">(</span>php.ini<span class="o">)</span> <span class="nv">Path</span> <span class="o">=</span>&gt; /usr/local/php53/lib
</span><span class='line'>Loaded Configuration <span class="nv">File</span> <span class="o">=</span>&gt; /usr/local/php53/lib/php.ini
</span><span class='line'>Configuration
</span></code></pre></td></tr></table></div></figure>


<p>说明在/usr/local/php53/lib下，于是把编译好的so移到该目录下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo mv /usr/local/php53/lib/php/extensions/no-debug-non-zts-20090626/ffmpeg.so /usr/local/php53/lib
</span></code></pre></td></tr></table></div></figure>


<p>最后在php.ini中指定</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">extension</span><span class="o">=</span>ffmpeg.so
</span></code></pre></td></tr></table></div></figure>


<hr />

<p>观察劳动成果</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>/usr/local/php53/bin/php -i | grep ffmpeg
</span><span class='line'>ffmpeg
</span><span class='line'>ffmpeg-php <span class="nv">version</span> <span class="o">=</span>&gt; 0.6.0-svn
</span><span class='line'>ffmpeg-php built <span class="nv">on</span> <span class="o">=</span>&gt; Feb 12 2014 17:10:47
</span><span class='line'>ffmpeg-php gd <span class="nv">support</span>  <span class="o">=</span>&gt; disabled
</span><span class='line'>ffmpeg libavcodec <span class="nv">version</span> <span class="o">=</span>&gt; Lavc52.20.1
</span><span class='line'>ffmpeg libavformat <span class="nv">version</span> <span class="o">=</span>&gt; Lavf52.31.0
</span><span class='line'>ffmpeg <span class="nv">swscaler</span> <span class="o">=</span>&gt; disabled
</span><span class='line'>ffmpeg.allow_persistent <span class="o">=</span>&gt; <span class="nv">0</span> <span class="o">=</span>&gt; 0
</span><span class='line'>ffmpeg.show_warnings <span class="o">=</span>&gt; <span class="nv">0</span> <span class="o">=</span>&gt; 0
</span></code></pre></td></tr></table></div></figure>


<p>没问题收工。</p>

<p>参考互联网文章《编译FFMpeg和FFMpeg-php》linux版的</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[VS2010 LINK:fatal error LNK1123]]></title>
    <link href="http://evoupsight.com/blog/2014/02/10/vs2010-link-fatal-error-lnk1123/"/>
    <updated>2014-02-10T15:22:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/02/10/vs2010-link-fatal-error-lnk1123</id>
    <content type="html"><![CDATA[<p>因为要看cocostudio的实例代码，在原有vs2010的基础上又安装了vs2012，出现了项目不能编译的问题OMG
<code>LINK : fatal error LNK1123: 转换到 COFF 期间失败: 文件无效或损坏</code>
以下为解决方法：</p>

<!-- more -->


<blockquote><p>VS2010在经历一些更新后，建立Win32 Console Project时会出“error LNK1123” 错误，解决方案为将 项目|项目属性|配置属性|清单工具|输入和输出|嵌入清单 “是”改为“否”即可，但是没新建一个项目都要这样设置一次。
在建立VS2010 Win32 Project项目时，按照上面解决方案依然发生了“error LNK1123”错误，经过上网查资料，解决方案为：
第一步：与上相同。
第二步：将 项目|项目属性|配置属性|连接器|清单文件|嵌入清单 “是”改为“否”。
第三步：一般计算机经过上两步设置就能解决问题了，但是如果还有问题，那就按一下方法解决：
计算机是否为64bit操作系统，如是，继续2。
查找是否有两个cvtres.exe。一个是C:\Program Files (x86)\Microsoft Visual Studio 10.0\VC\bin\cvtres.exe， 另一个是C:\Windows\Microsoft.NET\Framework\v4.0.30319\cvtres.exe。右键属性|详细信息 查看两者版本号，删除/重命名较旧的版本，或者重新设置Path变量。
删除或者重命名比较旧的版本的cvtres.exe即可。</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[octopress2报错undefined method `[] for nill:NilClass]]></title>
    <link href="http://evoupsight.com/blog/2014/02/09/octopress2-undefined-method-for-nill-nilclass/"/>
    <updated>2014-02-09T22:32:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/02/09/octopress2-undefined-method-for-nill-nilclass</id>
    <content type="html"><![CDATA[<p>今天在用octopress生成博客静态页的时候，出现如下警告
<code>Liquid Exception: undefined method '[]' for nil:NilClass</code>
看下错误上下文先，上次记得这个问题是括号不能连写导致的，这次又是为啥呢？</p>

<!-- more -->


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake generate
</span><span class='line'>## Generating Site with Jekyll
</span><span class='line'>unchanged sass/screen.scss
</span><span class='line'>Configuration from E:/octopress2/evoup.github.com/_config.yml
</span><span class='line'>Building site: source -&gt; public
</span><span class='line'>## Generating Categories..
</span><span class='line'> =&gt; Creating Categories Tag Cloud
</span><span class='line'> =&gt; Creating Categories Sidebar
</span><span class='line'>Liquid Exception: undefined method `[]' for nil:NilClass in 2014-02-08-cocos2d-x
</span><span class='line'>-cocos2d-iphone-cocos2d-html5-sprite-and-animation-summary.markdown
</span><span class='line'>E:/octopress2/evoup.github.com/plugins/pygments_code.rb:14:in `highlight'
</span><span class='line'>E:/octopress2/evoup.github.com/plugins/code_block.rb:82:in `render'
</span><span class='line'>c:/Ruby193/lib/ruby/gems/1.9.1/gems/liquid-2.3.0/lib/liquid/block.rb:94:in `bloc
</span><span class='line'>k in render_all'
</span><span class='line'>c:/Ruby193/lib/ruby/gems/1.9.1/gems/liquid-2.3.0/lib/liquid/block.rb:92:in `coll
</span><span class='line'>ect'
</span><span class='line'>c:/Ruby193/lib/ruby/gems/1.9.1/gems/liquid-2.3.0/lib/liquid/block.rb:92:in `rend
</span><span class='line'>er_all'
</span><span class='line'>c:/Ruby193/lib/ruby/gems/1.9.1/gems/liquid-2.3.0/lib/liquid/block.rb:82:in `rend</span></code></pre></td></tr></table></div></figure>


<p>是看来是语法高亮的语法问题，认为代码有错，2个括号居然不能分开写：</p>

<blockquote><p>sprite->setPosition( ccp(100, 240) ); //设置坐标为x=100,y=240
<br/>
必须写成sprite->setPosition(ccp(100, 240)); //设置坐标为x=100,y=240</p></blockquote>

<p>以下问题发现在这个ruby版本
ruby 1.9.3p484 (2013-11-22) [i386-mingw32]</p>

<p>但奇怪的是公司里的环境没有问题，先记一笔备忘。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[cocos2d-x cocos2d-iphone cocos2d-html5下加载精灵的总结]]></title>
    <link href="http://evoupsight.com/blog/2014/02/08/cocos2d-x-cocos2d-iphone-cocos2d-html5-load-sprite-summary/"/>
    <updated>2014-02-08T13:10:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/02/08/cocos2d-x-cocos2d-iphone-cocos2d-html5-load-sprite-summary</id>
    <content type="html"><![CDATA[<p>加载精灵的几种套路，以下总结下cocos2d-x v2.2.2、cocos2d-iphone v0.99b和cocos2d-html5 v2.2.2三个平台下的创建显示图片和帧动画的方法：</p>

<!-- more -->


<blockquote><p><i>直接从图片创建：</i></p></blockquote>

<figure class='code'><figcaption><span>cocos2d-x </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="n">CCSprite</span> <span class="o">*</span><span class="n">sprite</span><span class="o">=</span><span class="n">CCSprite</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;res/pic.png&quot;</span><span class="p">);</span> <span class="c1">//从pic.png创建一个精灵</span>
</span><span class='line'><span class="n">sprite</span><span class="o">-&gt;</span><span class="n">setPosition</span><span class="p">(</span><span class="n">ccp</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">240</span><span class="p">));</span> <span class="c1">//设置坐标为x=100,y=240</span>
</span><span class='line'><span class="n">sprite</span><span class="o">-&gt;</span><span class="n">setScale</span><span class="p">(</span><span class="mf">0.5</span><span class="p">);</span> <span class="c1">//缩小50%</span>
</span><span class='line'><span class="k">this</span><span class="o">-&gt;</span><span class="n">addChild</span><span class="p">(</span><span class="n">sprite</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span> <span class="c1">//加载到this场景对象下</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>cocos2d-iphone </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">CCSprite</span> <span class="o">*</span><span class="n">sprite</span> <span class="o">=</span> <span class="p">[</span><span class="n">CCSprite</span> <span class="nl">spriteWithFile:</span><span class="s">@&quot;res/pic.png&quot;</span><span class="p">];</span> <span class="c1">//从pic.png创建一个精灵</span>
</span><span class='line'><span class="n">sprite</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">ccp</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">240</span><span class="p">);</span> <span class="c1">//设置坐标为x=100,y=240</span>
</span><span class='line'><span class="n">sprite</span><span class="p">.</span><span class="n">scale</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">//缩小50%</span>
</span><span class='line'><span class="p">[</span><span class="n">self</span> <span class="nl">addChild:</span><span class="n">sprite</span> <span class="nl">z:</span><span class="mi">0</span><span class="p">];</span> <span class="c1">//加载到self场景对象下</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>cocos2d-html5 </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">sprite</span><span class="p">;</span> <span class="c1">//定义sprite变量</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">sprite</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Sprite</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;res/pic.png&quot;</span><span class="p">);</span> <span class="c1">//从pic.png创建一个精灵</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="k">new</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">240</span><span class="p">));</span> <span class="c1">//设置坐标为x=100,y=240</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">scale</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">//缩小50%</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">//加载到this场景对象下</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<blockquote><p><i>batchnode显示大量精灵：</i>
<br />注意：batchnode的限制是所有添加到它里面的CCSprite节点的Z轴顺序必须相同，且须使用相同纹理。</p></blockquote>

<figure class='code'><figcaption><span>cocos2d-x </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="n">CCSpriteBatchNode</span> <span class="o">*</span> <span class="n">batchNode</span> <span class="o">=</span> <span class="n">CCSpriteBatchNode</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;pic.png&quot;</span><span class="p">);</span> <span class="c1">//创建批渲染对象</span>
</span><span class='line'><span class="k">this</span><span class="o">-&gt;</span><span class="n">addChild</span><span class="p">(</span><span class="n">batchNode</span><span class="p">);</span> <span class="c1">//批渲染对象加载到self场景对象下</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">CCSprite</span> <span class="o">*</span><span class="n">sprite</span> <span class="o">=</span> <span class="n">CCSprite</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;pic.png&quot;</span><span class="p">);</span> <span class="c1">//载入图片到精灵，方法效率看起来可以优化（code来自《cocos2d-x游戏开发之旅》）</span>
</span><span class='line'>  <span class="n">batchNode</span><span class="o">-&gt;</span><span class="n">addChild</span><span class="p">(</span><span class="n">sprite</span><span class="p">);</span> <span class="c1">//将精灵添加到批渲染对象</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>cocos2d-iphone </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">CCSpriteBatchNode</span> <span class="o">*</span> <span class="n">batchNode</span> <span class="o">=</span> <span class="p">[</span><span class="n">CCSpriteBatchNode</span> <span class="nl">batchNodeWithFile:</span>
</span><span class='line'>    <span class="s">@&quot;pic.png&quot;</span><span class="p">];</span> <span class="c1">//创建批渲染对象</span>
</span><span class='line'><span class="p">[</span><span class="n">self</span> <span class="nl">addChild:</span><span class="n">batch</span><span class="p">];</span> <span class="c1">//批渲染对象加载到self场景对象下</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">CCSprite</span> <span class="o">*</span><span class="n">sprite</span> <span class="o">=</span> <span class="p">[</span><span class="n">CCSpriteBatchNode</span> <span class="nl">batchNodeWithFile:</span><span class="s">@&quot;pic.png&quot;</span><span class="p">];</span> <span class="c1">//载入图片到精灵</span>
</span><span class='line'>  <span class="p">[</span><span class="n">batchNode</span> <span class="nl">addChild:</span><span class="n">sprite</span><span class="p">];</span> <span class="c1">//将精灵添加到批渲染对象</span>
</span><span class='line'><span class="p">}</span>  
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>cocos2d-html5 </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//首先定义好资源</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">batchNode</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">SpriteBatchNode</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;pic.png&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span> <span class="c1">//定义批渲染对象</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">batchNode</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span> <span class="c1">//把批渲染节点加到this场景对象</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//载入100个精灵并分别加到批渲染节点</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">sprite</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Sprite</span><span class="p">.</span><span class="nx">createWithTexture</span><span class="p">(</span><span class="nx">batchNode</span><span class="p">.</span><span class="nx">getTexture</span><span class="p">(),</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">121</span><span class="p">));</span>
</span><span class='line'>    <span class="nx">batchNode</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">sprite</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<blockquote><p><i>batchnode加framecache结合显示单帧图片</i></p></blockquote>

<figure class='code'><figcaption><span>cocos2d-x </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="n">CCSpriteBatchNode</span> <span class="o">*</span><span class="n">batchNode</span> <span class="o">=</span> <span class="n">CCSpriteBatchNode</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;resource.png&quot;</span><span class="p">);</span> <span class="c1">//创建批渲染对象</span>
</span><span class='line'><span class="k">this</span><span class="o">-&gt;</span><span class="n">addChild</span><span class="p">(</span><span class="n">batchNode</span><span class="p">);</span> <span class="c1">//批渲染对象加载到this场景对象下</span>
</span><span class='line'><span class="n">CCSpriteFrameCache</span><span class="o">::</span><span class="n">sharedSpriteFrameCache</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">addSpriteFramesWithFile</span><span class="p">(</span><span class="s">&quot;resources.plist&quot;</span><span class="p">);</span> <span class="c1">//帧缓冲加入plist打包好的文件，用texture packer软件可以打包</span>
</span><span class='line'><span class="n">CCSprite</span> <span class="o">*</span> <span class="n">sprite</span> <span class="o">=</span> <span class="n">CCSprite</span><span class="o">::</span><span class="n">createWithSpriteFrameName</span><span class="p">(</span><span class="s">&quot;resources_00.png&quot;</span><span class="p">);</span> <span class="c1">//读取单帧到精灵</span>
</span><span class='line'><span class="n">batchNode</span><span class="o">-&gt;</span><span class="n">addChild</span><span class="p">(</span><span class="n">sprite</span><span class="p">);</span> <span class="c1">//加到批渲染对象</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>cocos2d-iphone </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">[[</span><span class="n">CCSpriteFrameCache</span> <span class="n">sharedSpriteFrameCache</span><span class="p">]</span> <span class="nl">addSpriteFramesWithFile:</span>
</span><span class='line'>     <span class="s">@&quot;res/resources.plist&quot;</span><span class="p">];</span> <span class="c1">//加载resource.plist文件到精灵帧缓冲区</span>
</span><span class='line'><span class="n">CCSpriteBatchNode</span> <span class="o">*</span><span class="n">spriteSheet</span> <span class="o">=</span> <span class="p">[</span><span class="n">CCSpriteBatchNode</span> <span class="nl">batchNodeWithFile:</span><span class="s">@&quot;resources.png&quot;</span><span class="p">];</span> <span class="c1">//从精灵批渲染节点返会一个精灵表</span>
</span><span class='line'><span class="p">[</span><span class="n">self</span> <span class="nl">addChild:</span><span class="n">spriteSheet</span> <span class="nl">z:</span><span class="mi">1</span><span class="p">];</span> <span class="c1">//把精灵表加载到self场景对象下，并设置Z轴顺序为1</span>
</span><span class='line'><span class="n">self</span><span class="p">.</span><span class="n">sprite</span> <span class="o">=</span> <span class="p">[</span><span class="n">CCSprite</span> <span class="nl">spriteWithSpriteFrameName:</span><span class="s">@&quot;resource_00.png&quot;</span><span class="p">];</span> <span class="c1">//再从缓冲加载单帧图片给精灵</span>
</span><span class='line'><span class="p">[</span><span class="n">spriteSheet</span> <span class="nl">addChild:</span><span class="n">sprite</span><span class="p">];</span> <span class="c1">//精灵表将该精灵呈现出来   </span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>cocos2d-html5 </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">spriteFrameCache</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">SpriteFrameCache</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">();</span>
</span><span class='line'><span class="nx">spriteFrameCache</span><span class="p">.</span><span class="nx">addSpriteFrames</span><span class="p">(</span><span class="s2">&quot;res/resources.plist&quot;</span><span class="p">,</span><span class="s2">&quot;res/resources.png&quot;</span><span class="p">);</span> <span class="c1">//从精灵批渲染节点返会一个精灵表</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">sprite</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Sprite</span><span class="p">.</span><span class="nx">createWithSpriteFrameName</span><span class="p">(</span><span class="s2">&quot;resource_00.png&quot;</span><span class="p">);</span> <span class="c1">//将单帧精灵图片添加到this场景对象</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">batchNode</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">SpriteBatchNode</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;res/resources.png&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">batchNode</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">);</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">batchNode</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[cocos2d-html5-2.2.2初探]]></title>
    <link href="http://evoupsight.com/blog/2014/01/23/cocos2d-html52-dot-2-2-first-exploration/"/>
    <updated>2014-01-23T13:14:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/01/23/cocos2d-html52-dot-2-2-first-exploration</id>
    <content type="html"><![CDATA[<p>准备用最新的cocos2d-html5 2.2.2的框架作为游戏开发引擎，整个引擎还是逻辑相当清晰好理解。</p>

<p>本文部分参考v2.1.1这篇分析文章
<a href="http://blog.csdn.net/honghaier/article/details/8642553">http://blog.csdn.net/honghaier/article/details/8642553</a></p>

<p>翻了几篇官网几篇文章，发现对应的教程没有同步起来，比如说这篇：
<a href="http://www.gamefromscratch.com/post/2012/06/08/Cocos2D-HTML-Tutorial-3All-about-sprites-and-positioning.aspx">http://www.gamefromscratch.com/post/2012/06/08/Cocos2D-HTML-Tutorial-3All-about-sprites-and-positioning.aspx</a></p>

<!-- more -->


<p>其间有这么一段代码</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">s</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">engineDir</span> <span class="o">+</span> <span class="s1">&#39;platform/jsloader.js&#39;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看到在cocos2d目录下没有这个文件，OMG! 淡定缓一缓神，让我们耐心点，这里教你一步一步来掌了解2.2.2版本的api来给原来的教程动手术,我们首先来讲解HelloWorld：</p>

<p>首先看2.2.2的helloworld的代码分布情况：</p>

<p><img src="http://evoupsight.com/images/evoup/cocos2d-html5_2.2.2_code_layout.png" alt="Alt text" /></p>

<p>其中项目必须的文件有cocos2d（cocos2d引擎）、extensions（GUI的扩展）、external（外部引擎如box2d）、lib（cocos2d基本库）。</p>

<p>接下来在根目录下仿照HelloHTML5World中的布局开始做一个项目，创建一个叫做helloworld的文件夹。</p>

<p>看一下运行截图
<img src="http://evoupsight.com/images/evoup/cocos2d-html52.2.2helloworld.png" alt="Alt text" /></p>

<hr />

<p>首先是在该文件夹下创建第一个文件index.html</p>

<figure class='code'><figcaption><span>index.html </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;title&gt;</span>hello cocos2d-html5<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;icon&quot;</span> <span class="na">type=</span><span class="s">&quot;iamge/GIF&quot;</span> <span class="na">href=</span><span class="s">&quot;res/favicon.ico&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;user-scalable=no&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;apple-mobile-web-app-capable&quot;</span> <span class="na">content=</span><span class="s">&quot;yes&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;full-screen&quot;</span> <span class="na">content=</span><span class="s">&quot;yes&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;screen-orientation&quot;</span> <span class="na">content=</span><span class="s">&quot;portrait&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;x5-fullscreen&quot;</span> <span class="na">content=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;360-fullscreen&quot;</span> <span class="na">content=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;style&gt;</span>
</span><span class='line'>        <span class="nt">body</span><span class="o">,</span> <span class="nt">canvas</span><span class="o">,</span> <span class="nt">div</span> <span class="p">{</span>
</span><span class='line'>            <span class="o">-</span><span class="n">moz</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>            <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>            <span class="o">-</span><span class="n">ms</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>            <span class="o">-</span><span class="n">khtml</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>            <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">tap</span><span class="o">-</span><span class="n">highlight</span><span class="o">-</span><span class="k">color</span><span class="o">:</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="nt">&lt;/style&gt;</span>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body</span> <span class="na">style=</span><span class="s">&quot;padding:0; margin: 0; background: #000;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;canvas</span> <span class="na">id=</span><span class="s">&quot;gameCanvas&quot;</span> <span class="na">width=</span><span class="s">&quot;800&quot;</span> <span class="na">height=</span><span class="s">&quot;450&quot;</span><span class="nt">&gt;&lt;/canvas&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;cocos2d.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>解释:</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;user-scalable=no&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>viewport这个是移动端的meta设置，content设置为user-scalable=no代表在移动设备上 不可缩放。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;apple-mobile-web-app-capable&quot;</span> <span class="na">content=</span><span class="s">&quot;yes&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>apple-mobile-web-app-capable这个是移动端的参数，全屏模式下content设置为yes，否则不用设置。可以通过window.navigator.standalone属性来得知是否网页是否处于全屏模式。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;full-screen&quot;</span> <span class="na">content=</span><span class="s">&quot;yes&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>这个是给某些浏览器的全屏设置，比如说ucweb</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;screen-orientation&quot;</span> <span class="na">content=</span><span class="s">&quot;portrait&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>screen-orientation这个meta参数代表移动端的屏幕朝向，有2个portrait和landscape，分别代表竖向和横向,这portrait是竖向了。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;x5-fullscreen&quot;</span> <span class="na">content=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>这个是腾讯qq浏览器的全屏</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;360-fullscreen&quot;</span> <span class="na">content=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>360浏览器的全屏</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;style&gt;</span>
</span><span class='line'>    <span class="nt">body</span><span class="o">,</span> <span class="nt">canvas</span><span class="o">,</span> <span class="nt">div</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">-</span><span class="n">moz</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>        <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>        <span class="o">-</span><span class="n">ms</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>        <span class="o">-</span><span class="n">khtml</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>        <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">tap</span><span class="o">-</span><span class="n">highlight</span><span class="o">-</span><span class="k">color</span><span class="o">:</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="nt">&lt;/style&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>其中-moz-user-select、-webkit-user-select、-ms-user-select和-khtml-user-select都取值none，代表文字都不选中。而-webkit-tap-highlight-color: rgba(0,0,0,0);其中rgba的最后一个参数0代表点击一个链接或者通过JavaScript定义可点击元素的时候禁止出现灰色背景。
最后从同域引入cocos2d.js。</p>

<hr />

<p>接着创建第二个文件cocos2d.js</p>

<figure class='code'><figcaption><span>cocos2d.js </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nb">document</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">COCOS2D_DEBUG</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="c1">//0 to turn debug off, 1 for basic debug, and 2 for full debug</span>
</span><span class='line'>        <span class="nx">box2d</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">chipmunk</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">showFPS</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">frameRate</span><span class="o">:</span><span class="mi">60</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">loadExtension</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">renderMode</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>       <span class="c1">//Choose of RenderMode: 0(default), 1(Canvas only), 2(WebGL only)</span>
</span><span class='line'>        <span class="nx">tag</span><span class="o">:</span><span class="s1">&#39;gameCanvas&#39;</span><span class="p">,</span> <span class="c1">//the dom element to run cocos2d on</span>
</span><span class='line'>        <span class="nx">engineDir</span><span class="o">:</span><span class="s1">&#39;../cocos2d/&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="c1">//SingleEngineFile:&#39;&#39;,</span>
</span><span class='line'>        <span class="nx">appFiles</span><span class="o">:</span><span class="p">[</span>
</span><span class='line'>            <span class="s1">&#39;src/resource.js&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s1">&#39;src/myApp.js&#39;</span><span class="c1">//add your own files in order here</span>
</span><span class='line'>        <span class="p">]</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">).</span><span class="nx">getContext</span><span class="p">){</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">s</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&lt;h2&gt;Your browser does not support HTML5 canvas!&lt;/h2&gt;&#39;</span> <span class="o">+</span>
</span><span class='line'>            <span class="s1">&#39;&lt;p&gt;Google Chrome is a browser that combines a minimal design with sophisticated technology to make the web faster, safer, and easier.Click the logo to download.&lt;/p&gt;&#39;</span> <span class="o">+</span>
</span><span class='line'>            <span class="s1">&#39;&lt;a href=&quot;http://www.google.com/chrome&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;http://www.google.com/intl/zh-CN/chrome/assets/common/images/chrome_logo_2x.png&quot; border=&quot;0&quot;/&gt;&lt;/a&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">tag</span><span class="p">).</span><span class="nx">parentNode</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">p</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">p</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">border</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">p</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">tag</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">d</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">//first load engine file if specified</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="cm">/*********Delete this section if you have packed all files into one*******/</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">SingleEngineFile</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">engineDir</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">s</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">SingleEngineFile</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">engineDir</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">SingleEngineFile</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">s</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">engineDir</span> <span class="o">+</span> <span class="s1">&#39;jsloader.js&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;You must specify either the single engine file OR the engine directory in &quot;cocos2d.js&quot;&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="cm">/*********Delete this section if you have packed all files into one*******/</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//s.src = &#39;Packed_Release_File.js&#39;; //IMPORTANT: Un-comment this line if you have packed all files into one</span>
</span><span class='line'>
</span><span class='line'>        <span class="nb">document</span><span class="p">.</span><span class="nx">ccConfig</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">s</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;cocos2d-html5&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">d</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">//else if single file specified, load singlefile</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">})();</span>
</span></code></pre></td></tr></table></div></figure>


<h4>解释:</h4>

<p>这整个就是一个匿名函数,然后调用的写法。</p>

<p>首先创建一个局部变量d，赋值为document</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nb">document</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后创建一个c对象，提供全部配置信息</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">COCOS2D_DEBUG</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="c1">//0 to turn debug off, 1 for basic debug, and 2 for full debug</span>
</span><span class='line'>    <span class="nx">box2d</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">chipmunk</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">showFPS</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">frameRate</span><span class="o">:</span><span class="mi">60</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">loadExtension</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">renderMode</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>       <span class="c1">//Choose of RenderMode: 0(default), 1(Canvas only), 2(WebGL only)</span>
</span><span class='line'>    <span class="nx">tag</span><span class="o">:</span><span class="s1">&#39;gameCanvas&#39;</span><span class="p">,</span> <span class="c1">//the dom element to run cocos2d on</span>
</span><span class='line'>    <span class="nx">engineDir</span><span class="o">:</span><span class="s1">&#39;../cocos2d/&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c1">//SingleEngineFile:&#39;&#39;,</span>
</span><span class='line'>    <span class="nx">appFiles</span><span class="o">:</span><span class="p">[</span>
</span><span class='line'>        <span class="s1">&#39;src/resource.js&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;src/myApp.js&#39;</span><span class="c1">//add your own files in order here</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>其中:
COCOS2D_DEBUG为调试等级（0关闭，1基本，2完全）；
box2d为是否采用box2d物理引擎，这里不使用设置为no；
chipmunk为一款物理引擎，同样不使用；
showFPS是否显示FPS，是；
loadExtension是否加载扩展，否；
renderMode渲染，0为默认，1为仅Canvas方式，2为仅WebGL方式;
tag为运行cocos2d的dom元素;
engineDir为cocos2d的引擎目录;
appFiles为一个列表，目前存2个文件的地址，src/resource.js和src/myApp.js;</p>

<p>下面这段为html5探测代码，如果探测失败，会出出现一个google的chrome浏览器的logo</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">).</span><span class="nx">getContext</span><span class="p">){</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">s</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&lt;h2&gt;Your browser does not support HTML5 canvas!&lt;/h2&gt;&#39;</span> <span class="o">+</span>
</span><span class='line'>        <span class="s1">&#39;&lt;p&gt;Google Chrome is a browser that combines a minimal design with sophisticated technology to make the web faster, safer, and easier.Click the logo to download.&lt;/p&gt;&#39;</span> <span class="o">+</span>
</span><span class='line'>        <span class="s1">&#39;&lt;a href=&quot;http://www.google.com/chrome&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;http://www.google.com/intl/zh-CN/chrome/assets/common/images/chrome_logo_2x.png&quot; border=&quot;0&quot;/&gt;&lt;/a&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">tag</span><span class="p">).</span><span class="nx">parentNode</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">p</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">p</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">border</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">p</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">tag</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">d</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>再看下一段</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//first load engine file if specified</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="cm">/*********Delete this section if you have packed all files into one*******/</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">SingleEngineFile</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">engineDir</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">s</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">SingleEngineFile</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">engineDir</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">SingleEngineFile</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">s</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">engineDir</span> <span class="o">+</span> <span class="s1">&#39;jsloader.js&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;You must specify either the single engine file OR the engine directory in &quot;cocos2d.js&quot;&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="cm">/*********Delete this section if you have packed all files into one*******/</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//s.src = &#39;Packed_Release_File.js&#39;; //IMPORTANT: Un-comment this line if you have packed all files into one</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">document</span><span class="p">.</span><span class="nx">ccConfig</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">s</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;cocos2d-html5&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">d</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//else if single file specified, load singlefile</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>这段创建了DOMContentLoaded事件侦听器，干掉全部DOM对象。SingleEngineFile这个参数是如果要把cocos2d这个文件夹下的引擎程序打包成一个文件，则需要指定这个文件的路径。指定好了引擎路径engineDir为../cocos2d这个文件夹，然后加载jsloader.js(这个文件的作用是加载cocos2d需要用到的所有js文件，包括cocos2d.js,main.js,myApp.js),然后把配置文件存到document.ccConfig元素中去。
接着把cocos2d-html5这个id赋到创建到script标签上，然后加载到body标签中。</p>

<hr />

<p>接着创建第三个文件&mdash;主程序文件main.js,注意这还不是实现逻辑，而是cocos2d-html5初始化的套路。</p>

<figure class='code'><figcaption><span>main.js </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">cocos2dApp</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">config</span><span class="o">:</span><span class="nb">document</span><span class="p">[</span><span class="s1">&#39;ccConfig&#39;</span><span class="p">],</span>
</span><span class='line'>    <span class="nx">ctor</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">scene</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">startScene</span> <span class="o">=</span> <span class="nx">scene</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">cc</span><span class="p">.</span><span class="nx">COCOS2D_DEBUG</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">[</span><span class="s1">&#39;COCOS2D_DEBUG&#39;</span><span class="p">];</span>
</span><span class='line'>        <span class="nx">cc</span><span class="p">.</span><span class="nx">initDebugSetting</span><span class="p">();</span>
</span><span class='line'>        <span class="nx">cc</span><span class="p">.</span><span class="nx">setup</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]);</span>
</span><span class='line'>        <span class="nx">cc</span><span class="p">.</span><span class="nx">AppController</span><span class="p">.</span><span class="nx">shareAppController</span><span class="p">().</span><span class="nx">didFinishLaunchingWithOptions</span><span class="p">();</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">applicationDidFinishLaunching</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">RenderDoesnotSupport</span><span class="p">()){</span>
</span><span class='line'>            <span class="c1">//show Information to user</span>
</span><span class='line'>            <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Browser doesn&#39;t support WebGL&quot;</span><span class="p">);</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="c1">// initialize director</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">director</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Director</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">cc</span><span class="p">.</span><span class="nx">EGLView</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">resizeWithBrowserSize</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">cc</span><span class="p">.</span><span class="nx">EGLView</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">setDesignResolutionSize</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">RESOLUTION_POLICY</span><span class="p">.</span><span class="nx">SHOW_ALL</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// turn on display FPS</span>
</span><span class='line'>        <span class="nx">director</span><span class="p">.</span><span class="nx">setDisplayStats</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">[</span><span class="s1">&#39;showFPS&#39;</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// set FPS. the default value is 1.0/60 if you don&#39;t call this</span>
</span><span class='line'>        <span class="nx">director</span><span class="p">.</span><span class="nx">setAnimationInterval</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">[</span><span class="s1">&#39;frameRate&#39;</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//load resources</span>
</span><span class='line'>        <span class="nx">cc</span><span class="p">.</span><span class="nx">LoaderScene</span><span class="p">.</span><span class="nx">preload</span><span class="p">(</span><span class="nx">g_resources</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">director</span><span class="p">.</span><span class="nx">replaceScene</span><span class="p">(</span><span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">startScene</span><span class="p">());</span>
</span><span class='line'>        <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myApp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cocos2dApp</span><span class="p">(</span><span class="nx">HelloWorldScene</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>主要的功能都在cc.Application.extend中实现。首先config配置参数为document[&lsquo;ccConfig&rsquo;]
然后看ctor：（顾名思义：config to run 配置转为启动）以scene为参数的匿名函数，先调用_super()方法这个引擎方法进行初始化，然后指定startScene开始场景为scene。调试等级cc.COCOS2D_DEBUG为cocos2d.js中指定的调试等级，cc.initDebugSetting为初始化调试设置，cc.setup(this.config[&lsquo;tag&rsquo;])在名为tag的dom对象上创建cavas,cc.AppController.shareAppController().didFinishLaunchingWithOptions();这个是仿照cocos2d-iphone的函数命名的启动函数（顾名思义：就是启动结束会加载的函数）。</p>

<p>在正式进入写代码之前，稍等再看一下applicationDidFinishLaunching这个函数</p>

<p>先检查渲染是否支持，不支持就弹出“Browser doesn`t support WebGL”</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">if</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">RenderDoesnotSupport</span><span class="p">()){</span>
</span><span class='line'>    <span class="c1">//show Information to user</span>
</span><span class='line'>    <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Browser doesn&#39;t support WebGL&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>初始化director</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// initialize director</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">director</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Director</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>重置浏览器大小</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">cc</span><span class="p">.</span><span class="nx">EGLView</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">resizeWithBrowserSize</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'><span class="nx">cc</span><span class="p">.</span><span class="nx">EGLView</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">setDesignResolutionSize</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">RESOLUTION_POLICY</span><span class="p">.</span><span class="nx">SHOW_ALL</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>打开显卡FPS</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// turn on display FPS</span>
</span><span class='line'><span class="nx">director</span><span class="p">.</span><span class="nx">setDisplayStats</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">[</span><span class="s1">&#39;showFPS&#39;</span><span class="p">]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>默认设置fps为1秒60帧</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// set FPS. the default value is 1.0/60 if you don&#39;t call this</span>
</span><span class='line'><span class="nx">director</span><span class="p">.</span><span class="nx">setAnimationInterval</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">[</span><span class="s1">&#39;frameRate&#39;</span><span class="p">]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>导演类的replaceScene方法来替换场景为startScene</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//load resources</span>
</span><span class='line'><span class="nx">cc</span><span class="p">.</span><span class="nx">LoaderScene</span><span class="p">.</span><span class="nx">preload</span><span class="p">(</span><span class="nx">g_resources</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">director</span><span class="p">.</span><span class="nx">replaceScene</span><span class="p">(</span><span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">startScene</span><span class="p">());</span>
</span><span class='line'><span class="p">},</span> <span class="k">this</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>最后实例化app</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myApp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cocos2dApp</span><span class="p">(</span><span class="nx">HelloWorldScene</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<p>在正式步入工程文件之前，别急，创建一个src文件夹，然后在该文件夹下创建一个resource.js</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">s_HelloWorld</span> <span class="o">=</span> <span class="s2">&quot;res/HelloWorld.png&quot;</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">s_CloseNormal</span> <span class="o">=</span> <span class="s2">&quot;res/CloseNormal.png&quot;</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">s_CloseSelected</span> <span class="o">=</span> <span class="s2">&quot;res/CloseSelected.png&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">g_resources</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>    <span class="c1">//image</span>
</span><span class='line'>    <span class="p">{</span><span class="nx">src</span><span class="o">:</span><span class="nx">s_HelloWorld</span><span class="p">},</span>
</span><span class='line'>    <span class="p">{</span><span class="nx">src</span><span class="o">:</span><span class="nx">s_CloseNormal</span><span class="p">},</span>
</span><span class='line'>    <span class="p">{</span><span class="nx">src</span><span class="o">:</span><span class="nx">s_CloseSelected</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//plist</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//fnt</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//tmx</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//bgm</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//effect</span>
</span><span class='line'><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后在和src相同父目录下创建一个叫做res文件夹，把如下3个文件放入其中：</p>

<p>HelloWorld.png</p>

<p><img src="http://evoupsight.com/images/evoup/cocos2d-html5-res/HelloWorld.png" alt="Alt text" /></p>

<p>CloseNormal.png</p>

<p><img src="http://evoupsight.com/images/evoup/cocos2d-html5-res/CloseNormal.png" alt="Alt text" /></p>

<p>CloseSelected.png</p>

<p><img src="http://evoupsight.com/images/evoup/cocos2d-html5-res/CloseSelected.png" alt="Alt text" /></p>

<p>这就完成了资源文件的定义和提供。</p>

<hr />

<p>终于到工程主文件了，在src下创建一个叫做myApp.js的文件</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">Helloworld</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Layer</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">isMouseDown</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">helloImg</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">helloLabel</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">circle</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">sprite</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">init</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//////////////////////////////</span>
</span><span class='line'>        <span class="c1">// 1. super init first</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">/////////////////////////////</span>
</span><span class='line'>        <span class="c1">// 2. add a menu item with &quot;X&quot; image, which is clicked to quit the program</span>
</span><span class='line'>        <span class="c1">//    you may modify it.</span>
</span><span class='line'>        <span class="c1">// ask director the window size</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Director</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">getWinSize</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// add a &quot;close&quot; icon to exit the progress. it&#39;s an autorelease object</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">closeItem</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">MenuItemImage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
</span><span class='line'>            <span class="s2">&quot;res/CloseNormal.png&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;res/CloseSelected.png&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">history</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>            <span class="p">},</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">closeItem</span><span class="p">.</span><span class="nx">setAnchorPoint</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">menu</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Menu</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">closeItem</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">menu</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">menu</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">closeItem</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="nx">size</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">/////////////////////////////</span>
</span><span class='line'>        <span class="c1">// 3. add your codes below...</span>
</span><span class='line'>        <span class="c1">// add a label shows &quot;Hello World&quot;</span>
</span><span class='line'>        <span class="c1">// create and initialize a label</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">helloLabel</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">LabelTTF</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">,</span> <span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">// position the label on the center of the screen</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">helloLabel</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="nx">size</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">// add the label as a child to this layer</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">helloLabel</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">lazyLayer</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Layer</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">lazyLayer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// add &quot;HelloWorld&quot; splash screen&quot;</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Sprite</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;res/HelloWorld.png&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="nx">size</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">size</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">setScale</span><span class="p">(</span><span class="mf">0.5</span><span class="p">);</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">setRotation</span><span class="p">(</span><span class="mi">180</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">lazyLayer</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">rotateToA</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">RotateTo</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">scaleToA</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">ScaleTo</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">runAction</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">Sequence</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">rotateToA</span><span class="p">,</span> <span class="nx">scaleToA</span><span class="p">));</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">helloLabel</span><span class="p">.</span><span class="nx">runAction</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">Spawn</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">MoveBy</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">p</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">size</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">40</span><span class="p">)),</span><span class="nx">cc</span><span class="p">.</span><span class="nx">TintTo</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">0</span><span class="p">)));</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">setTouchEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="c1">// a selector callback</span>
</span><span class='line'>    <span class="nx">menuCloseCallback</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">sender</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">cc</span><span class="p">.</span><span class="nx">Director</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">end</span><span class="p">();</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">onTouchesBegan</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">touches</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">isMouseDown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">onTouchesMoved</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">touches</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isMouseDown</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nx">touches</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1">//this.circle.setPosition(touches[0].getLocation().x, touches[0].getLocation().y);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">onTouchesEnded</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">touches</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">isMouseDown</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">onTouchesCancelled</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">touches</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;onTouchesCancelled&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">HelloWorldScene</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Scene</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">onEnter</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">layer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Helloworld</span><span class="p">();</span>
</span><span class='line'>        <span class="nx">layer</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">layer</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h4>分析</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">isMouseDown</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'><span class="nx">helloImg</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
</span><span class='line'><span class="nx">helloLabel</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
</span><span class='line'><span class="nx">circle</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
</span><span class='line'><span class="nx">sprite</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
</span></code></pre></td></tr></table></div></figure>


<p>这是对接下来用到的成员变量的定义</p>

<p>再看接下来的代码</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">init</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//首先初始化超类</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//获取屏宽</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Director</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">getWinSize</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//添加一个关闭按钮到菜单项</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">closeItem</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">MenuItemImage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
</span><span class='line'>        <span class="s2">&quot;res/CloseNormal.png&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;res/CloseSelected.png&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">history</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>        <span class="p">},</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//设置锚点，默认就是0.5，0.5</span>
</span><span class='line'>    <span class="nx">closeItem</span><span class="p">.</span><span class="nx">setAnchorPoint</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//创建关闭按钮</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">menu</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Menu</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">closeItem</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//设置菜单项位置</span>
</span><span class='line'>    <span class="nx">menu</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//添加菜单项到当前层上</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">menu</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//设置菜单的位置为屏幕右下角</span>
</span><span class='line'>    <span class="nx">closeItem</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="nx">size</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//创建一个叫做helloworld的文本标签</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">helloLabel</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">LabelTTF</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">,</span> <span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//把文本标签放到屏幕中央位置</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">helloLabel</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="nx">size</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//添加该文本标签放到当前层上</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">helloLabel</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//创建一个新层lazylay并放入当前层</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">lazyLayer</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Layer</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">lazyLayer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 添加一个能旋转的helloworld精灵</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Sprite</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;res/HelloWorld.png&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="nx">size</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">size</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//先缩小50%且倒过来</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">setScale</span><span class="p">(</span><span class="mf">0.5</span><span class="p">);</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">setRotation</span><span class="p">(</span><span class="mi">180</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//添加到lazyLayer层</span>
</span><span class='line'>    <span class="nx">lazyLayer</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//定义2个动作分别为旋转2秒到0度和缩放2秒无x轴y轴缩放</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">rotateToA</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">RotateTo</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">scaleToA</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">ScaleTo</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//让helloworld精灵依次运行这2个动作</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">runAction</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">Sequence</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">rotateToA</span><span class="p">,</span> <span class="nx">scaleToA</span><span class="p">));</span>
</span><span class='line'>    <span class="c1">//使文本标签同时运行ccMoveBy动作（后面讲）和CCTintTo动作（使文字）</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">helloLabel</span><span class="p">.</span><span class="nx">runAction</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">Spawn</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">MoveBy</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">p</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">size</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">40</span><span class="p">)),</span><span class="nx">cc</span><span class="p">.</span><span class="nx">TintTo</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">0</span><span class="p">)));</span>
</span><span class='line'>    <span class="c1">//设置为支持触碰</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">setTouchEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p>需要注意的是
1) cc.Sequence代表依次运行动作，而cc.Spawn代表同时运行动作
2) CCMoveTo是“移动到这里”；而CCMoveBy则是“相对于之前点再移动”，比如说说这里需要两个坐标pos1（x1，y1），pos2（x2，y2），用CCMoveTo的话，就是将对象由pos1移动到pos2，而CCMOveBy则是对象的终坐标是在pos1的基础上再加上（矢量相加）pos2，终坐标pos3=pos1+pos2。</p>

<p>接下来是一些触碰事件的回调函数</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//点击关闭按钮的回调函数，退出实例</span>
</span><span class='line'><span class="nx">menuCloseCallback</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">sender</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">cc</span><span class="p">.</span><span class="nx">Director</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">end</span><span class="p">();</span>
</span><span class='line'><span class="p">},</span>
</span><span class='line'><span class="c1">//按下按钮的状态</span>
</span><span class='line'><span class="nx">onTouchesBegan</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">touches</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">isMouseDown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="p">},</span>
</span><span class='line'><span class="c1">//按下按钮移动时</span>
</span><span class='line'><span class="nx">onTouchesMoved</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">touches</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isMouseDown</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">touches</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">//this.circle.setPosition(touches[0].getLocation().x, touches[0].getLocation().y);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">},</span>
</span><span class='line'><span class="c1">//放开按钮的状态</span>
</span><span class='line'><span class="nx">onTouchesEnded</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">touches</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">isMouseDown</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'><span class="p">},</span>
</span><span class='line'><span class="c1">//离开按钮的状态</span>
</span><span class='line'><span class="nx">onTouchesCancelled</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">touches</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;onTouchesCancelled&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>最后</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">HelloWorldScene</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Scene</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">onEnter</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">layer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Helloworld</span><span class="p">();</span>
</span><span class='line'>        <span class="nx">layer</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">layer</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>进入了之后就把这个layer再加载到场景上，初步分析终了，等完成一个项目之后再来接着写点东西。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Win7上Android模拟器上安装apk软件]]></title>
    <link href="http://evoupsight.com/blog/2014/01/20/win7-install-apk-on-android-emulator/"/>
    <updated>2014-01-20T14:56:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/01/20/win7-install-apk-on-android-emulator</id>
    <content type="html"><![CDATA[<h3>前提</h3>

<p>在android模拟器上安装apk文件（android安装包）很简单,要求2个前提：</p>

<pre><code>    1）已经安装好了ADK（android sdk）

    2）配置好virtual device
</code></pre>

<!-- more -->


<h3>准备工作</h3>

<p>假设您已经安装好了ADK，运行Eclipse选择Window菜单：</p>

<p><img src="http://evoupsight.com/images/evoup/android_emulator_install_apk_first.png" alt="Alt text" /></p>

<p>选择下方的Android Virtual Device Manager->new,我们创建一个android2.2的通用虚拟设备，屏幕选最小的我这里方便截图（一般会选择3.7WVGA,后期根据自己的需要可以做任意选择），然后取名这个模拟器为testAVD。</p>

<p><img src="http://evoupsight.com/images/evoup/android_emulator_create_new_one.png" alt="Alt text" /></p>

<p>点击OK完成，然后选择testAVD并Start启动模拟器，然后选择launch。第一次启动很慢，至于到底需要多少时间取决于机器的性能。</p>

<p><img src="http://evoupsight.com/images/evoup/android_emulator_starting.png" alt="Alt text" /></p>

<p>这样就算进去了</p>

<p><img src="http://evoupsight.com/images/evoup/android_emulator_entered.png" alt="Alt text" /></p>

<h3>安装apk</h3>

<p>进入ADK的platform_tools目录下，运行<code>adb install apk文件</code>就可以完成安装。</p>

<p>以安装微信安卓版本为例，假设我下载到了C:\weixin510android360.apk</p>

<p><img src="http://evoupsight.com/images/evoup/android_emulator_entered.png" alt="Alt text" /></p>

<p>我这里比较慢，可能是因为选择的模拟器内存参数没有调大导致的。</p>

<p><img src="http://evoupsight.com/images/evoup/android_emulator_install_apk.png" alt="Alt text" /></p>

<p>等待安装完成吧</p>

<p><img src="http://evoupsight.com/images/evoup/android_emulator_install_apk_done.png" alt="Alt text" /></p>

<p><img src="http://evoupsight.com/images/evoup/android_emulator_install_apk_done2.png" alt="Alt text" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[android webview helloworld分析]]></title>
    <link href="http://evoupsight.com/blog/2014/01/19/android-webview-helloworld/"/>
    <updated>2014-01-19T17:05:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/01/19/android-webview-helloworld</id>
    <content type="html"><![CDATA[<h3>加载示例代码</h3>

<p>官方示例代码
<a href="https://code.google.com/p/apps-for-android/source/browse/#git%2FSamples%2FWebViewDemo">https://code.google.com/p/apps-for-android/source/browse/#git%2FSamples%2FWebViewDemo</a></p>

<p>运行Eclipse(本文提到的eclipse版本是Eclipse ide for java developer KEPLER)，选择File->Import&hellip;&ndash;>Android->Existing Android Code Into Workspace,Next，在Root Directory中选择解压的目录下的Samples文件夹下的WebViewDemo。</p>

<p>如果直接run，会出现错误<code>Project has no project.properties file! Edit the project properties to set one.</code>。
这时只要右键项目属性properties &ndash;> android &ndash;> Project Build Target 把里面的Androidx.x改为对应的google APIs版本。google APIs是android apis的超集，Android只是其中一个用于移动设备的OS，可以有限的调用一些google api。</p>

<h3>分析app部分代码</h3>

<p>请看示例java代码</p>

<!-- more -->




<figure class='code'><figcaption><span>WebViewDemo.java </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">webviewdemo</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.os.Handler</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.webkit.JsResult</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.webkit.WebChromeClient</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.webkit.WebSettings</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.webkit.WebView</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Demonstrates how to embed a WebView in your activity. Also demonstrates how</span>
</span><span class='line'><span class="cm"> * to have javascript in the WebView call into the activity, and how the activity </span>
</span><span class='line'><span class="cm"> * can invoke javascript.</span>
</span><span class='line'><span class="cm"> * &lt;p&gt;</span>
</span><span class='line'><span class="cm"> * In this example, clicking on the android in the WebView will result in a call into</span>
</span><span class='line'><span class="cm"> * the activities code in {@link DemoJavaScriptInterface#clickOnAndroid()}. This code</span>
</span><span class='line'><span class="cm"> * will turn around and invoke javascript using the {@link WebView#loadUrl(String)}</span>
</span><span class='line'><span class="cm"> * method.</span>
</span><span class='line'><span class="cm"> * &lt;p&gt;</span>
</span><span class='line'><span class="cm"> * Obviously all of this could have been accomplished without calling into the activity</span>
</span><span class='line'><span class="cm"> * and then back into javascript, but this code is intended to show how to set up the </span>
</span><span class='line'><span class="cm"> * code paths for this sort of communication.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebViewDemo</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">LOG_TAG</span> <span class="o">=</span> <span class="s">&quot;WebViewDemo&quot;</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">WebView</span> <span class="n">mWebView</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Handler</span> <span class="n">mHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">icicle</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">icicle</span><span class="o">);</span>
</span><span class='line'>        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">main</span><span class="o">);</span>
</span><span class='line'>        <span class="n">mWebView</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">webview</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">WebSettings</span> <span class="n">webSettings</span> <span class="o">=</span> <span class="n">mWebView</span><span class="o">.</span><span class="na">getSettings</span><span class="o">();</span>
</span><span class='line'>        <span class="n">webSettings</span><span class="o">.</span><span class="na">setSavePassword</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>        <span class="n">webSettings</span><span class="o">.</span><span class="na">setSaveFormData</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>        <span class="n">webSettings</span><span class="o">.</span><span class="na">setJavaScriptEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>        <span class="n">webSettings</span><span class="o">.</span><span class="na">setSupportZoom</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">mWebView</span><span class="o">.</span><span class="na">setWebChromeClient</span><span class="o">(</span><span class="k">new</span> <span class="n">MyWebChromeClient</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">mWebView</span><span class="o">.</span><span class="na">addJavascriptInterface</span><span class="o">(</span><span class="k">new</span> <span class="n">DemoJavaScriptInterface</span><span class="o">(),</span> <span class="s">&quot;demo&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">mWebView</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="s">&quot;file:///android_asset/demo.html&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">final</span> <span class="kd">class</span> <span class="nc">DemoJavaScriptInterface</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">DemoJavaScriptInterface</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/**</span>
</span><span class='line'><span class="cm">         * This is not called on the UI thread. Post a runnable to invoke</span>
</span><span class='line'><span class="cm">         * loadUrl on the UI thread.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clickOnAndroid</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">mHandler</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">mWebView</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="s">&quot;javascript:wave()&quot;</span><span class="o">);</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">});</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Provides a hook for calling &quot;alert&quot; from javascript. Useful for</span>
</span><span class='line'><span class="cm">     * debugging your javascript.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MyWebChromeClient</span> <span class="kd">extends</span> <span class="n">WebChromeClient</span> <span class="o">{</span>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onJsAlert</span><span class="o">(</span><span class="n">WebView</span> <span class="n">view</span><span class="o">,</span> <span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">,</span> <span class="n">JsResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">LOG_TAG</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>            <span class="n">result</span><span class="o">.</span><span class="na">confirm</span><span class="o">();</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>首先需要搞懂Activity这个核心概念，基本上是进行android的活动对象事件调度的类，我们看一下android api中的activity的生命周期：</p>

<p><img src="http://evoupsight.com/images/evoup/activity_lifecycle.png" alt="Alt text" /></p>

<p>它有以下7个方法可以被重写：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Activity</span> <span class="kd">extends</span> <span class="n">ApplicationContext</span> <span class="o">{</span>
</span><span class='line'>       <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>       <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onStart</span><span class="o">();</span>
</span><span class='line'>       <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onRestart</span><span class="o">();</span>
</span><span class='line'>       <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">();</span>
</span><span class='line'>       <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">();</span>
</span><span class='line'>       <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onStop</span><span class="o">();</span>
</span><span class='line'>       <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">();</span>
</span><span class='line'>   <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>也就是onCreate创建，onStart开始、onRestart重启、onResume恢复、onPause暂停、onStop停止和onDestory销毁时，这些方法都能够被重写，不难看出这些方法和Activity生命周期是息息相关的。
本例子就只要重写onCreate即可，看代码：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">icicle</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">icicle</span><span class="o">);</span>
</span><span class='line'>    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">main</span><span class="o">);</span>
</span><span class='line'>    <span class="n">mWebView</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">webview</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">WebSettings</span> <span class="n">webSettings</span> <span class="o">=</span> <span class="n">mWebView</span><span class="o">.</span><span class="na">getSettings</span><span class="o">();</span>
</span><span class='line'>    <span class="n">webSettings</span><span class="o">.</span><span class="na">setSavePassword</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>  
</span><span class='line'>    <span class="n">webSettings</span><span class="o">.</span><span class="na">setSaveFormData</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>    <span class="n">webSettings</span><span class="o">.</span><span class="na">setJavaScriptEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>    <span class="n">webSettings</span><span class="o">.</span><span class="na">setSupportZoom</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">mWebView</span><span class="o">.</span><span class="na">setWebChromeClient</span><span class="o">(</span><span class="k">new</span> <span class="n">MyWebChromeClient</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">mWebView</span><span class="o">.</span><span class="na">addJavascriptInterface</span><span class="o">(</span><span class="k">new</span> <span class="n">DemoJavaScriptInterface</span><span class="o">(),</span> <span class="s">&quot;demo&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">mWebView</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="s">&quot;file:///android_asset/demo.html&quot;</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>其中R.java这个为android的资源类，工程自动会维护这里暂时不用去考虑。首先是调用超类的onCreate方法来必要的初始化。然后设置试图为资源类的main。再来从资源类的webview中找到Id返回WebView类型的对象mWebView这个变量中。然后是WebSettings类对象webSettings的参数设置，这里setSavePassword和setSaveFormData代表不要保存表单控件的数据和密码，setJavaScriptEnabled设置为允许webview调用JavaScript，setSupportZoom设置为不允许缩放。由于要用到JavaScript，所以需要调用setWebChromeClient。</p>

<p>我们需要仔细看下addJavascriptInterface这个函数的说明</p>

<blockquote><p>Injects the supplied Java object into this WebView. The object is injected into the JavaScript context of the main frame, using the supplied name. This allows the Java object&rsquo;s methods to be accessed from JavaScript. For applications targeted to API level JELLY_BEAN_MR1 and above, only public methods that are annotated with JavascriptInterface can be accessed from JavaScript. For applications targeted to API level JELLY_BEAN or below, all public methods (including the inherited ones) can be accessed, see the important security note below for implications.</p></blockquote>

<p>我给翻译了下：它注入提供的Java对象到这个WebView。对象使用提供的名字注入JavaScript上下文的主要框架。这允许从JavaScript访问Java对象的方法。针对应用程序API级别在JELLY_BEAN_MR1以上的,只有JavascriptInterface的公共方法与注释可以从JavaScript访问。针对应用程序API级别或低于JELLY_BEAN的,所有公共方法(包括继承的)可以访问,参见下面重要的安全注意影响。</p>

<p>再看下2个参数，前一个为注入webview的Java对象（DemoJavaScriptInterface），后一个为暴露给JavaScript的对象名字（demo），本例中除了webview把点击消息传递给html，html中的JavaScript也要和webview交互，在哪里交互？伟大的google为我们想到JavaScript的顶层window对象，在下面动态创建了一个子对象，这里就是第二个参数demo，这个等等到了html再讲。</p>

<p>马上来看第一个参数的实现</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">final</span> <span class="kd">class</span> <span class="nc">DemoJavaScriptInterface</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">DemoJavaScriptInterface</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * This is not called on the UI thread. Post a runnable to invoke</span>
</span><span class='line'><span class="cm">     * loadUrl on the UI thread.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clickOnAndroid</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">mHandler</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">mWebView</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="s">&quot;javascript:wave()&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>直接一个构造函数什么都不做，然后直接用句柄提交实现了Runnable类的引用，再深入Runnable探究下</p>

<blockquote><p>The Runnable interface should be implemented by any class whose instances are intended to be executed by a thread. The class must define a method of no arguments called run.</p></blockquote>

<p>Runnable就一个方法，run给实现了就行，这里是直接调用demo.html页面里的JavaScript的wave方法。</p>

<p>看下一段代码</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Provides a hook for calling &quot;alert&quot; from javascript. Useful for</span>
</span><span class='line'><span class="cm"> * debugging your javascript.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">final</span> <span class="kd">class</span> <span class="nc">MyWebChromeClient</span> <span class="kd">extends</span> <span class="n">WebChromeClient</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onJsAlert</span><span class="o">(</span><span class="n">WebView</span> <span class="n">view</span><span class="o">,</span> <span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">,</span> <span class="n">JsResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">LOG_TAG</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>        <span class="n">result</span><span class="o">.</span><span class="na">confirm</span><span class="o">();</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里是对刚才指定的WebChromeClient对象MyWebChromeClient，进行onJsAlert的重写，可以看到其实就是在打印日志。</p>

<hr />

<h3>分析html部分代码</h3>

<p>app代码完了，再来看html</p>

<figure class='code'><figcaption><span>demo.html </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">language=</span><span class="s">&quot;javascript&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="cm">/* This function is invoked by the activity */</span>
</span><span class='line'>      <span class="kd">function</span> <span class="nx">wave</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;droid&quot;</span><span class="p">).</span><span class="nx">src</span><span class="o">=</span><span class="s2">&quot;android_waving.png&quot;</span><span class="p">;</span>
</span><span class='line'>          <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'>      <span class="c">&lt;!-- Calls into the javascript interface for the activity --&gt;</span>
</span><span class='line'>      <span class="nt">&lt;a</span> <span class="na">onClick=</span><span class="s">&quot;window.demo.clickOnAndroid()&quot;</span><span class="nt">&gt;&lt;div</span> <span class="na">style=</span><span class="s">&quot;width:80px;</span>
</span><span class='line'><span class="s">          margin:0px auto;</span>
</span><span class='line'><span class="s">          padding:10px;</span>
</span><span class='line'><span class="s">          text-align:center;</span>
</span><span class='line'><span class="s">          border:2px solid #202020;&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>              <span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">&quot;droid&quot;</span> <span class="na">src=</span><span class="s">&quot;android_normal.png&quot;</span><span class="nt">/&gt;&lt;br&gt;</span>
</span><span class='line'>              Click me!
</span><span class='line'>      <span class="nt">&lt;/div&gt;&lt;/a&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>注意看window.demo.clickOnAndroid这个JavaScript方法，刚刚我们在app代码里用addJavascriptInterface方法生成好了一个window.demo对象，就是通过这个对象，就可以调用app内置方法来实现网页的跳转。</p>

<h4>小结</h4>

<p>到此程序分析完毕,整个交互过程还是比较容易理解，就是先继承一个Activity类，关联好html页面，实现onCreate方法，在其中指定好app方法以及为javascript暴露对象名，然后进入html调用暴露的对象名及其方法进行跳转。</p>

<hr />

<p>最后，打开应用程序，它看起来应该像这样:)</p>

<p><img src="http://evoupsight.com/images/evoup/android_webview_sample.png" alt="Alt text" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Win7 Android开发环境搭建]]></title>
    <link href="http://evoupsight.com/blog/2014/01/17/android-adt-development-deloy/"/>
    <updated>2014-01-17T17:48:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/01/17/android-adt-development-deloy</id>
    <content type="html"><![CDATA[<p>最近有个HTML5的项目需要部署在android里，先研究下基本功，安装时还是遇到一些问题，如有的文章过时了，自己连搜索测试带整理写了一片文章备查。</p>

<!-- more -->


<h3>一、安装JDK</h3>

<p>安装JDK，我这里的windows7平台，先下载jdk7，然后安装，我的安装路径为C:\Program Files\Java\jdk1.7.0_25\。
安装完成后设置环境变量
开始->搜索程序和文件输入环境变量->编辑系统环境变量->添加以下环境变量：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>JAVA_HOME值为：C:<span class="se">\P</span>rogram Files<span class="se">\J</span>ava<span class="se">\j</span>dk1.7.0_25<span class="se">\</span>
</span><span class='line'>CLASSPATH值为：.;%JAVA_HOME%<span class="se">\l</span>ib<span class="se">\t</span>ools.jar;%JAVA_HOME%<span class="se">\l</span>ib<span class="se">\d</span>t.jar;%JAVA_HOME%<span class="se">\b</span>in;
</span><span class='line'>PATH值为：追加%JAVA_HOME%<span class="se">\b</span>in;
</span></code></pre></td></tr></table></div></figure>


<h3>二、安装Eclipse</h3>

<p>可以直接去www.eclipse.org下载，64位Windows平台下的下载地址：</p>

<p><a href="http://mirror.bit.edu.cn/eclipse/technology/epp/downloads/release/kepler/SR1/eclipse-cpp-kepler-SR1-win32-x86_64.zip">http://mirror.bit.edu.cn/eclipse/technology/epp/downloads/release/kepler/SR1/eclipse-cpp-kepler-SR1-win32-x86_64.zip</a></p>

<p>下载完成解压即可使用。见下图：
<img src="http://evoupsight.com/images/evoup/eclipse_dir.png" alt="Alt text" /></p>

<h3>三、安装SDK</h3>

<p>首先去下载SDK,这个是等等用来和eclipse的adt插件关联的。</p>

<p>  下载地址如下：
  <a href="http://dl.google.com/android/adt/adt-bundle-windows-x86_64-20131030.zip">http://dl.google.com/android/adt/adt-bundle-windows-x86_64-20131030.zip</a></p>

<p>下载完成后我把它解压到C:\android\adt-bundle-windows-x86_64-20131030,运行adt-bundle-windows-x86_64-20131030下的SDK Manager.exe，勾选几个必要的API版本，Android4.2.2(API17)还有Android2.2(API8)，然后点击Install 11 package开始安装</p>

<p><img src="http://evoupsight.com/images/evoup/adt_wait.png" alt="Alt text" /></p>

<p>如果速度慢，可以尝试用goagent代理进行加速,这里就提一下而以。</p>

<p><img src="http://evoupsight.com/images/evoup/adt_use_proxy.png" alt="Alt text" /></p>

<p>等待下载完成</p>

<p><img src="http://evoupsight.com/images/evoup/adt_done.png" alt="Alt text" /></p>

<h3>SDK配置</h3>

<p>接着把tools的路径C:\android\adt-bundle-windows-x86_64-20131030\sdk\tools追加到环境变量PATH中去。
要测试安装sdk是否成功，只需要运行cmd，然后输入</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>android -h
</span></code></pre></td></tr></table></div></figure>


<p>观察是否有输出正常信息，见下图：
<img src="http://evoupsight.com/images/evoup/adt_installed.png" alt="Alt text" /></p>

<p>有其他教程说要设置SDK Location变量，我配置时发现其实不需要，估计是老版本了。</p>

<h3>Eclipse的ADT Package安装</h3>

<p>打开Eclipse，指定好工程的位置</p>

<p><img src="http://evoupsight.com/images/evoup/adt_project_dir.png" alt="Alt text" /></p>

<p>选择 Help &lt; Install New Software 菜单。点击右上角的 Add 按钮，弹出 Add Repository 对话框，在 Name 一栏填写：“ADT Plugin”，在 Location 一栏填写：<a href="https://dl-ssl.google.com/android/eclipse/">https://dl-ssl.google.com/android/eclipse/</a></p>

<p>点击 OK。如果不能获取插件信息，就把 https 换成 http 试试。</p>

<p>然后整个勾选Developer Tools（最小安装的话至少要选择其下Android DDMS和Android Development Tools），点击Next，一路接受条款，等待安装插件完毕,中途可能出现安装警告，确认即可。</p>

<p><img src="http://evoupsight.com/images/evoup/eclipse_adt_warning.png" alt="Alt text" /></p>

<p>之后重启Eclipse。</p>

<h3>Eclipse的ADT插件的配置</h3>

<p>安装完ADT插件并重启好Eclipse后，点击 Window &lt; Preferences 菜单，点击左侧菜单中的 Android，再点击右侧 Browse&hellip;，选择第3步中Android SDK的安装目录，设置完成后，点击 OK。</p>

<p><img src="http://evoupsight.com/images/evoup/eclipse_adt_config.png" alt="Alt text" /></p>

<p>这样 Android 开发环境就搭建好了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[git clone失败警告unprotected private key file]]></title>
    <link href="http://evoupsight.com/blog/2014/01/16/git-clone-fail-cause-unprotected-private-key-file/"/>
    <updated>2014-01-16T23:41:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/01/16/git-clone-fail-cause-unprotected-private-key-file</id>
    <content type="html"><![CDATA[<h3>起因</h3>

<p>今天在clone项目的时候发生了很奇怪的错误，而且居然是有的项目可以clone，有的不行，都是git协议。错误如下：</p>

<!-- more -->


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>git clone git@github.com:someone/case.git
</span><span class='line'>Cloning into <span class="s1">&#39;case&#39;</span>...
</span><span class='line'>Warning: Permanently added the RSA host key <span class="k">for </span>IP address <span class="s1">&#39;192.30.252.129&#39;</span> to t
</span><span class='line'>he list of known hosts.
</span><span class='line'>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
</span><span class='line'>@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @
</span><span class='line'>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
</span><span class='line'>Permissions 0644 <span class="k">for</span> <span class="s1">&#39;/c/Users/Administrator/.ssh/id_rsa&#39;</span> are too open.
</span><span class='line'>It is recommended that your private key files are NOT accessible by others.
</span><span class='line'>This private key will be ignored.
</span><span class='line'>bad permissions: ignore key: /c/Users/Administrator/.ssh/id_rsa
</span><span class='line'>Permission denied <span class="o">(</span>publickey<span class="o">)</span>.
</span><span class='line'>fatal: Could not <span class="nb">read </span>from remote repository.
</span><span class='line'>
</span><span class='line'>Please make sure you have the correct access rights
</span><span class='line'>and the repository exists.
</span></code></pre></td></tr></table></div></figure>


<h3>排查</h3>

<p>显示是私钥权限不正确导致的，然后定位到git-bash所使用的sh.exe程序，用管理员模式运行</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>chmod 0600 /c/Users/Administrator/.ssh/id_rsa
</span></code></pre></td></tr></table></div></figure>


<p>尝试几次都没法收回group和other的r权限（r+w+rw=2<sup>2</sup>+2<sup>1</sup>+2<sup>0</sup>，我这里是4，2<sup>2</sup>所以是r）
最后发现是因为装git windows的时候选择了第一种方式和cygwin正好冲突了，如果装了cygwin的基础上再安装git windows要在git windows的安装选项里选第二种方式；还有一种可能是和tortoise git冲突了，尚未确认。
最后删除cygwin重装git-bash可以正常clone了。</p>

<h3>延伸</h3>

<p>git windows还有第三种安装方式，第三种比较危险，会覆盖windows指令，一般不采取，如果以后不打算用cygwin的话，直接第一种方式安装就可以了。</p>

<p>附：正常的权限掩码，来自一台freebsd</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>-rw-r--r--   authorized_keys
</span><span class='line'>-rw-------   config
</span><span class='line'>-rw-------   id_dsa
</span><span class='line'>-rw-------   id_dsa.pub
</span><span class='line'>-rw-------   id_rsa
</span><span class='line'>-rw-r--r--   id_rsa.pub
</span><span class='line'>-rw-------   known_hosts
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[cocos2d-x初心者阶段学习之一]]></title>
    <link href="http://evoupsight.com/blog/2014/01/14/cocos2d-x-v2.2-newbie-learning-note-1/"/>
    <updated>2014-01-14T14:24:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/01/14/cocos2d-x-v2.2-newbie-learning-note-1</id>
    <content type="html"><![CDATA[<h3>序言</h3>

<p>通过一个阶段的cocos2d-iphone的学习，对Objective-C（以下简称oc）做到基本了解，也有一个游戏小demo。但在摸索的过程中，发现这门语言稍让人感觉不爽的是oc里实例变量的绑定，除此之外oc基本上是一门比较优雅的语言。试水已经告捷，考虑到市面上大多采用cocos2d-x，还有cocostudio这一套的东西，应该是时候投入该框架的学习。</p>

<!-- more -->


<h5>本文参考</h5>

<p><a href="http://www.raywenderlich.com/33752/cocos2d-x-tutorial-for-ios-and-android-space-game">http://www.raywenderlich.com/33752/cocos2d-x-tutorial-for-ios-and-android-space-game</a></p>

<p>我这里不同的是在windows环境下编译win32项目，使用vc2010+cocos2d-x2.2.2开发，然后动手术加载一个飞船。</p>

<h3>加载精灵</h3>

<h4>准备工作</h4>

<p>首先需要把精灵对应的资源文件，也就是图片ccz和plist文件，这里是Sprites.plist和Sprites.pvr.ccz
然后创建出一个HelloWorld项目，然后进入vc2010后，双击HelloWorldScene.h进入加一个精灵。
可以看到有pvr.ccz文件，这是texturepacker产生的文件，这个先了解一下，就目前来说，只要知道是pvr.ccz是打包后的图片资源就可以了。
然后把资源拷贝到Resources文件夹里去，如果项目里没有，可以右键，新建筛选器，然后制定其名字为Resources。
（但是在项目管理器里无法看到，如何添加？TODO）</p>

<h4>添加代码</h4>

<p>在头文件中添加</p>

<figure class='code'><figcaption><span>HelloWorldScene.h </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="k">private</span><span class="o">:</span>
</span><span class='line'>  <span class="n">cocos2d</span><span class="o">::</span><span class="n">CCSpriteBatchNode</span> <span class="o">*</span> <span class="n">_batchNode</span><span class="p">;</span>
</span><span class='line'>  <span class="n">cocos2d</span><span class="o">::</span><span class="n">CCSprite</span> <span class="o">*</span> <span class="n">_ship</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>为什么需要2行代码？因为一个是批渲染对象，用来涵盖全部用到的资源，以及对应的区块坐标关系（补一句：具体的坐标可以通过用vim等文本编辑器查看plist文件得知，当然更专业的方式是采用接下来会提到的texturepacker这个工具直接查看和编辑）；另外一个是实际我们需要的精灵。</p>

<p>然后切换到源文件HelloWorldScene.cpp在init方法中添加如下代码：</p>

<figure class='code'><figcaption><span>HelloWorldScene.cpp </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="n">_batchNode</span> <span class="o">=</span> <span class="n">CCSpriteBatchNode</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;Sprites.pvr.ccz&quot;</span><span class="p">);</span>
</span><span class='line'><span class="k">this</span><span class="o">-&gt;</span><span class="n">addChild</span><span class="p">(</span><span class="n">_batchNode</span><span class="p">);</span>
</span><span class='line'><span class="n">CCSpriteFrameCache</span><span class="o">::</span><span class="n">sharedSpriteFrameCache</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">addSpriteFramesWithFile</span><span class="p">(</span><span class="s">&quot;Sprites.plist&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">_ship</span> <span class="o">=</span> <span class="n">CCSprite</span><span class="o">::</span><span class="n">createWithSpriteFrameName</span><span class="p">(</span><span class="s">&quot;SpaceFlier_sm_1.png&quot;</span><span class="p">);</span>
</span><span class='line'><span class="n">CCSize</span> <span class="n">winSize</span> <span class="o">=</span> <span class="n">CCDirector</span><span class="o">::</span><span class="n">sharedDirector</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getWinSize</span><span class="p">();</span>
</span><span class='line'><span class="n">_ship</span><span class="o">-&gt;</span><span class="n">setPosition</span><span class="p">(</span><span class="n">ccp</span><span class="p">(</span><span class="n">winSize</span><span class="p">.</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">winSize</span><span class="p">.</span><span class="n">height</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">));</span>
</span><span class='line'><span class="n">_batchNode</span><span class="o">-&gt;</span><span class="n">addChild</span><span class="p">(</span><span class="n">_ship</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>简单的分析</h4>

<p>按流程分析下吧，内存稍微提一下。
首先是获得一个CCSpriteBatchNode的批节点的指针，这一步其实已经把资源加载到了内存中了。
addChild把批节点加载到了类所指代的CCLayer层，需要注意this指针，在oc里就是self，指向的类是HelloWorld,继承自CCLayer。
接着，确定帧和帧缓冲的关系，通过用addSpriteFramesWithFile函数读取plist文件来实现。
然后调用CCSprite::createWithSpriteFrameName方法，通过阅读其方法的源代码，其实是在CCSpriteFrameCache中寻找FrameName，如果找到了就返回那个CCSprite，而在实际上精灵已经加载到了内存中了，方法的最后返回CCSprite指针，就是飞船精灵了。
只差一步，就可以显示飞船了，使用getWinSize获取屏幕分辨率。然后用setPosition设置飞船精灵的位置，最后用批节点的addChild把它显示出来，后面的参数1代表的是Z深度,数字越大显示在遮挡关系的越上部分。</p>

<h4>编译看结果</h4>

<p>可以看到，除了cocos2d-x默认GUI一个椰子头背景和右下角的关闭按钮之外，画面上还多了一艘太空飞船，目的达成。下篇学习如何移动和发射子弹。</p>

<p><img src="http://evoupsight.com/images/evoup/cocos2d-x_addsprite.png" alt="Alt text" /></p>

<h4>参考阅读</h4>

<p><a href="http://www.cocos2d-x.org/wiki/Chapter_2_-_How_to_Add_a_sprite">http://www.cocos2d-x.org/wiki/Chapter_2_-_How_to_Add_a_sprite</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[win7上搭建cocos2d-x2.2.2开发环境]]></title>
    <link href="http://evoupsight.com/blog/2014/01/13/win7-install-cocos2d-x2-dot-2-2/"/>
    <updated>2014-01-13T00:25:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/01/13/win7-install-cocos2d-x2-dot-2-2</id>
    <content type="html"><![CDATA[<p>在win7上搭建cocos2d-x的开发环境，主要用到的开发IDE为visual C++2010，为什么不再使用vc6？第一，cocos2d-x本身不支持。第二，支持C++0x的特性。对于现代游戏游戏引擎来说，这是必要的。安装vc
2010这里就不再讨论。</p>

<!-- more -->


<p>直接讲如何进行cocos2d-x的编译了。</p>

<h3>1）下载</h3>

<p>首先当然是要去下载，我这里是cocos2d-x2.2.2版本，下载cocos2d-x2.2.2.zip。这个版本和《cocos2d-x权威指南》有什么关联度的等等研究了就不得而知了。</p>

<h3>2）解压和编译cocos2d-x</h3>

<p>接下来是解压,注意不要解压到中文目录，否则接下来生成项目会报错。我解压到了D:\gamedev\cocos2d-x-2.2.2\cocos2d-x-2.2.2。随后进入cocos2d-x2.2.2文件夹下的cocos2d-x2.2.2文件夹。因为我们是使用vc2010，所以就双击cocos2d-win32.vc2010.sln。
进到IDE之后，选择解决方案资源管理器下的cocos2d-win32.vc2010,右击选择配置属性-配置，确保每个项目都为debug，可以看到共有17个项目。然后按下F7开始生成解决方案。
慢慢等，我是等来10来分钟。可以看到17个项目都生成成功了。</p>

<h3>3）创建工程</h3>

<p>编译完了就可以创建工程了。当然需要先安装好python，我这里是python2.6.2，有人说要装python2.7，看来并不是必须。然后我们生成工程，运行</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd </span>D:<span class="se">\g</span>amedev<span class="se">\c</span>ocos2d-x-2.2.2<span class="se">\c</span>ocos2d-x-2.2.2<span class="se">\t</span>ools<span class="se">\p</span>roject-creator<span class="se">\</span>
</span><span class='line'>create_project.py -project HelloWorld -package com.cocos2d-x.org -language cpp
</span></code></pre></td></tr></table></div></figure>


<p>其中com.cocos2d-x.org是为android项目分配的包名称。运行完毕后，会在D:\gamedev\cocos2d-x-2.2.2\cocos2d-x-2.2.2\project目录下生成ios、android、win32、mac、linux等各种平台的项目。</p>

<h3>4）编译工程</h3>

<p>最后进入刚刚取名为HelloWorld的项目中</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd </span>D:<span class="se">\g</span>amedev<span class="se">\c</span>ocos2d-x-2.2.2<span class="se">\c</span>ocos2d-x-2.2.2<span class="se">\p</span>rojects/HelloWorld
</span></code></pre></td></tr></table></div></figure>


<p>双击proj.win32下的HelloWorld.sln文件，即可进入工程，没有什么问题的话，就可以按ctrl+F5开始进行项目的调试了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[freebsd上手动编译boost的boost-regex库]]></title>
    <link href="http://evoupsight.com/blog/2014/01/09/freebsd-install-boost-for-regex/"/>
    <updated>2014-01-09T14:45:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/01/09/freebsd-install-boost-for-regex</id>
    <content type="html"><![CDATA[<p>Boost这玩意用起来容易，安装起来却很麻烦，如果按照默认安装很庞大臃肿，原因是bjam搞得太复杂了。对于只使用其中某几个模块而采用整体安装的方式时间和空间上都是划不来的。如果只需要连接其中的正则表达式模块regex的话，可以采取单独安装的方法。</p>

<!-- more -->


<h3>1.生成bjam编译器</h3>

<p>boost不同的版本可能会有bjam包的路径不同的情况，这里采用boost_1_38_0为例。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/home/software
</span><span class='line'><span class="nv">$ </span>fetch http://sourceforge.net/projects/boost/files/boost/1.38.0/boost_1_38_0.tar.bz2
</span><span class='line'><span class="nv">$ </span>tar xjf boost_1_38_0.tar.bz2
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>tools/jam/src
</span><span class='line'><span class="nv">$ </span>./build.sh
</span></code></pre></td></tr></table></div></figure>


<p>编译后bjam程序存放于tools/jam/src/bin.freebsdx86_64/</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>vi ./tools/build/v2/user-config.jam
</span></code></pre></td></tr></table></div></figure>


<p>修改“#using gcc;”为&#8221;using gcc;&#8221;</p>

<h3>2.用bjam编译boost</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>./bjam clean <span class="c">#清理之前的安装</span>
</span><span class='line'><span class="nv">$ </span>./bjam --build-type<span class="o">=</span><span class="nb">complete</span> --with-regex workdir <span class="c">#只编译regex库，生成include和lib</span>
</span></code></pre></td></tr></table></div></figure>


<p>注意bjam编译时，需要注意bjam只是把boost的include和lib的路径放在本地，一个是当前目录的子目录boost中，一个是在刚在指定workdir的lib中。
然后复制到freebsd的include目录(/usr/local/include)和lib目录(/usr/local/lib)。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd</span> /home/software/boost_1_38_0
</span><span class='line'>sudo cp -r boost /usr/local/include/
</span><span class='line'>sudo cp -r workdir/lib /usr/local/
</span></code></pre></td></tr></table></div></figure>


<h3>3.编译使用boost-regex的程序</h3>

<p>简单的程序regex.cpp试一把</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;boost/regex.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;iostream&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;&lt;html&gt;我是boost正则表达式匹配到的内容&lt;/html&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="n">boost</span><span class="o">::</span><span class="n">regex</span> <span class="n">reg</span><span class="p">(</span> <span class="s">&quot;&lt;html&gt;(.+?)&lt;/html&gt;&quot;</span> <span class="p">);</span>
</span><span class='line'>  <span class="n">boost</span><span class="o">::</span><span class="n">sregex_token_iterator</span> <span class="n">p</span><span class="p">(</span> <span class="n">s</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">s</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">reg</span><span class="p">,</span> <span class="mo">01</span> <span class="p">);</span>
</span><span class='line'>  <span class="n">boost</span><span class="o">::</span><span class="n">sregex_token_iterator</span> <span class="n">end</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">end</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>&mdash;&mdash;&mdash;&mdash;&mdash;-付测试方法&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<h3>编译方法</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>g++ -Wall regex.cpp -lboost_regex-gcc42-d-1_38 -I/usr/local/include -L/usr/local/lib -o regex
</span><span class='line'><span class="nv">$ </span>./regex
</span><span class='line'>我是boost正则表达式匹配到的内容
</span></code></pre></td></tr></table></div></figure>


<p>这样就妥妥的了，祝各位看官好运，收工:)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用expect脚本检测telnet瞬断]]></title>
    <link href="http://evoupsight.com/blog/2014/01/08/expect-check-telnet-losing-connection-immediately/"/>
    <updated>2014-01-08T18:17:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/01/08/expect-check-telnet-losing-connection-immediately</id>
    <content type="html"><![CDATA[<p>分享一个检查telnet瞬断的脚本，我用调用它来检测thrift的TCP9090端口一连上就断开连接的状态。</p>

<p>直接上代码了</p>

<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/usr/local/bin/expect</span>
</span><span class='line'>spawn telnet 127.0.0.1 9090
</span><span class='line'><span class="nb">set </span>timeout  1
</span><span class='line'>expect <span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;*Escape character is*&quot;</span> <span class="o">{</span>
</span><span class='line'>                exp_continue
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="s2">&quot;*Connection closed by foreign host*&quot;</span> <span class="o">{</span>
</span><span class='line'>                send <span class="s2">&quot;note: 1) detect a unsafe connection&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>expect <span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;*Connection closed by foreign host*&quot;</span> <span class="o">{</span>
</span><span class='line'>                send <span class="s2">&quot;note: 2) detect a unsafe connection&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        send <span class="s2">&quot;\\003&quot;</span>
</span><span class='line'>        <span class="nb">exit</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>expect <span class="s2">&quot;*Connection closed by foreign host*&quot;</span>
</span><span class='line'>send <span class="s2">&quot;note: 3) disconnect by client cause timeout or not immediately exit expect&quot;</span>
</span><span class='line'><span class="nb">exit</span>
</span><span class='line'>expect eof
</span><span class='line'>
</span><span class='line'><span class="nb">exit</span>
</span><span class='line'>expect eof
</span></code></pre></td></tr></table></div></figure>


<p>调用者程序可以根据expect输出的note: 3) disconnect by client cause timeout or not immediately exit expect得知telnet上去瞬间失去连接。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[WIN7下安装VC++6.0的方法]]></title>
    <link href="http://evoupsight.com/blog/2014/01/08/win7-install-vc6/"/>
    <updated>2014-01-08T14:09:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/01/08/win7-install-vc6</id>
    <content type="html"><![CDATA[<p>今天打算研究snmp++的例子，要回来用一下vc6，WIN7上安装vc6还是会遇到一点点小问题，记录一下备查。</p>

<!-- more -->


<h3>步骤/方法</h3>

<p>1）在安装或使用Visual C++6.0时，如果出现兼容性问题提示对话框，都只要选择“不再显示此消息”，然后选择“运行程序”。根据网上资料和实践没有任何问题。</p>

<p>2）在安装Visual C++6.0过程中，选择“custom（自定义安装）”：其中visual source safe是不需安装的，这是微软的版本控制系统，咱就不装了。</p>

<p>3）最后最重要的一点，把windows7的UAC降到最低。然后打开vc6的时候需要以用管理员身份运行，这样就可以了。</p>

<h3>补充</h3>

<p>网上说还需要进到“工具”菜单的“选项”中，然后在“选项”窗口中选择“目录”选项卡。加入一些目录的路径。我实际试验下来可以不用这么做。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[hbase连zookeeper瞬断]]></title>
    <link href="http://evoupsight.com/blog/2013/12/31/hbase-access-zookeeper-fail-too-many-connections-form-ip/"/>
    <updated>2013-12-31T11:48:00+08:00</updated>
    <id>http://evoupsight.com/blog/2013/12/31/hbase-access-zookeeper-fail-too-many-connections-form-ip</id>
    <content type="html"><![CDATA[<h3>问题</h3>

<p>今天修理hbase问题的时候发现，监控的60010端口的master.jsp就是无法显示，进入log查看发现zookeeper连上了之后马上就断开。</p>

<p><code>[NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxn$Factory@247]</code>
<code>- Too many connections from /10.10.8.136 - max is 10</code></p>

<p>这种情况在telnet测试中被证实，一连上也是瞬间脱离与服务器的连接。</p>

<!-- more -->


<h3>解决</h3>

<p>其实需要在zoo.cfg中加入maxClientCnxns=300，加完以后需要重启。问题解决。</p>

<h3>原因</h3>

<p>我们线上有24台节点，但是这个参数竟然是使用默认的10，导致更多的客户端连上了zookeeper导致namenode的自带管理页无法连接到zookeeper，进而无法显示该页面。</p>

<p>如何监控zookeeper的其他指标，这里列出zoo.cfg的配置文件</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dataDir = 数据存放路径
</span><span class='line'>
</span><span class='line'>dataLogDir = 日志存放路径
</span><span class='line'>
</span><span class='line'>clientPort = 客户端连接端口
</span><span class='line'>
</span><span class='line'>clientPortAddress
</span><span class='line'>
</span><span class='line'>tickTime= 整型 不能为0
</span><span class='line'>
</span><span class='line'>maxClientCnxns= 整型 最大客户端连接数
</span><span class='line'>
</span><span class='line'>minSessionTimeout= 整型
</span><span class='line'>
</span><span class='line'>maxSessionTimeout= 整型
</span><span class='line'>
</span><span class='line'>initLimit = 整型
</span><span class='line'>
</span><span class='line'>syncLimit = 整型
</span><span class='line'>
</span><span class='line'>electionAlg = 整型
</span><span class='line'>
</span><span class='line'>peerType = observer | participant
</span><span class='line'>
</span><span class='line'>server. sid= host:port | host:port:port  | host:port:port:type (type值 observer | participant)
</span><span class='line'>
</span><span class='line'>group.gid = sid:sid (一个ID， 值是多个sid, 中间以:分割， 一个sid只能属于一个gid)
</span><span class='line'>
</span><span class='line'>weight.sid=整型</span></code></pre></td></tr></table></div></figure>


<p>可以看出还有至少2个参数是需要考虑的minSessionTimeout和maxSessionTimeout需要调优，得用JMX监控一段时间得出结论了。</p>

<p>同样的发现thrift也存在类似一连就断开的问题，下篇博文再作分析。</p>

<h3>总结</h3>

<p>这个案例告诉我不要盲目认为按照默认参数配置就没问题了，那是给小批量测试用的，需要根据实际情况采取相应配置。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[centos安装erlang R16b03]]></title>
    <link href="http://evoupsight.com/blog/2013/12/12/centos-install-erlangr16b03/"/>
    <updated>2013-12-12T16:43:00+08:00</updated>
    <id>http://evoupsight.com/blog/2013/12/12/centos-install-erlangr16b03</id>
    <content type="html"><![CDATA[<h3>起因</h3>

<p>原本以为centos上简单敲几个yum install erlang就可以完成，结果事与愿违，没有package，那么只要乖乖下载源码编译，记录若干步骤备查。</p>

<!-- more -->


<h3>首先安装必要的依赖</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo yum groupinstall Base <span class="s2">&quot;Development Tools&quot;</span> <span class="s2">&quot;Perl Support&quot;</span>
</span><span class='line'><span class="nv">$ </span>sudo yum install gcc glibc-devel make ncurses-devel openssl-devel autoconf
</span><span class='line'><span class="nv">$ </span>sudo yum install unixODBC unixODBC-devel
</span><span class='line'><span class="nv">$ </span>wget http://www.erlang.org/download/otp_src_R16B03.tar.gz
</span></code></pre></td></tr></table></div></figure>


<h3>源码下载</h3>

<p>并且下载erlang的源码，我这里选择的是最新的R16B03</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>tar xzf otp_src_R16B03.tar.gz
</span></code></pre></td></tr></table></div></figure>


<h3>安装</h3>

<p>注意,如果没有先</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo ln -s /usr/bin/gcc /usr/local/bin/gcc44
</span></code></pre></td></tr></table></div></figure>


<p>会收到` checking for C compiler default output file name&hellip; configure: error: C compiler cannot create</p>

<p>的错误</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">cd </span>otp_src_R16B03
</span><span class='line'><span class="nv">$ </span>./configure --prefix<span class="o">=</span>/home/erlang --without-javac //不用装java
</span><span class='line'>make
</span><span class='line'><span class="nv">$ </span>sudo make install
</span></code></pre></td></tr></table></div></figure>


<p>等待安装完成。</p>

<h3>设置环境变量</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>vim ~/.profile
</span></code></pre></td></tr></table></div></figure>


<p>或者</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo vim /etc/profiles
</span></code></pre></td></tr></table></div></figure>


<p>加入</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/home/erlang/bin
</span></code></pre></td></tr></table></div></figure>


<p>加完如果要立即生效忘记去source /etc/profile和source ~/.bash_profile，否则要等到下次登录再可以。</p>

<p>(ps: bash是根据/etc/profile、~/.bash_profile、~/.bash_login或~/.profile的顺序进行读取的。)</p>

<p>(ADDED IN 2013-12-16,今日发现以上代码必须加到~/.bashrc中才行，否则重启后还是不予加载原因未明)</p>

<h3>测试</h3>

<p>接下来输入erl,应该就可以看见erlang的提示符了。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>Eshell V5.10.4  <span class="o">(</span>abort with ^G<span class="o">)</span>
</span><span class='line'>1&gt;
</span></code></pre></td></tr></table></div></figure>


<p>写一个test.erl测试</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">test</span><span class="p">).</span>
</span><span class='line'><span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">sayhello</span><span class="o">/</span><span class="mi">0</span><span class="p">]).</span>
</span><span class='line'><span class="nf">sayhello</span><span class="p">()</span><span class="o">-&gt;</span>
</span><span class='line'>  <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;hello world</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">).</span>
</span></code></pre></td></tr></table></div></figure>


<p>编译运行</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>erlc test.erl
</span><span class='line'>erl -noshell -s <span class="nb">test </span>sayhello -s init stop
</span><span class='line'>hello world
</span></code></pre></td></tr></table></div></figure>


<p>ok，完成收工，还不算太复杂，比freebsd上安装顺利点:)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用php的snmp模块进行监控数据的获取]]></title>
    <link href="http://evoupsight.com/blog/2013/12/10/php-use-snmp-module-to-monitor/"/>
    <updated>2013-12-10T10:19:00+08:00</updated>
    <id>http://evoupsight.com/blog/2013/12/10/php-use-snmp-module-to-monitor</id>
    <content type="html"><![CDATA[<p>简单地根据经验归纳，snmp被叫做简单网络管理协议(Simple Network Management Protocol)，是监控业界标准的设备间通讯接口会话层协议，位于OSI的第五层。各类开源软件广泛采用了此协议进行数据的获取，目前已经从明文传输的v1发展到了具有较高安全性的v3版本。与snmp相关的知识有很多，<code>MIB</code>（管理信息数据库），<code>OID</code>（对象标识符），就目前而言，只需要记得有这2个名字就可以了。
通过源码安装php的snmp模块和安装一般php的模块没有本质区别。一共也就2种方式，&mdash;enable或者&mdash;with静态方式和phpize动态方式。共同点是都需要ext目录下面有snmp这个模块。
下面先论述如以&mdash;enable或者&mdash;with的方式来把snmp静态编译到php中去。
首先下载php软件包。</p>

<!-- more -->


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>wget wget http://tw1.php.net/get/php-5.5.6.tar.bz2/from/this/mirror
</span><span class='line'><span class="nv">$ </span>tar xjf php-5.5.6.tar.bz2
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>php-5.5.6
</span><span class='line'><span class="nv">$ </span>ls ext/snmp/
</span><span class='line'>config.m4  config.w32  CREDITS  php_snmp.h  snmp.c  snmp.dsp  tests
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>可见snmp已经自带了，不需要到pecl下载然后放到ext目录。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo yum install libxml2 libxml2-devel
</span></code></pre></td></tr></table></div></figure>


<p>备注如果一意孤行，只装libxml2，呵呵，那么你将收到<code>configure: error: xml2-config not found. Please check your libxml2 installation.</code>的报错。同样，你要是不装net-snmp-devel，就可以收到<code>configure: error: Could not find net-snmp-config binary. Please check your net-snmp installation</code>的报错。</p>

<h3>静态编译</h3>

<p>查一下snmp的安装选项</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>./configure --help | grep snmp
</span><span class='line'>  --with-snmp<span class="o">=</span>DIR         Include SNMP support
</span></code></pre></td></tr></table></div></figure>


<p>是&mdash;with，了解后继续操作，这里直接使用默认snmp路径</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>./configure --prefix<span class="o">=</span>/usr/local/php55_static_snmp --with-snmp --ebable-sockets
</span><span class='line'><span class="nv">$ </span>make
</span><span class='line'><span class="nv">$ </span>sudo make install
</span></code></pre></td></tr></table></div></figure>


<p>这样静态编译就完成了。</p>

<h3>动态编译</h3>

<p>假设一开始把php安装在/usr/local/php55，现在要以编译出sockets.so和snmp.so</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">cd </span>ext/snmp
</span><span class='line'><span class="nv">$ </span>/usr/local/php55/bin/phpize
</span><span class='line'><span class="nv">$ </span>./configure --with-php-config<span class="o">=</span>/usr/local/php55/bin/php-config
</span><span class='line'><span class="nv">$ </span>make
</span><span class='line'><span class="nv">$ </span>sudo make install
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ../../ext/sockets
</span><span class='line'><span class="nv">$ </span>/usr/local/php55/bin/phpize
</span><span class='line'><span class="nv">$ </span>./configure --with-php-config<span class="o">=</span>/usr/local/php55/bin/php-config
</span><span class='line'><span class="nv">$ </span>make
</span><span class='line'><span class="nv">$ </span>sudo make install
</span></code></pre></td></tr></table></div></figure>


<p>然后复制刚才的编译好的so文件到扩展目录到etc目录</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>cp /usr/local/php55/lib/php/extensions/no-debug-non-zts-20121212/snmp.so /usr/local/php55/etc/
</span><span class='line'><span class="nv">$ </span>cp /usr/local/php55/lib/php/extensions/no-debug-non-zts-20121212/sockets.so /usr/local/php55/etc/
</span></code></pre></td></tr></table></div></figure>


<p>编辑php的配置文件</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>vi /usr/local/php55/etc/php.ini
</span></code></pre></td></tr></table></div></figure>


<p>加入2行</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">extension</span><span class="o">=</span>sockets.so
</span><span class='line'><span class="nv">extension</span><span class="o">=</span>snmp.so
</span></code></pre></td></tr></table></div></figure>


<h3>撰写php版的snmp客户端测试程序</h3>

<p>开始写点测试程序，确认snmp已经在本机支持</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$nc</span> -uvz 127.0.0.1 161
</span><span class='line'>Connection to 127.0.0.1 161 port <span class="o">[</span>udp/snmp<span class="o">]</span> succeeded!
</span></code></pre></td></tr></table></div></figure>


<p>已经支持，那么来写程序吧</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * test.php</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="nv">$host</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$community</span><span class="o">=</span><span class="s2">&quot;public&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$oid</span><span class="o">=</span><span class="s2">&quot;.1.3.6.1.4.1.2021.10.1.3.1&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$oid1</span><span class="o">=</span><span class="s2">&quot;.1.3.6.1.4.1.2021.10.1.3.2&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$oid2</span><span class="o">=</span><span class="s2">&quot;.1.3.6.1.4.1.2021.10.1.3.3&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$oid3</span><span class="o">=</span><span class="s2">&quot;.1.3.6.1.4.1.2021.4.3.0&quot;</span><span class="p">;</span>
</span><span class='line'><span class="c1">// 1 minute Load</span>
</span><span class='line'><span class="k">echo</span> <span class="p">(</span><span class="nb">snmpget</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span><span class="nv">$community</span><span class="p">,</span><span class="nv">$oid</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">// 5 minute Load</span>
</span><span class='line'><span class="k">echo</span> <span class="p">(</span><span class="nb">snmpget</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span><span class="nv">$community</span><span class="p">,</span><span class="nv">$oid1</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">// 15 minute Load</span>
</span><span class='line'><span class="k">echo</span> <span class="p">(</span><span class="nb">snmpget</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span><span class="nv">$community</span><span class="p">,</span><span class="nv">$oid2</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">// Total Swap Size</span>
</span><span class='line'><span class="k">echo</span> <span class="p">(</span><span class="nb">snmpget</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span><span class="nv">$community</span><span class="p">,</span><span class="nv">$oid3</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>查看结果</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>/usr/local/php55/bin/php test.php
</span><span class='line'>STRING: 0.05
</span><span class='line'>STRING: 0.03
</span><span class='line'>STRING: 0.03
</span><span class='line'>INTEGER: 2064376 kB
</span></code></pre></td></tr></table></div></figure>


<h3>分析总结</h3>

<p>可以看出php的snmp接口还是非常简明优雅的，由此推断你只要学会rrdtool、php和snmp，自行打造一款类cacti的监控软件不会有太大的困难。但是这么做其实还有一点要注意，得装snmpd，我自己写公司监控平台2.0的时候，上级要求使用C api直接获取数据，不走snmp，其实通过对分析ganglia源代码的粗读，也能马上发现其也是采用了原生api调用获取主要监控数据的方式，所以号称比snmpd快和非常节省系统开销。但为了完成任务和系统的拓展性，果然另外支持snmp吧。</p>

<h3>扩展阅读</h3>

<p>请需要OID对照资料的兄弟自行互联网查询《linux常用OID》</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[centos6.4 install cacti0.8]]></title>
    <link href="http://evoupsight.com/blog/2013/12/04/centos6-dot-4-install-cacti0-dot-8/"/>
    <updated>2013-12-04T10:37:00+08:00</updated>
    <id>http://evoupsight.com/blog/2013/12/04/centos6-dot-4-install-cacti0-dot-8</id>
    <content type="html"><![CDATA[<h3>简介</h3>

<p>cacti号称一款完全采用rrdtool和snmp实现的监控软件，与同为自由软件的nagios相比，它能够呈现大量直观的监控图表，功能主要体现在了数据的量化上。该软件最初完全采用php写成，采用crontab调用poller.php脚本进行数据的定时收集，如今已经有c语言写成的改良版spine收集器进行数据的收集可供选择。</p>

<!-- more -->


<p>接下来开始安装，一开始还是一样先把可能妨碍安装成功的iptables和selinux关闭掉</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>service iptables stop
</span><span class='line'>chkconfig iptables off
</span><span class='line'>vim /etc/selinux/config
</span></code></pre></td></tr></table></div></figure>


<p>然后SELINUX=enforcing改成SELINUX=disabled
重启机器getenforce 为disable
正式开篇</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>yum -y install mysql mysql-server mysql-devel
</span><span class='line'>yum -y install httpd
</span><span class='line'>yum -y install php php-mysql
</span></code></pre></td></tr></table></div></figure>


<p>启动服务并加入到启动列表</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>service httpd start
</span><span class='line'>service mysqld start
</span><span class='line'>chkconfig httpd on
</span><span class='line'>chkconfig mysqld on
</span></code></pre></td></tr></table></div></figure>


<p>安装需要的库文件</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>yum -y install zlib
</span><span class='line'>yum -y install freetype
</span><span class='line'>yum -y install libjpeg
</span><span class='line'>yum -y install fontconfig
</span><span class='line'>yum -y install gd
</span><span class='line'>yum -y install libxml2
</span><span class='line'>yum -y install php-gd
</span></code></pre></td></tr></table></div></figure>


<p>安装rrdtool</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>yum -y install rrdtool
</span></code></pre></td></tr></table></div></figure>


<p>安装snmp支持工具</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>yum -y install net-snmp
</span><span class='line'>yum -y install net-snmp-utils
</span></code></pre></td></tr></table></div></figure>


<p>启动snmpd服务</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>service snmpd start
</span><span class='line'>chkconfig snmpd on
</span></code></pre></td></tr></table></div></figure>


<p>安装cacti
下载wget <a href="http://www.cacti.net/downloads/cacti-0.8.7e.tar.gz">http://www.cacti.net/downloads/cacti-0.8.7e.tar.gz</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>tar xzf cacti-0.8.7e.tar.gz
</span><span class='line'>mv cacti-0.8.7e /var/www/html/cacti
</span><span class='line'><span class="nb">cd</span> /var/www/html
</span><span class='line'>vim cacti/include/config.php
</span></code></pre></td></tr></table></div></figure>


<p>编辑为下面的配置</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$database_type</span> <span class="o">=</span> <span class="s2">&quot;mysql&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$database_default</span> <span class="o">=</span> <span class="s2">&quot;cacti&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$database_hostname</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$database_username</span> <span class="o">=</span> <span class="s2">&quot;cacti&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$database_password</span> <span class="o">=</span> <span class="s2">&quot;cacti&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$database_port</span> <span class="o">=</span> <span class="s2">&quot;3306&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>添加cacti用户
useradd cacti</p>

<p>添加计划任务
编辑/etc/crontab</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>* * * * * cacti /usr/bin/php /var/www/html/cacti/poller.php &gt;&gt; /dev/null 2&gt;&amp;1
</span></code></pre></td></tr></table></div></figure>


<p>更改属组
将web目录的所属组改为cacti</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#chgrp -R cacti /var/www/html/cacti</span>
</span><span class='line'><span class="c">#chown -R cacti /var/www/html/cacti/rra</span>
</span><span class='line'><span class="c">#chown -R cacti /var/www/html/cacti/log</span>
</span><span class='line'><span class="c">#chown -R cacti /var/www/html/cacti/poller.php</span>
</span></code></pre></td></tr></table></div></figure>


<p>创建cacti数据库</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>mysql
</span><span class='line'>mysql&gt; create database cacti;
</span></code></pre></td></tr></table></div></figure>


<p>导入cacti.sql</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>mysql -uroot -p cacti &lt; /var/www/html/cacti/cacti.sql
</span><span class='line'>mysql&gt; use cacti
</span><span class='line'>mysql&gt; grant all on cacti.* to cacti@localhost identified by <span class="s1">&#39;cacti&#39;</span>;
</span><span class='line'>mysql&gt; flush privileges;
</span><span class='line'>mysql&gt; <span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure>


<p>浏览器登录cacti
<a href="http://ip/cacti">http://ip/cacti</a>
new install后一路回车,安装完成。
默认登录密码为admin/admin</p>

<h3>疑难杂症之cacti不出图</h3>

<p>首先检查log文件权限</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd</span> /var/www/html/cacti/log
</span><span class='line'>ll
</span><span class='line'>-rw-r--r-- 1 cacti cacti 438 Dec  3 02:14 cacti.log
</span></code></pre></td></tr></table></div></figure>


<p>校正时间</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#cp -f /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span>
</span><span class='line'><span class="c">#reboot</span>
</span></code></pre></td></tr></table></div></figure>


<p>确保/var/www/html/cacti/rra目录下有可写权限。
重启点击graph菜单观察发现已经出现图表了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[centos6.4下搭建zabbix2.0.6]]></title>
    <link href="http://evoupsight.com/blog/2013/12/03/centos6-dot-4-install-zabbix/"/>
    <updated>2013-12-03T13:37:00+08:00</updated>
    <id>http://evoupsight.com/blog/2013/12/03/centos6-dot-4-install-zabbix</id>
    <content type="html"><![CDATA[<p>最近开始研究各款监控系统，和自己的监控系统进行横向比较找差距，就从单位也在用的zabbix开始，先安装后再这里过一遍流程。</p>

<!-- more -->


<p>关闭iptables和selinux</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo service iptables stop
</span><span class='line'>sudo chkconfig iptables off
</span></code></pre></td></tr></table></div></figure>


<p>临时关闭selinux</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>setenfoce 0  <span class="c">##设置为permissive模式</span>
</span><span class='line'>             <span class="c">##setenforce 1设置SELunix为enforcing模式</span>
</span></code></pre></td></tr></table></div></figure>


<p>永久关闭
修改/etc/selinux/config 文件
将SELINUX=enforcing改为SELINUX=disabled
重启机器看到
getenforce返回Disabled说明已经关闭</p>

<p>再次进入centos6.4，先安装LAMP环境。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>yum install -y httpd mysql mysql-server mysql-devel php php-mysql php-common php-mbstring php-gd php-odbc php-xml php-pear
</span></code></pre></td></tr></table></div></figure>


<p>然后下载zabbix</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>wget http://sourceforge.net/projects/zabbix/files/ZABBIX%20Latest%20Stable/2.0.6/zabbix-2.0.6.tar.gz/download
</span></code></pre></td></tr></table></div></figure>


<p>继续安装需要的组件</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>yum install -y curl curl-devel net-snmp net-snmp-devel perl-DBI
</span></code></pre></td></tr></table></div></figure>


<p>创建zabbix用户帐号</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo useradd zabbix
</span><span class='line'>sudo usermod -s /sbin/nologin zabbix
</span></code></pre></td></tr></table></div></figure>


<p>启动mysql</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo service mysqld start
</span></code></pre></td></tr></table></div></figure>


<p>登录mysql</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>mysql -uroot -p123456
</span><span class='line'>mysql&gt; create database zabbix;
</span><span class='line'>mysql&gt; grant all on zabbix.* to zabbix@localhost identified by <span class="s1">&#39;123456&#39;</span>;
</span><span class='line'>mysql&gt; use zabbix;
</span><span class='line'>mysql&gt; <span class="nb">source</span> /home/evoup/Downloads/zabbix-2.0.6/database/mysql/schema.sql
</span><span class='line'>mysql&gt; <span class="nb">source</span> /home/evoup/Downloads/zabbix-2.0.6/database/mysql/images.sql
</span><span class='line'>mysql&gt; <span class="nb">source</span> /home/evoup/Downloads/zabbix-2.0.6/database/mysql/data.sql
</span><span class='line'>mysql&gt; <span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure>


<p>安装zabbix</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>./configure --enable-server --enable-agent --with-mysql --with-net-snmp --with-libcurl
</span><span class='line'>Configuration:
</span><span class='line'>
</span><span class='line'>  Detected OS:           linux-gnu
</span><span class='line'>  Install path:          /usr/local
</span><span class='line'>  Compilation arch:      linux
</span><span class='line'>
</span><span class='line'>  Compiler:              gcc
</span><span class='line'>  Compiler flags:        -g -O2  -I/usr/include/mysql  -g -pipe -Wp,-D_FORTIFY_SOURCE<span class="o">=</span>2 -fexceptions -fstack-protector --param<span class="o">=</span>ssp-buffer-size<span class="o">=</span>4 -m64 -D_GNU_SOURCE -D_FILE_OFFSET_BITS<span class="o">=</span>64 -D_LARGEFILE_SOURCE -fno-strict-aliasing -fwrapv -fPIC   -DUNIV_LINUX -DUNIV_LINUX       -I/usr/include/rpm -I/usr/local/include -I/usr/lib64/perl5/CORE -I. -I/usr/include
</span><span class='line'>
</span><span class='line'>  Enable server:         yes
</span><span class='line'>  Server details:
</span><span class='line'>    With database:         MySQL
</span><span class='line'>    WEB Monitoring via:    cURL
</span><span class='line'>    Native Jabber:         no
</span><span class='line'>    SNMP:                  net-snmp
</span><span class='line'>    IPMI:                  no
</span><span class='line'>    SSH:                   no
</span><span class='line'>    ODBC:                  no
</span><span class='line'>    Linker flags:          -rdynamic      -L/usr/lib64/mysql       -L/usr/lib64  -L/usr/lib64
</span><span class='line'>    Libraries:             -lm -lrt  -lresolv    -lmysqlclient       -lcurl  -lnetsnmp -lcrypto  -lnetsnmp -lcrypto
</span><span class='line'>
</span><span class='line'>  Enable proxy:          no
</span><span class='line'>
</span><span class='line'>  Enable agent:          yes
</span><span class='line'>  Agent details:
</span><span class='line'>    Linker flags:          -rdynamic
</span><span class='line'>    Libraries:             -lm -lrt  -lresolv    -lcurl
</span><span class='line'>
</span><span class='line'>  Enable Java gateway:   no
</span><span class='line'>
</span><span class='line'>  LDAP support:          no
</span><span class='line'>  IPv6 support:          no
</span><span class='line'>
</span><span class='line'>***********************************************************
</span><span class='line'>*            Now run <span class="s1">&#39;make install&#39;</span>                       *
</span><span class='line'>*                                                         *
</span><span class='line'>*            Thank you <span class="k">for </span>using Zabbix!                  *
</span><span class='line'>*              &lt;http://www.zabbix.com&gt;                    *
</span><span class='line'>***********************************************************
</span></code></pre></td></tr></table></div></figure>


<p>好了，我们正式安装</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo make install
</span></code></pre></td></tr></table></div></figure>


<p>接下来编辑配置文件
可以不用sudo，直接切换到root做</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd</span> /usr/local/etc
</span><span class='line'>cat zabbix_server.conf
</span><span class='line'><span class="nv">LogFile</span><span class="o">=</span>/var/log/zabbix_server.log
</span><span class='line'><span class="nv">DBHost</span><span class="o">=</span>localhost
</span><span class='line'><span class="nv">DBName</span><span class="o">=</span>zabbix
</span><span class='line'><span class="nv">DBUser</span><span class="o">=</span>zabbix
</span><span class='line'><span class="nv">DBPassword</span><span class="o">=</span>123456
</span><span class='line'>
</span><span class='line'>cat zabbix_agent.conf
</span><span class='line'><span class="nv">LogFile</span><span class="o">=</span>/tmp/zabbix_agentd.log
</span><span class='line'><span class="nv">Server</span><span class="o">=</span>127.0.0.1
</span><span class='line'><span class="nv">UnsafeUserParameters</span><span class="o">=</span>1
</span></code></pre></td></tr></table></div></figure>


<p>创建日志文件</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>touch /var/log/zabbix_server.log
</span><span class='line'>touch /var/log/zabbix_agent.log
</span><span class='line'>
</span><span class='line'><span class="nb">cd</span> -
</span><span class='line'>cp misc/init.d/tru64/zabbix_server /etc/init.d/
</span><span class='line'>cp misc/init.d/tru64/zabbix_agentd /etc/init.d/
</span></code></pre></td></tr></table></div></figure>


<p>2个文件的文件头改成如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'><span class="c">#chkconfig: 35 95 95</span>
</span><span class='line'><span class="c">#description:zabbix Agent server</span>
</span></code></pre></td></tr></table></div></figure>


<p>添加服务</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>chkconfig --add zabbix_server
</span><span class='line'>chkconfig --add zabbix_agentd
</span></code></pre></td></tr></table></div></figure>


<p>开机自动启动</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>chkconfig zabbix_server on
</span><span class='line'>chkconfig zabbix_agent on
</span></code></pre></td></tr></table></div></figure>


<p>文件执行权限</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>chmod +x zabbix_server
</span><span class='line'>chmod +x zabbix_agentd
</span></code></pre></td></tr></table></div></figure>


<p>启动</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo /etc/init.d/zabbix_server start
</span><span class='line'>sudo /etc/init.d/zabbix_agentd start
</span></code></pre></td></tr></table></div></figure>


<p>安装zabbix web</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>cp -r frontends/php/ /var/www/html/zabbix
</span></code></pre></td></tr></table></div></figure>


<p>访问<a href="http://ip/zabbix">http://ip/zabbix</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>vim /etc/php.ini
</span></code></pre></td></tr></table></div></figure>


<p>指定</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">timezone</span><span class="o">=</span><span class="nx">Asia</span><span class="o">/</span><span class="nx">Shanghai</span>
</span></code></pre></td></tr></table></div></figure>


<p>根据提示修改php配置</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>yum install -y php-bcmath
</span></code></pre></td></tr></table></div></figure>


<p>然后再次重启httpd</p>

<p>最后登录前端界面密码为 admin/zabbix</p>

<p>告一段落，接下来学习操作zabbix。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[克隆你的octopress博客到win7]]></title>
    <link href="http://evoupsight.com/blog/2013/12/01/deploy-another-octopress-environment-in-win7/"/>
    <updated>2013-12-01T18:25:00+08:00</updated>
    <id>http://evoupsight.com/blog/2013/12/01/deploy-another-octopress-environment-in-win7</id>
    <content type="html"><![CDATA[<p>由于之前octopress博客是在公司的机器上搭的，想到在家里笔记本上的win7也搞一个环境，方便及时写写技术博客。参考网文《【像黑客一样写博客之五】博客克隆》进行摸索，终于实践成功。</p>

<p>但我的方法稍微有点区别,这里采用clone的方式比较快，主要省去一个remote add环节：）只要主要注意几个问题，就可以轻松搞定，顺序看就行。</p>

<!-- more -->


<h2>环境篇：</h2>

<p>这个可以参考大多数搭建octopress博客的文章了，这里一笔带过，之把出现的问题记一笔方便日后查阅。</p>

<h3>问题1（ruby的版本）</h3>

<p>当我装到bundle install的时候，出现了如下问题</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>An error occurred while installing rdiscount (2.0.7.3), and Bundler cannot
</span><span class='line'>continue.</span></code></pre></td></tr></table></div></figure>


<p>查阅README.markdown
<strong>Note</strong>: Octopress requires a minimum Ruby version of <code>1.9.3-p0</code>.
原来需要安装ruby1.9.3。</p>

<h3>问题2 （在装完devkit之前utf-8环境变量不要设置）</h3>

<p>而安装ruby1.9.3,相应需要安装DevKit-tdm-32-4.5.2-20111229-1559-sfx.exe
直接解压到e:\devkit
然后再</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">cd</span> <span class="ss">e</span><span class="p">:\</span><span class="n">devkit</span>
</span><span class='line'><span class="n">ruby</span> <span class="n">dk</span><span class="o">.</span><span class="n">rb</span> <span class="n">init</span>
</span><span class='line'><span class="ss">C</span><span class="p">:</span><span class="sr">/Ruby193/</span><span class="n">lib</span><span class="o">/</span><span class="n">ruby</span><span class="o">/</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">win32</span><span class="o">/</span><span class="n">registry</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">173</span><span class="ss">:in</span> <span class="sb">`tr&#39;: invalid byte sequence in UTF-8 (ArgumentError)</span>
</span></code></pre></td></tr></table></div></figure>


<p>原来是环境变量不能先设置为UTF-8，这个是要特别注意的。</p>

<p>然后就可以执行devkit的安装了：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">ruby</span> <span class="n">dk</span><span class="o">.</span><span class="n">rb</span> <span class="n">init</span>
</span><span class='line'><span class="n">ruby</span> <span class="n">dk</span><span class="o">.</span><span class="n">rb</span> <span class="n">install</span>
</span></code></pre></td></tr></table></div></figure>


<p>接着设置环境变量（win7可以用开始搜索程序和文件，输入编辑系统环境变量）：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">LANG</span><span class="o">=</span>zh_CN.UTF-8
</span><span class='line'><span class="nv">LC_ALL</span><span class="o">=</span>zh_CN.UTF-8
</span></code></pre></td></tr></table></div></figure>


<p>继续安装2个必要的gem</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">rdoc</span> <span class="n">bundler</span>
</span><span class='line'><span class="n">bundle</span> <span class="n">install</span>
</span></code></pre></td></tr></table></div></figure>


<p>这样开发环境就算和之前一致了，这里没有说git的安装，和网上说的没有特别之处，反正装完了需要把git/bin目录加到环境变量PATH中去。</p>

<h2>博客恢复篇</h2>

<p>签出自己的octopress项目,我的放在e:\octopress</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd </span>e:<span class="se">\o</span>ctopress<span class="se">\</span>
</span><span class='line'>git clone git@github.com:you/you.github.com.git
</span><span class='line'>git config --global user.email <span class="s2">&quot;you@example.com&quot;</span>
</span><span class='line'>git config --global user.name <span class="s2">&quot;Your Name&quot;</span>
</span><span class='line'><span class="nb">cd </span>you.github.com
</span><span class='line'>git checkout <span class="nb">source</span>
</span><span class='line'>rake setup_github_pages
</span><span class='line'><span class="nb">cd </span>_deploy
</span><span class='line'>git pull origin master
</span></code></pre></td></tr></table></div></figure>


<p>所有的资料都从远程origin仓库的master分支取回来了！
然后切记切换回source分支，因为master分支的是octopress通过rake部署自动提交进行维护的。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd</span> ..
</span><span class='line'>git checkout <span class="nb">source</span>
</span></code></pre></td></tr></table></div></figure>


<p>再次rake generate和rake preview以及rake deploy发现已经可以发布了，最后还需要把相关的提交了，git add . 和git commit -a以及git push origin source</p>

<p>最后注意游走在不同的octopress博客环境处理博客之前，需要同步github仓库的数据</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd </span>e:<span class="se">\o</span>ctopress<span class="se">\y</span>ou.github.com
</span><span class='line'>git pull origin <span class="nb">source </span>
</span><span class='line'><span class="nb">cd </span>_deploy
</span><span class='line'>git pull origin master
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
</feed>
