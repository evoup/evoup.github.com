<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Evoup`s Blog]]></title>
  <link href="http://evoupsight.com/atom.xml" rel="self"/>
  <link href="http://evoupsight.com/"/>
  <updated>2014-04-05T15:55:07+08:00</updated>
  <id>http://evoupsight.com/</id>
  <author>
    <name><![CDATA[Evoup`s Blog]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[win7下cocos2d-js3.0 alpha生成android项目]]></title>
    <link href="http://evoupsight.com/blog/2014/03/25/win7-cocos-2djs-3-dot-0-alpha-with-android/"/>
    <updated>2014-03-25T19:37:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/03/25/win7-cocos-2djs-3-dot-0-alpha-with-android</id>
    <content type="html"><![CDATA[<p>折腾了比较长的时间，主要是从cocos2d-html5入门开始做demo，然后到jsb的部分，发现走不通，于是又去研究了cocos2d-x3.0 v3.0 rc0如何生成android项目，发现发布是可以的，但是安装到模拟器又是闪退。花了两三天时间（间断）终于完成，放这里共享下。</p>

<!-- more -->


<h3>需要的软件</h3>

<p>首先当然是下载好cocos2d-js了，放到c:\cocos2d-jsb中：<br>
<img src="http://evoupsight.com/images/evoup/cocos2d-js_android/01.png" alt="Alt text" /></p>

<p>然后请安装好这些工具NDK（r9b）, android SDK（20131030）, ANT（1.9.3），Python（2.7.6）<br>
下图中红色框住的部分为实际使用到的软件</p>

<p><img src="http://evoupsight.com/images/evoup/cocos2d-js_android/02.png" alt="Alt text" /></p>

<p><img src="http://evoupsight.com/images/evoup/cocos2d-js_android/03.png" alt="Alt text" /></p>

<p>python要配置好环境变量，在cmd命令调出python，可以看到版本号:<br></p>

<p><img src="http://evoupsight.com/images/evoup/cocos2d-js_android/04.png" alt="Alt text" /></p>

<h3>安装</h3>

<p>万事俱备，到了见证奇迹的时刻,在这之前，请先安装好命令行，其实就是写入几个环境变量<br>
方法是：开始-运行-cmd，进入控制台，然后定位到C:\cocos2d-jsb\Cocos2d-JS-v3.0-alpha,接下来输入:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>python setup.py
</span></code></pre></td></tr></table></div></figure>


<p>然后在对应的NDK_ROOT环境变量中输入c:\android\android-ndk-r9b-windows-x86_64\android-ndk-r9b,<br>
在ANDROID_SDK_ROOT环境变量中输入c:\android\adt-bundle-windows-x86_64-20131030\sdk<br>
在ANT_ROOT中环境变量中输入c:\ant\apache-ant-1.9.3\bin<br>
<img src="http://evoupsight.com/images/evoup/cocos2d-js_android/05.png" alt="Alt text" /></p>

<p>这些操作完成后，你会发现win7好像并没有加载出这些环境变量，我的方法是重启（嗯！你没看错，反正我是重启才能加载，晕）。<br></p>

<p>重启完成之后,我们试一下这些环境变量是否OK，注意windows下批处理程序变量的命名方式为%变量名%<br></p>

<p><img src="http://evoupsight.com/images/evoup/cocos2d-js_android/06.png" alt="Alt text" /></p>

<h3>产生项目</h3>

<p>比如说要在c:/projects下创建一个有native编译支持的，名为prohectFoo的项目，需要在控制台输入</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>%COCOS_CONSOLE_ROOT%/cocos new projectFoo -l js -d c:/projects
</span></code></pre></td></tr></table></div></figure>


<p>等一会儿就创建完毕<br>
<img src="http://evoupsight.com/images/evoup/cocos2d-js_android/07.png" alt="Alt text" /></p>

<h3>编译项目</h3>

<p>如果要编译成android项目，只要执行如下指令即可：<br></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>&gt; <span class="nb">cd </span>c:<span class="se">\p</span>rojects<span class="se">\p</span>rojectFirst
</span><span class='line'>&gt; %COCOS_CONSOLE_ROOT%/cocos compile -p android
</span></code></pre></td></tr></table></div></figure>


<p>之后要耐心等待项目编译完成，顺便说一句，没有vc2012是不能够编译cocos2d-js3.0的，因为现在引擎支持C++11了。<br>
<img src="http://evoupsight.com/images/evoup/cocos2d-js_android/08.png" alt="Alt text" /></p>

<p>等待编译完成<br>
<img src="http://evoupsight.com/images/evoup/cocos2d-js_android/09.png" alt="Alt text" /></p>

<p>这样就在runtime\android\下生成了projectFirst-debug-unaligned.apk</p>

<h3>在android模拟器测试</h3>

<p>这个只要注意如果是2d-js的项目，在模拟器里面是需要打开use host gpu<br>
<img src="http://evoupsight.com/images/evoup/cocos2d-js_android/10.png" alt="Alt text" /></p>

<p>启动模拟器后，用adb安装软件进去<br></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>%ANDROID_SDK_ROOT%/platform-tools/adb install c:<span class="se">\p</span>rojects<span class="se">\p</span>rojectFirst<span class="se">\r</span>untime<span class="se">\a</span>ndroid<span class="se">\p</span>rojectFirst-debug-unaligned.apk
</span></code></pre></td></tr></table></div></figure>


<p>安装完成后运行程序<br>
<img src="http://evoupsight.com/images/evoup/cocos2d-js_android/10.png" alt="Alt text" /></p>

<p>告一段落。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用CocoStudio创建骨骼动画（二）]]></title>
    <link href="http://evoupsight.com/blog/2014/03/18/use-cocostudio-create-bone-animation2/"/>
    <updated>2014-03-18T22:17:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/03/18/use-cocostudio-create-bone-animation2</id>
    <content type="html"><![CDATA[<p>上次的《使用CocoStudio创建骨骼动画》讨论到了如何创建骨骼和绑定骨骼关系，这节开始谈怎么创建帧动画。</p>

<p>我把上次的每个图层命名成每个骨骼后，更新后的：<a href="http://pan.baidu.com/s/1mg0UXJi" target=_blank>工作cocostudio源文件下载</a></p>

<!-- more -->


<p><img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation2/01.png" alt="Alt text" /></p>

<p>点击形体模式之后切换到动画模式<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation2/02.png" alt="Alt text" /></p>

<p>开始第一个帧动画的制作，右键点击动作列表Animation1<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation2/03.png" alt="Alt text" /></p>

<p>改名为stand,注意不要改成中文，否则以后写代码调用的时候可能会出现问题<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation2/04.png" alt="Alt text" /></p>

<p>用鼠标框选全部的帧<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation2/05.png" alt="Alt text" /></p>

<p>选择复制帧<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation2/06.png" alt="Alt text" /></p>

<p>在60帧处右键，然后点击粘帖帧<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation2/07.png" alt="Alt text" /></p>

<p>同样的方法，在30帧处右键点击粘帖帧<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation2/08.png" alt="Alt text" /></p>

<p>然后把时间轴移到到30帧<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation2/09.png" alt="Alt text" /></p>

<p>接下来编辑造型了，轻微旋转各个关节<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation2/10.png" alt="Alt text" /></p>

<p>点击隐藏骨骼，可以展现整体角色<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation2/11.png" alt="Alt text" /></p>

<p>看效果<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation2/animation.gif" alt="Alt text" /></p>

<p>然后再创建一个run的动作，如法炮制，未完待续&hellip;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Win7 Android开发环境搭建之二(NDK+CDT)]]></title>
    <link href="http://evoupsight.com/blog/2014/03/18/android-install-ndk-cdt/"/>
    <updated>2014-03-18T15:08:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/03/18/android-install-ndk-cdt</id>
    <content type="html"><![CDATA[<p>由于cocos2d-js用到了android的一些生产软件，比如android sdk、adt、cdt和ndk，前面两个已经在之前的《Win7 Android开发环境搭建之一(SDK+ADT)》说过了，这次主要介绍下怎么安装cdt和ndk。</p>

<!-- more -->


<h3>什么是NDK</h3>

<blockquote><p>NDK 提供了一系列的工具，帮助开发者快速开发C（或C++）的动态库，并能自动将so 和java 应用一起打包成apk。这些工具对开发者的帮助是巨大的。</p></blockquote>

<h3>NDK的安装</h3>

<p>这个安装其实就是解压（环境变量的添加要等装好了cygwin再添加，这是后话），下载android NDK。<a href="http://developer.android.com/tools/sdk/ndk/index.html">http://developer.android.com/tools/sdk/ndk/index.html</a></p>

<p>我下载的版本是android-ndk-r9d-windows-x86_64.zip<br>
下载后解压到例如：c:\android\android-ndk-r9d-windows-x86_64.zip，结果如下图：<br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/01.png" alt="Alt text" /></p>

<h3>安装cygwin与ndk编译</h3>

<p>（插一句：cygwin安装后与octopress的环境可能冲突，建议先安装octopress)</p>

<h4>安装cygwin</h4>

<p>ndk开发需要gcc环境，在windows下可以用是cygwin模拟linux编译环境。</p>

<p>Cygwin的下载地址：<a href="http://www.cygwin.com/">http://www.cygwin.com/</a></p>

<p>这个直接一路装，选择163的镜像<br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/02.png" alt="Alt text" /></p>

<p>选择Devel-Default，然后点击变成Devel-Install，然后持续点击下一步，耐心等待安装完成，时间是比较长的<br>
或者可以选择像网上许多教程说的那样只下载12个包，这个我就不这么做了<br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/03.png" alt="Alt text" /></p>

<h4>加入环境变量(可选，这样可以直接在cmd里进行cygwin.bat的操作)</h4>

<p>完成之后，需要把cygwin加入环境变量,我这里是安装在了c:/cygwin64,把c:/cygwin64/bin加入环境变量PATH<br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/04.png" alt="Alt text" /></p>

<h4>测试cygwin环境</h4>

<p>运行c:/cygwin64/Cygwin.bat,输入</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>cygcheck -c cygwin
</span><span class='line'>make -v
</span><span class='line'>gcc -v
</span></code></pre></td></tr></table></div></figure>


<p>如果显示ok就可以了，之前的报错cygheap base mismatch detected可以先忽略。<br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/05.png" alt="Alt text" /></p>

<h4>设置NDK路径：</h4>

<p>接下来在windows系统环境变量ndk中添加NDK的路径,刚刚我把NDK解压到C:\android\android-ndk-r9d-windows-x86_64\android-ndk-r9d<br>
然后在环境变量ndk加上它在cygwin shell里的对应路径/cygdrive/c/android/android-ndk-r9d-windows-x86_64/android-ndk-r9d<br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/06.png" alt="Alt text" /></p>

<p>编辑完成后，进入cygwin.bat输入<br></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd</span> <span class="nv">$ndk</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看到如下结果<br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/07.png" alt="Alt text" /></p>

<h4>测试NDK，编译一个例子</h4>

<p>例子可以在$ndk/sample/hello-jni中找到<br>
进入cygwin.bat中输入编译指令</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd</span> <span class="nv">$ndk</span>/sample/hello-jni
</span><span class='line'><span class="nv">$ndk</span>/ndk-build
</span></code></pre></td></tr></table></div></figure>


<p>一会儿就能编译完成，见下<br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/08.png" alt="Alt text" /></p>

<p>进入libs目录查看结果,观察是否生成了so文件，如果生成则说明你的NDK已经运行正常了。<br></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">cd </span>libs/armeabi/
</span><span class='line'><span class="nv">$ </span>ls
</span><span class='line'>gdb.setup  gdbserver  libhello-jni.so
</span></code></pre></td></tr></table></div></figure>


<h4>在Eclipse中完成代码调用</h4>

<p>接下来进入Eclipse，测试该项目,创建项目路径为C:\android\project\HelloJni<br>
在Create Android Project时勾选“Create project from existing source”，Root Directory中填C:\android\android-ndk-r9d-windows-x86_64\android-ndk-r9d\samples\hello-jni,如下<br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/09.png" alt="Alt text" /><br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/10.png" alt="Alt text" /><br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/11.png" alt="Alt text" /><br></p>

<p>看到如下字符串就代表NDK的例子运行成功了<br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/12.png" alt="Alt text" /></p>

<p>分析一下调用代码</p>

<figure class='code'><figcaption><span>HelloJni.java </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * Copyright (C) 2009 The Android Open Source Project</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span class='line'><span class="cm"> * you may not use this file except in compliance with the License.</span>
</span><span class='line'><span class="cm"> * You may obtain a copy of the License at</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *      http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * Unless required by applicable law or agreed to in writing, software</span>
</span><span class='line'><span class="cm"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
</span><span class='line'><span class="cm"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span class='line'><span class="cm"> * See the License for the specific language governing permissions and</span>
</span><span class='line'><span class="cm"> * limitations under the License.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">hellojni</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloJni</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="c1">//HelloJni继承自活动对象事件调度类</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="cm">/** Called when the activity is first created. */</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="c1">//重写onCreate方法</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/* Create a TextView and set its content.</span>
</span><span class='line'><span class="cm">         * the text is retrieved by calling a native</span>
</span><span class='line'><span class="cm">         * function.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="n">TextView</span>  <span class="n">tv</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextView</span><span class="o">(</span><span class="k">this</span><span class="o">);</span> <span class="c1">//创建一个文字view</span>
</span><span class='line'>        <span class="n">tv</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span> <span class="n">stringFromJNI</span><span class="o">()</span> <span class="o">);</span> <span class="c1">//调用自定义方法stringFromJNI</span>
</span><span class='line'>        <span class="n">setContentView</span><span class="o">(</span><span class="n">tv</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* A native method that is implemented by the</span>
</span><span class='line'><span class="cm">     * &#39;hello-jni&#39; native library, which is packaged</span>
</span><span class='line'><span class="cm">     * with this application.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">native</span> <span class="n">String</span>  <span class="nf">stringFromJNI</span><span class="o">();</span> <span class="c1">//有native代表是c++的代码，这里仅仅是声明</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* This is another native method declaration that is *not*</span>
</span><span class='line'><span class="cm">     * implemented by &#39;hello-jni&#39;. This is simply to show that</span>
</span><span class='line'><span class="cm">     * you can declare as many native methods in your Java code</span>
</span><span class='line'><span class="cm">     * as you want, their implementation is searched in the</span>
</span><span class='line'><span class="cm">     * currently loaded native libraries only the first time</span>
</span><span class='line'><span class="cm">     * you call them.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * Trying to call this function will result in a</span>
</span><span class='line'><span class="cm">     * java.lang.UnsatisfiedLinkError exception !</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">native</span> <span class="n">String</span>  <span class="nf">unimplementedStringFromJNI</span><span class="o">();</span> <span class="c1">//同样是C++的代码</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/* this is used to load the &#39;hello-jni&#39; library on application</span>
</span><span class='line'><span class="cm">     * startup. The library has already been unpacked into</span>
</span><span class='line'><span class="cm">     * /data/data/com.example.hellojni/lib/libhello-jni.so at</span>
</span><span class='line'><span class="cm">     * installation time by the package manager.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">static</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">&quot;hello-jni&quot;</span><span class="o">);</span> <span class="c1">//调用刚才ndk生成的hello-jni.so</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>C++的代码暂时就不看了，一步一步来，我们还没装cdt，不急着搞清楚，有兴趣的到文章最后去看链接</p>

<h3>什么是CDT</h3>

<blockquote><p>Eclipse CDT是 Eclipse 插件，它将把 Eclipse 转换为功能强大的 C/C++ IDE。它被设计为将 Java 开发人员喜爱的许多 Eclipse 优秀功能提供给 C/C++ 开发人员，例如项目管理、集成调试、类向导、自动构建、语法着色和代码完成。当 Eclipse 被用作 Java IDE 时，它将利用 JDK 并与之集成。同样地，CDT 将利用标准的 C/C++ 工具并与之集成，例如 g++、make 和 GDB。这使得 CDT 在 Linux 中变得非常流行，这些工具都可在 Linux 中使用并用于大多数 C++ 开发。可以在 Windows 上设置 CDT 以使用相同的工具。目前还在努力将 CDT 与 Microsoft 的 C++ 工具结合使用，以使 CDT 对 Windows C++ 开发人员更有吸引力。总之有了cdt，可以在一个工程里，同时开发C/C++的native代码的java外壳，并且2种代码能够同时编译。</p></blockquote>

<h3>在Eclipse编辑器中集成CDT</h3>

<p>首先在此下载<a href="http://www.eclipse.org/cdt/downloads.php">http://www.eclipse.org/cdt/downloads.php</a><br>
直接下载cdt-master-x.x.x.zip的就可以了，我的是Eclipse版本为Kepler，可以下载以下版本<br>
<a href="http://www.eclipse.org/downloads/download.php?file=/tools/cdt/releases/kepler/sr2/cdt-master-8.3.0.zip">http://www.eclipse.org/downloads/download.php?file=/tools/cdt/releases/kepler/sr2/cdt-master-8.3.0.zip</a></p>

<p><img src="http://evoupsight.com/images/evoup/android_cdt_ndk/13.png" alt="Alt text" /></p>

<p>然后通过Eclipse &ndash;> Help &ndash;> Install New Software &ndash;> add &ndash;> Achive,选择下载的zip文件</p>

<p><img src="http://evoupsight.com/images/evoup/android_cdt_ndk/14.png" alt="Alt text" /></p>

<p>等待安装完成<br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/15.png" alt="Alt text" /></p>

<p>安装完成后如果在Eclipse中可以创建C++项目证明安装完成<br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/16.png" alt="Alt text" /></p>

<h3>安装Sequoyah插件（事实证明，kepler+ndk9已经无须这个插件了）</h3>

<p><del> 官网地址 </del> <br>
<del> <a href="https://projects.eclipse.org/projects/tools.sequoyah">https://projects.eclipse.org/projects/tools.sequoyah</a> </del></p>

<p><del> 这个地址其实已经作废了,正确的连接如下 </del> <br>
<del> <a href="http://www.mirrorservice.org/sites/download.eclipse.org/eclipseMirror/sequoyah/updates/2.0/">http://www.mirrorservice.org/sites/download.eclipse.org/eclipseMirror/sequoyah/updates/2.0/</a> </del> <br>
<del> Eclipse-Help-Install New Software-Add,在Location里输入上面的地址，name就指定为sequoyah</del> <br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/17.png" alt="Alt text" />
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/18.png" alt="Alt text" /></p>

<p><del> 然后取消下面的Group By Item，之后选择Select All，按下Next安装（没有研究下去，发现这个要求的eclipse版本为3.7以下，我的kepler为4.3，不得以暂时放弃） </del></p>

<h3>JNI编译环境配置</h3>

<p>还是打开HelloJni这个项目，现在转换为C/C++的native的代码<br>
&ldquo;Eclipse->File->New->Other&rdquo;,选择&#8221;C/C++&ldquo;下的&#8221;Convert to a c/C++ Project(Add C/C++ Nature)&rdquo;,然后点击&#8221;Next&#8221;<br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/19.png" alt="Alt text" /></p>

<p>然后在Makefile project中选择Cygwin GCC,点击Finish<br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/20.png" alt="Alt text" /></p>

<p>右键项目的Properties，在&#8221;C/C++ Build&#8221;中取消默认的&#8221; Use default build command &ldquo;的打勾，在Build Command中输入对应bash加空格加ndk-build的路径，我这里是C:\android\android-ndk-r9d-windows-x86_64\android-ndk-r9d\ndk-build<br></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>bash C:<span class="se">\a</span>ndroid<span class="se">\a</span>ndroid-ndk-r9d-windows-x86_64<span class="se">\a</span>ndroid-ndk-r9d<span class="se">\n</span>dk-build
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://evoupsight.com/images/evoup/android_cdt_ndk/21.png" alt="Alt text" /></p>

<p>在&#8221;C/C++ General&#8221;的Paths and Symbols中：在Includes下add新的GNU C依赖路径,根据自己的avd（andriod virtual device）的版本设置对应的头文件，我这里是android17的，则C:\android\android-ndk-r9d-windows-x86_64\android-ndk-r9d\platforms\android-17\arch-arm\usr\include,其他项目可以安装实际环境酌情调整依赖头文件的版本<br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/22.png" alt="Alt text" /></p>

<p>验证：
将“/HelloJni/jni/hello-jni.c”中的字符串“Hello from JNI !”如改为“Hello JNI from test!”，运行后在模拟器上输出的字符串改变即说明配置成功。<br>
<img src="http://evoupsight.com/images/evoup/android_cdt_ndk/23.png" alt="Alt text" /></p>

<hr />

<h3>参考文章</h3>

<p>《Android NDK 安装与配置》
<a href="http://my.oschina.net/owen123456/blog/85658">http://my.oschina.net/owen123456/blog/85658</a></p>

<p>《Android: NDK编程入门笔记》
<a href="http://www.cnblogs.com/hibraincol/archive/2011/05/30/2063847.html">http://www.cnblogs.com/hibraincol/archive/2011/05/30/2063847.html</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用CocoStudio创建骨骼动画（一）]]></title>
    <link href="http://evoupsight.com/blog/2014/03/16/use-cocostudio-create-bone-animation1/"/>
    <updated>2014-03-16T00:28:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/03/16/use-cocostudio-create-bone-animation1</id>
    <content type="html"><![CDATA[<p>需要给哥么介绍怎么倒腾美术使用的美术创作工具CocoStudio（版本1.3）的Animation Editor，所以得先打个头阵研究一番，备忘一下。</p>

<!-- more -->


<p>打开之前我的另一篇《设计2D游戏玩家角色》博客里面提供的PSD源文件，然后开工。明确要怎么分割的部分：<br></p>

<h3>从PSD文件导出部件</h3>

<p>下面给出导出图层的规则，有+的代表有2个图层，复制的时候均采用ctrl+shift+c合并拷贝，再用ctrl+n创建新文件，最后ctrl+c粘帖到新文件上，然后导出为透明png24的方式：</p>

<p>左脚+左脚轮廓线=>左脚<br>
左腿+左腿轮廓线=>左腿<br>
左大腿+左大腿轮廓线=>左大腿<br>
右脚+右脚轮廓线=>右脚<br>
右小腿+右小腿轮廓线=>右小腿<br>
右大腿+右大腿轮廓线=>右大腿<br>
左手整手臂+左手整手臂轮廓线=>左手整手臂<br>
兜裆布=>兜裆布<br>
身体+身体轮廓线=>身体<br>
右手臂+右手臂轮廓线=>右手臂<br>
右手下臂+右手下臂轮廓线=>右手下臂<br>
胸衣=>胸衣<br>
围巾=>围巾<br>
头部+头部轮廓线=头部<br>
眼睛<br>
马尾+马尾轮廓线=>马尾<br>
头发+头发轮廓线=>头发<br>
发箍+发箍轮廓线=》发箍<br></p>

<p>最后得到这些图素<a href="http://pan.baidu.com/s/1bnzlv9X" target=_BLANK>cuted_player.zip</a></p>

<h3>打开CocoStudio操作</h3>

<p>接下来让我们打开CocoStudio开始编辑动画，首先进入Animation Editor<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/01.png" alt="Alt text" /></p>

<p>然后创建新项目，名为player_swordgirl<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/02.png" alt="Alt text" /></p>

<p>在界面右侧的资源窗口右键-“导入”-&ldquo;导入文件&rdquo;<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/03.png" alt="Alt text" /></p>

<p>完成导入<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/04.png" alt="Alt text" /></p>

<p>在主界面上点击创建骨骼，如果再次点击停止创建回到pose mode。我们先创建躯干部份的骨骼。<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/05.png" alt="Alt text" /></p>

<p><img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/06.png" alt="Alt text" /></p>

<p>创建完成之后，把身体的图片赋到该骨骼上，需要注意这里有个bug，就是直接点击骨骼然后把图片拖到右面XX的话，保存项目后，再次打开会发现图片消失了（没想到这个bug1.3还是没修好啊）。
规避这个问题的方法很简单，就是把图片先拖到骨骼旁边，然后右键选择绑定到骨头，这样就不会再消失了。<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/07.png" alt="Alt text" /></p>

<p><img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/08.png" alt="Alt text" /></p>

<p><img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/09.png" alt="Alt text" /></p>

<p>使用平移工具把身体放到骨骼外围，骨骼嘛自然要待在组织里啊
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/10.png" alt="Alt text" /></p>

<p>同样的方法创建出围巾
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/11.png" alt="Alt text" /></p>

<p>下面介绍一下骨骼的父关系，这个很好理解的，比如说身体和头，某种程度上说身体就是主躯干，外围设施（比如四肢、头、尾巴等）都是根据身体来依附上去的，这种依附关系的产生，导致移动身体其他外围设施是会跟着发生位移的，那么就可以称这些外围设施和身体有父关系，它的父关系是身体这块骨骼。
右击围巾选择绑定父关系到前一骨骼（身体所在的那块骨骼）<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/12.png" alt="Alt text" /></p>

<p>然后试着移动身体，你会发现围巾跟着移动了，很神奇不是吗？：）</p>

<p>接下来如法炮制了，我只讲下哪个绑定哪个<br>
头部绑定父关系到围巾<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/13.png" alt="Alt text" /></p>

<p>眼睛绑定父关系到头部，胸衣绑定父关系到头部<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/14.png" alt="Alt text" /></p>

<p>头发绑定父关系到头部<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/15.png" alt="Alt text" /></p>

<p>发箍绑定父关系到头部<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/16.png" alt="Alt text" /></p>

<p>马尾绑定父关系到发箍<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/17.png" alt="Alt text" /></p>

<p>右手臂绑定父关系到身体<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/18.png" alt="Alt text" /></p>

<p>右手下臂绑定父关系到右手臂<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/19.png" alt="Alt text" /></p>

<p>左手臂绑定父关系到身体<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/20.png" alt="Alt text" /></p>

<p>兜裆布绑定父关系到身体<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/21.png" alt="Alt text" /></p>

<p>左大腿绑定父关系到身体<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/22.png" alt="Alt text" /></p>

<p>右大腿绑定父关系到身体<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/23.png" alt="Alt text" /></p>

<p>左小腿绑定父关系到左大腿<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/24.png" alt="Alt text" /></p>

<p>右小腿绑定父关系到右大腿<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/25.png" alt="Alt text" /></p>

<p>左脚绑定父关系到左小腿<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/26.png" alt="Alt text" /></p>

<p>右脚绑定父关系到右小腿<br>
<img src="http://evoupsight.com/images/evoup/cocostudio_bone_animation/27.png" alt="Alt text" /></p>

<p><a href="http://pan.baidu.com/s/1dDIKi1V" target=_BLANK>CocoStudio项目源文件下载</a></p>

<p>下一篇将怎么做骨骼动画</p>

<p>思考：眨眼动画要怎么处理呢？</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[设计2D游戏玩家角色]]></title>
    <link href="http://evoupsight.com/blog/2014/03/14/2d-player-charactor-pratice/"/>
    <updated>2014-03-14T23:47:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/03/14/2d-player-charactor-pratice</id>
    <content type="html"><![CDATA[<p>目的，为cocos2d-x的编辑器制作好一个角色，为以后的demo做准备。<br>
最终稿（完成时间2小时+修正1小时，初次尝试，PS）</p>

<!-- more -->


<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/01.png" alt="Alt text" /></p>

<p>1.用2b铅笔绘制头部轮廓线，然后用柔边圆压力大小上次，这里的技巧是可以先用魔棒工具选择头部轮廓线图层内部，然后转到头部图层用alt + del填充，接着使用锁定透明色的方法继续用柔边圆压力大小上色，这样叠上去的颜色就不会画到轮廓线外面了。</p>

<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/02.png" alt="Alt text" /></p>

<p>2.继续在头部曾上画一层头发轮廓线，然后在后面加一层，按照上面的填充方法如法炮制画出头发</p>

<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/03.png" alt="Alt text" /></p>

<p>3.继续画出发箍</p>

<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/04.png" alt="Alt text" /></p>

<p>4.马尾，层位于头部以下</p>

<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/05.png" alt="Alt text" /></p>

<ol>
<li>围巾</li>
</ol>


<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/06.png" alt="Alt text" /></p>

<p>6.身体</p>

<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/07.png" alt="Alt text" /></p>

<p>7.胸衣</p>

<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/08.png" alt="Alt text" /></p>

<p>8.右手臂，画在最顶层</p>

<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/09.png" alt="Alt text" /></p>

<p>9.右手下臂</p>

<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/10.png" alt="Alt text" /></p>

<p>10.右大腿，身体后的一层</p>

<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/11.png" alt="Alt text" /></p>

<p>11.右小腿</p>

<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/12.png" alt="Alt text" /></p>

<p>12.左大腿，放到右大腿下层</p>

<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/13.png" alt="Alt text" /></p>

<p>13.右下腿</p>

<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/14.png" alt="Alt text" /></p>

<p>14.兜裆布</p>

<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/15.png" alt="Alt text" /></p>

<p>15.左手整手臂</p>

<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/16.png" alt="Alt text" /></p>

<p>16.到最后还不是最后(哈哈，孙艺真的《共犯》台词嘛)，其实下面才是重要的活啊，线稿太粗了，我们要用钢笔来修正。方法是用钢笔工具去照描，可以用ctrl点一下旁边来起新的路径，全部描绘好后，用以下设置</p>

<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/18.png" alt="Alt text" /></p>

<p>然后点击右键->描边路径，可以选压力（我这里没有选），见下：</p>

<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/17.png" alt="Alt text" /></p>

<p>就可以得到下面的结果了</p>

<p><img src="http://evoupsight.com/images/evoup/2dcharactor_cg/01.png" alt="Alt text" /></p>

<p>如果觉得路径碍事，可以用ctrl+shift+h来关闭显示，或者点击视图->显示->目标路径。</p>

<p>总结不足：下脚轮廓线其实可以去掉，像素外框线可以在圆润点，我只处理了头发那个图层，可以用第16步骤来修正。</p>

<p><a href="http://pan.baidu.com/s/1hqKFQ1e" target=_BLANK>PS源文件</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[导入nginx日志并采用hive进行统计]]></title>
    <link href="http://evoupsight.com/blog/2014/03/10/import-nginx-log-and-use-hive-to-caculate/"/>
    <updated>2014-03-10T16:07:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/03/10/import-nginx-log-and-use-hive-to-caculate</id>
    <content type="html"><![CDATA[<p>公司的日志本来是存成gzip或bz2格式直接导入到hdfs里去然后用程序直接mr的，速度是比较慢的。领导要求采用hive来计算，而在hive里建textfile表的这种方式，textfile是无法进行并行计算的，而且gzip和bz2做mr的速度是很慢的。所以准备采取先导入hdfs和textfile表，然后再转换为rcfile格式的表的策略。实际试验下来，如果一开始转换为文本或者是lzo格式，而不是采用gzip或bz2的格式的textfile的表，再转换为rcfile的方式会快很多，mr的速度也是比较快的。</p>

<p>下面描述一下过程</p>

<!-- more -->


<p>把全部日志上通过scp等方式传到服务器之后，要做的是先建一个textfile的表</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>create external table nginxlog <span class="o">(</span>ipaddress string, ...更多字段省略<span class="o">)</span> COMMENT <span class="s1">&#39;nginx log&#39;</span> ROW FORMAT DELIMITED FIELDS TERMINATED BY <span class="s1">&#39;,&#39;</span> stored as textfile    location <span class="s1">&#39;/data/log&#39;</span>;
</span></code></pre></td></tr></table></div></figure>


<p>把得到所有nginx日志，然后用lzop先压缩好，然后传到hdfs上去。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>tar xjf server01-20140131.txt.bz2
</span><span class='line'><span class="nv">$ </span>tar xjf server02-20140131.txt.bz2
</span><span class='line'><span class="nv">$ </span>lzop server01-20140131.txt
</span><span class='line'><span class="nv">$ </span>lzop server02-20140131.txt
</span><span class='line'><span class="nv">$ </span>server01-20140131.txt.lzo server02-20140131.txt.lzo
</span><span class='line'><span class="nv">$ </span>/u01/app/hadoop fs -put server01-20140131.txt.lzo /data/log/server01-20140131.txt.lzo
</span><span class='line'><span class="nv">$ </span>/u01/app/hadoop fs -put server01-20140131.txt.lzo /data/log/server02-20140131.txt.lzo
</span><span class='line'><span class="nv">$/</span>u01/app/hadoop/bin/hadoop fs -ls /data/log/
</span><span class='line'>Found 2 items
</span><span class='line'>-rw-r--r--   1 hadoop supergroup  364459530 2014-03-07 18:10 /data/log/server01-20140131.txt.lzo
</span><span class='line'>-rw-r--r--   1 hadoop supergroup  364459530 2014-03-10 13:31 /data/log/server02-20140201.txt.lzo
</span></code></pre></td></tr></table></div></figure>


<p>然后马上就可以查询了</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>hive&gt; <span class="k">select </span>count<span class="o">(</span>*<span class="o">)</span> from nginxlog;
</span><span class='line'>Total MapReduce <span class="nb">jobs</span> <span class="o">=</span> 1
</span><span class='line'>Launching Job 1 out of 1
</span><span class='line'>Number of reduce tasks determined at compile <span class="nb">time</span>: 1
</span><span class='line'>In order to change the average load <span class="k">for </span>a reducer <span class="o">(</span>in bytes<span class="o">)</span>:
</span><span class='line'>  <span class="nb">set </span>hive.exec.reducers.bytes.per.reducer<span class="o">=</span>&lt;number&gt;
</span><span class='line'>In order to limit the maximum number of reducers:
</span><span class='line'>  <span class="nb">set </span>hive.exec.reducers.max<span class="o">=</span>&lt;number&gt;
</span><span class='line'>In order to <span class="nb">set </span>a constant number of reducers:
</span><span class='line'>  <span class="nb">set </span>mapred.reduce.tasks<span class="o">=</span>&lt;number&gt;
</span><span class='line'>Starting <span class="nv">Job</span> <span class="o">=</span> job_201403101051_0004, Tracking <span class="nv">URL</span> <span class="o">=</span> http://mdn2.net:50030/jobdetails.jsp?jobid<span class="o">=</span>job_201403101051_0004
</span><span class='line'>Kill <span class="nv">Command</span> <span class="o">=</span> /u01/app/hadoop/bin/../bin/hadoop job  -Dmapred.job.tracker<span class="o">=</span>mdn2.net:9025 -kill job_201403101051_0004
</span><span class='line'>2014-03-10 14:17:41,179 Stage-1 <span class="nv">map</span> <span class="o">=</span> 0%,  <span class="nv">reduce</span> <span class="o">=</span> 0%
</span><span class='line'>2014-03-10 14:18:20,815 Stage-1 <span class="nv">map</span> <span class="o">=</span> 50%,  <span class="nv">reduce</span> <span class="o">=</span> 0%
</span><span class='line'>2014-03-10 14:18:32,927 Stage-1 <span class="nv">map</span> <span class="o">=</span> 100%,  <span class="nv">reduce</span> <span class="o">=</span> 0%
</span><span class='line'>2014-03-10 14:18:38,971 Stage-1 <span class="nv">map</span> <span class="o">=</span> 100%,  <span class="nv">reduce</span> <span class="o">=</span> 17%
</span><span class='line'>2014-03-10 14:18:41,991 Stage-1 <span class="nv">map</span> <span class="o">=</span> 100%,  <span class="nv">reduce</span> <span class="o">=</span> 100%
</span><span class='line'>Ended <span class="nv">Job</span> <span class="o">=</span> job_201403101051_0004
</span><span class='line'>OK
</span><span class='line'>2492916
</span><span class='line'>Time taken: 75.321 seconds
</span></code></pre></td></tr></table></div></figure>


<p>这么做也是可以使用hive的，但是速度还是比较慢。于是可以再创建一个rcfile格式的表，然后再查询</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>bin/hive&gt; create external table nginxlog2 <span class="o">(</span>ipaddress string, ...,更多字段<span class="o">)</span> COMMENT <span class="s1">&#39;nginx log rcfile format&#39;</span> ROW FORMAT DELIMITED FIELDS TERMINATED BY <span class="s1">&#39;,&#39;</span> stored as RCFile    location <span class="s1">&#39;/data/log2&#39;</span>;
</span></code></pre></td></tr></table></div></figure>


<p>然后用</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>hive&gt; SET hive.exec.compress.output<span class="o">=</span><span class="nb">true</span>;
</span><span class='line'>hive&gt; SET io.rcfile.compression.type<span class="o">=</span>BLOCK;
</span><span class='line'>hive&gt; insert overwrite table nginxlog2 <span class="k">select</span> * from nginxlog;
</span><span class='line'>Total MapReduce <span class="nb">jobs</span> <span class="o">=</span> 2
</span><span class='line'>Launching Job 1 out of 2
</span><span class='line'>Number of reduce tasks is <span class="nb">set </span>to 0 since there<span class="err">&#39;</span>s no reduce operator
</span><span class='line'>Starting <span class="nv">Job</span> <span class="o">=</span> job_201403101051_0007, Tracking <span class="nv">URL</span> <span class="o">=</span> http://mdn2.net:50030/jobdetails.jsp?jobid<span class="o">=</span>job_201403101051_0007
</span><span class='line'>Kill <span class="nv">Command</span> <span class="o">=</span> /u01/app/hadoop/bin/../bin/hadoop job  -Dmapred.job.tracker<span class="o">=</span>mdn2.net:9025 -kill job_201403101051_0007
</span><span class='line'>2014-03-10 15:20:20,959 Stage-1 <span class="nv">map</span> <span class="o">=</span> 0%,  <span class="nv">reduce</span> <span class="o">=</span> 0%
</span><span class='line'>2014-03-10 15:21:21,267 Stage-1 <span class="nv">map</span> <span class="o">=</span> 0%,  <span class="nv">reduce</span> <span class="o">=</span> 0%
</span><span class='line'>2014-03-10 15:22:21,627 Stage-1 <span class="nv">map</span> <span class="o">=</span> 0%,  <span class="nv">reduce</span> <span class="o">=</span> 0%
</span><span class='line'>2014-03-10 15:23:22,320 Stage-1 <span class="nv">map</span> <span class="o">=</span> 0%,  <span class="nv">reduce</span> <span class="o">=</span> 0%
</span><span class='line'>2014-03-10 15:23:36,542 Stage-1 <span class="nv">map</span> <span class="o">=</span> 100%,  <span class="nv">reduce</span> <span class="o">=</span> 0%
</span><span class='line'>2014-03-10 15:23:42,665 Stage-1 <span class="nv">map</span> <span class="o">=</span> 100%,  <span class="nv">reduce</span> <span class="o">=</span> 100%
</span><span class='line'>Ended <span class="nv">Job</span> <span class="o">=</span> job_201403101051_0007
</span><span class='line'>Ended <span class="nv">Job</span> <span class="o">=</span> -1308159129, job is filtered out <span class="o">(</span>removed at runtime<span class="o">)</span>.
</span><span class='line'>Moving data to: hdfs://mdn2.net:9024/tmp/hive-hadoop/hive_2014-03-10_15-20-15_076_2561493179927538497/-ext-10000
</span><span class='line'>Loading data to table default.nginxlog2
</span><span class='line'>Deleted hdfs://mdn2.net:9024/data/log2
</span><span class='line'>Table default.nginxlog2 stats: <span class="o">[</span>num_partitions: 0, num_files: 0, num_rows: 0, total_size: 0<span class="o">]</span>
</span><span class='line'>2492916 Rows loaded to nginxlog2
</span><span class='line'>OK
</span><span class='line'>Time taken: 209.088 seconds
</span></code></pre></td></tr></table></div></figure>


<p>然后再次select，对比一下时间</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>hive&gt; <span class="k">select </span>count<span class="o">(</span>*<span class="o">)</span> from nginxlog2;
</span><span class='line'>Total MapReduce <span class="nb">jobs</span> <span class="o">=</span> 1
</span><span class='line'>Launching Job 1 out of 1
</span><span class='line'>Number of reduce tasks determined at compile <span class="nb">time</span>: 1
</span><span class='line'>In order to change the average load <span class="k">for </span>a reducer <span class="o">(</span>in bytes<span class="o">)</span>:
</span><span class='line'>  <span class="nb">set </span>hive.exec.reducers.bytes.per.reducer<span class="o">=</span>&lt;number&gt;
</span><span class='line'>In order to limit the maximum number of reducers:
</span><span class='line'>  <span class="nb">set </span>hive.exec.reducers.max<span class="o">=</span>&lt;number&gt;
</span><span class='line'>In order to <span class="nb">set </span>a constant number of reducers:
</span><span class='line'>  <span class="nb">set </span>mapred.reduce.tasks<span class="o">=</span>&lt;number&gt;
</span><span class='line'>Starting <span class="nv">Job</span> <span class="o">=</span> job_201403101051_0008, Tracking <span class="nv">URL</span> <span class="o">=</span> http://mdn2.net:50030/jobdetails.jsp?jobid<span class="o">=</span>job_201403101051_0008
</span><span class='line'>Kill <span class="nv">Command</span> <span class="o">=</span> /u01/app/hadoop/bin/../bin/hadoop job  -Dmapred.job.tracker<span class="o">=</span>mdn2.net:9025 -kill job_201403101051_0008
</span><span class='line'>2014-03-10 15:26:21,984 Stage-1 <span class="nv">map</span> <span class="o">=</span> 0%,  <span class="nv">reduce</span> <span class="o">=</span> 0%
</span><span class='line'>2014-03-10 15:26:31,031 Stage-1 <span class="nv">map</span> <span class="o">=</span> 33%,  <span class="nv">reduce</span> <span class="o">=</span> 0%
</span><span class='line'>2014-03-10 15:26:43,107 Stage-1 <span class="nv">map</span> <span class="o">=</span> 67%,  <span class="nv">reduce</span> <span class="o">=</span> 0%
</span><span class='line'>2014-03-10 15:26:49,140 Stage-1 <span class="nv">map</span> <span class="o">=</span> 67%,  <span class="nv">reduce</span> <span class="o">=</span> 17%
</span><span class='line'>2014-03-10 15:26:52,153 Stage-1 <span class="nv">map</span> <span class="o">=</span> 100%,  <span class="nv">reduce</span> <span class="o">=</span> 22%
</span><span class='line'>2014-03-10 15:27:04,225 Stage-1 <span class="nv">map</span> <span class="o">=</span> 100%,  <span class="nv">reduce</span> <span class="o">=</span> 100%
</span><span class='line'>Ended <span class="nv">Job</span> <span class="o">=</span> job_201403101051_0008
</span><span class='line'>OK
</span><span class='line'>2492916
</span><span class='line'>Time taken: 55.656 seconds
</span></code></pre></td></tr></table></div></figure>


<p>我这里是2个节点， 55.656s，相比textfile的75.321s，rcfile的有20秒的优势，当然并行计算的节点越多，时间就越省。</p>

<p>这里要补充一下：不通过本地导入的方式直接导入rcfile的原因，是因为textfile格式才支持从本地导入，sequencefile和rcfile均不支持，所以只能先搞一个表再复制。如果用textfile加gzip或bz2的表再复制到rcfile的表，时间会很长；而用textfile+lzo的表再复制到rcfile的表，时间比较短。lzo相对gzip或bz2压缩速度快但是相对压缩比没有优势，然而再转为rcfile格式mr会很快，这样hive查询就很快。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[centos下hadoop0.20的LZO压缩支持]]></title>
    <link href="http://evoupsight.com/blog/2014/03/07/centos-hadoop0-dot-20-lzo-support/"/>
    <updated>2014-03-07T11:00:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/03/07/centos-hadoop0-dot-20-lzo-support</id>
    <content type="html"><![CDATA[<h3>首先安装lzo库</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>wget http://www.oberhumer.com/opensource/lzo/download/lzo-2.04.tar.gz
</span><span class='line'>tar xzf lzo-2.04.tar.gz
</span><span class='line'><span class="nb">cd </span>lzo-2.04
</span><span class='line'>./configure --enable-shared
</span><span class='line'>make
</span><span class='line'>sudo make install
</span></code></pre></td></tr></table></div></figure>


<p>安装完成后拷贝/usr/local/lib目录下的lzo库文件到/usr/lib(32位平台)或者/usr/lib64(64位平台)</p>

<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo cp /usr/local/lib/liblzo2* /usr/lib
</span></code></pre></td></tr></table></div></figure>


<p>ps：应该是这些文件</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>liblzo2.a
</span><span class='line'>liblzo2.la
</span><span class='line'>liblzo2.so
</span><span class='line'>liblzo2.so.2
</span><span class='line'>liblzo2.so.2.0.0
</span></code></pre></td></tr></table></div></figure>


<p>在/etc/ld.so.conf.d/目录下新建lzo.conf文件，写入lzo库文件的路径/usr/local/lib，然后运行/sbin/ldconfig -v，使配置生效。</p>

<h3>然后安装hadoop-LZO</h3>

<p>我这里是hadoop0.20版本，就下kevinweil的版本
git clone <a href="https://github.com/kevinweil/hadoop-lzo">https://github.com/kevinweil/hadoop-lzo</a></p>

<p>然后安装ant
/etc/profile中</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">ANT_HOME</span><span class="o">=</span>/home/hadoop/apache-ant-1.9.3
</span><span class='line'><span class="nv">PATH</span><span class="o">=</span><span class="nv">$ANT_HOME</span>/bin:<span class="nv">$PATH</span>
</span><span class='line'><span class="nb">export </span>PATH
</span></code></pre></td></tr></table></div></figure>


<p>然后source /etc/profile</p>

<p>然后指定好CFLAGS和CXXFLAGS开始编译</p>

<h4>32位os</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">CFLAGS</span><span class="o">=</span>-m32
</span><span class='line'><span class="nb">export </span><span class="nv">CXXFLAGS</span><span class="o">=</span>-m32
</span><span class='line'>ant compile-native tar
</span></code></pre></td></tr></table></div></figure>


<h4>64位os</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">CFLAGS</span><span class="o">=</span>-m64
</span><span class='line'><span class="nb">export </span><span class="nv">CXXFLAGS</span><span class="o">=</span>-m64
</span><span class='line'>ant compile-native tar
</span></code></pre></td></tr></table></div></figure>


<p>等待编译完成</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tar:
</span><span class='line'>      <span class="o">[</span>tar<span class="o">]</span> Building tar: /home/hadoop/project/hadoop-lzo/build/hadoop-lzo-0.4.15.tar.gz
</span><span class='line'>
</span><span class='line'>BUILD SUCCESSFUL
</span><span class='line'>Total <span class="nb">time</span>: 23 seconds
</span></code></pre></td></tr></table></div></figure>


<p>然后把本地库和jar包拷贝到hadoop的目录下，并分发到各节点</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd </span>build
</span><span class='line'>cp hadoop-lzo-0.4.15.jar /u01/app/hadoop/lib
</span><span class='line'>cp -r native/Linux-i386-32/* /u01/app/hadoop/lib/native/Linux-i386-32/
</span><span class='line'><span class="c">#如果是64位应该是Linux-amd64-64</span>
</span></code></pre></td></tr></table></div></figure>


<h3>安装shell工具lzop</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget http://www.lzop.org/download/lzop-1.03.tar.gz
</span><span class='line'>./configure
</span><span class='line'>make
</span><span class='line'>sudo make install
</span></code></pre></td></tr></table></div></figure>


<p>使用</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#压缩</span>
</span><span class='line'>lzop test.log
</span><span class='line'><span class="c">#查看解压内容</span>
</span><span class='line'>lzop -cd test.log.lzo | less
</span><span class='line'><span class="c">#解压</span>
</span><span class='line'>lzop -x test.log.lzo
</span></code></pre></td></tr></table></div></figure>


<h3>配置hadoop的core-site.xml和mapred-site.xml</h3>

<p>core-site.xml</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;property&gt;
</span><span class='line'>        &lt;name&gt;io.compression.codecs&lt;/name&gt; &lt;value&gt;org.apache.hadoop.io.compress.DefaultCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec&lt;/value&gt;
</span><span class='line'>        &lt;!-- 配置 Hadoop 压缩包 --&gt;
</span><span class='line'>&lt;/property&gt;
</span><span class='line'>&lt;property&gt;
</span><span class='line'>        &lt;name&gt;io.compression.codec.lzo.class&lt;/name&gt;
</span><span class='line'>        &lt;value&gt;com.hadoop.compression.lzo.LzoCodec&lt;/value&gt;
</span><span class='line'>&lt;/property&gt;
</span></code></pre></td></tr></table></div></figure>


<p>mapred-site.xml</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;property&gt;
</span><span class='line'>      &lt;name&gt;mapred.compress.map.output&lt;/name&gt;
</span><span class='line'>      &lt;value&gt;true&lt;/value&gt;
</span><span class='line'>      &lt;!-- map 和 reduce 输出中间文件默认开启压缩 --&gt;
</span><span class='line'>  &lt;/property&gt;
</span><span class='line'>  &lt;property&gt;
</span><span class='line'>         &lt;name&gt;mapred.map.output.compression.codec&lt;/name&gt;
</span><span class='line'>         &lt;value&gt;com.hadoop.compression.lzo.LzoCodec&lt;/value&gt;
</span><span class='line'>  &lt;/property&gt;
</span><span class='line'>  &lt;property&gt;
</span><span class='line'>         &lt;name&gt;mapred.child.env&lt;/name&gt;
</span><span class='line'>         &lt;value&gt;LD_LIBRARY_PATH<span class="o">=</span>/u01/app/hadoop/lib/native/Linux-i386-32&lt;/value&gt;
</span><span class='line'> &lt;/property&gt;
</span></code></pre></td></tr></table></div></figure>


<h3>启动hadoop并测试lzo</h3>

<p>用lzop压缩一个文件，然后上传到hdfs</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bin/start-all.sh
</span><span class='line'>lzop test.txt
</span><span class='line'>/u01/app/hadoop/bin/hadoop -put test.txt.lzo /testlzo/test.txt.lzo
</span></code></pre></td></tr></table></div></figure>


<p>然后通过创建lzo索引来测试lzo是否已经支持</p>

<p>在hadoop的conf的hadoop-env.sh中指定好HADOOP_CLASSPATH,然后就不用再</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>bin/hadoop jar lib/hadoop-lzo-0.4.15.jar com.hadoop.compression.lzo.LzoIndexer /testlzo/test.txt.lzo
</span></code></pre></td></tr></table></div></figure>


<p>而直接使用</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>bin/hadoop com.hadoop.compression.lzo.LzoIndexer /testlzo/test.log.lzo
</span></code></pre></td></tr></table></div></figure>


<p>也可以使用分布式版本</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>bin/hadoop com.hadoop.compression.lzo.DistributedLzoIndexer /testlzo/test.log.lzo
</span></code></pre></td></tr></table></div></figure>


<p>报错</p>

<blockquote><p>14/03/06 18:37:14 ERROR lzo.GPLNativeCodeLoader: Could not load native gpl library
java.lang.UnsatisfiedLinkError: no gplcompression in java.library.path</p>

<pre><code>   at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1738)
   at java.lang.Runtime.loadLibrary0(Runtime.java:823)
   at java.lang.System.loadLibrary(System.java:1028)
   at com.hadoop.compression.lzo.GPLNativeCodeLoader.&lt;clinit&gt;(GPLNativeCodeLoader.java:32)
   at com.hadoop.compression.lzo.LzoCodec.&lt;clinit&gt;(LzoCodec.java:71)
   at com.hadoop.compression.lzo.LzoIndexer.&lt;init&gt;(LzoIndexer.java:36)
   at com.hadoop.compression.lzo.LzoIndexer.main(LzoIndexer.java:134)
</code></pre>

<p>14/03/06 18:37:14 ERROR lzo.LzoCodec: Cannot load native-lzo without native-hadoop
14/03/06 18:37:14 INFO lzo.LzoIndexer: [INDEX] LZO Indexing file /testlzo/x.log.lzo, size 0.00 GB&hellip;
Exception in thread &ldquo;main&rdquo; java.lang.RuntimeException: native-lzo library not available</p>

<pre><code>   at com.hadoop.compression.lzo.LzopCodec.createDecompressor(LzopCodec.java:104)
   at com.hadoop.compression.lzo.LzoIndex.createIndex(LzoIndex.java:229)
   at com.hadoop.compression.lzo.LzoIndexer.indexSingleFile(LzoIndexer.java:117)
   at com.hadoop.compression.lzo.LzoIndexer.indexInternal(LzoIndexer.java:98)
   at com.hadoop.compression.lzo.LzoIndexer.index(LzoIndexer.java:52)
   at com.hadoop.compression.lzo.LzoIndexer.main(LzoIndexer.java:137)
</code></pre></blockquote>

<p>看似是GPLNativeCodeLoader没有装，其实是路径不对</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>hadoop@mdn2 lib<span class="o">]</span><span class="nv">$ls</span> -la /u01/app/hadoop/lib/native/Linux-i386-32/lib
</span><span class='line'>total 184
</span><span class='line'>drwxrwxr-x 2 hadoop hadoop  4096 Mar  6 14:10 .
</span><span class='line'>drwxrwxrwx 5 hadoop hadoop  4096 Mar  7 10:52 ..
</span><span class='line'>-rw-r--r-- 1 hadoop hadoop 76502 Mar  6 14:10 libgplcompression.a
</span><span class='line'>-rw-rw-r-- 1 hadoop hadoop  1128 Mar  6 14:10 libgplcompression.la
</span><span class='line'>lrwxrwxrwx 1 hadoop hadoop    26 Mar  6 14:10 libgplcompression.so -&gt; libgplcompression.so.0.0.0
</span><span class='line'>lrwxrwxrwx 1 hadoop hadoop    26 Mar  6 14:10 libgplcompression.so.0 -&gt; libgplcompression.so.0.0.0
</span><span class='line'>-rwxrwxr-x 1 hadoop hadoop 59281 Mar  6 14:10 libgplcompression.so.0.0.0
</span></code></pre></td></tr></table></div></figure>


<p>其实只要把这几个库复制到上级目录即可</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>cp /u01/app/hadoop/lib/native/Linux-i386-32/lib/* /u01/app/hadoop/lib/native/Linux-i386-32/
</span></code></pre></td></tr></table></div></figure>


<p>然后</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>hadoop@mdn2 hadoop<span class="o">]</span><span class="nv">$bin</span>/hadoop com.hadoop.compression.lzo.LzoIndexer /testlzo/x.log.lzo
</span><span class='line'>14/03/07 10:52:33 INFO lzo.GPLNativeCodeLoader: Loaded native gpl library
</span><span class='line'>14/03/07 10:52:33 INFO lzo.LzoCodec: Successfully loaded &amp; initialized native-lzo library <span class="o">[</span>hadoop-lzo rev 6bb1b7f8b9044d8df9b4d2b6641db7658aab3cf8<span class="o">]</span>
</span><span class='line'>14/03/07 10:52:34 INFO lzo.LzoIndexer: <span class="o">[</span>INDEX<span class="o">]</span> LZO Indexing file /testlzo/x.log.lzo, size 0.00 GB...
</span><span class='line'>14/03/07 10:52:34 INFO lzo.LzoIndexer: Completed LZO Indexing in 0.15 seconds <span class="o">(</span>0.00 MB/s<span class="o">)</span>.  Index size is 0.01 KB.
</span></code></pre></td></tr></table></div></figure>


<p>终于成功。</p>

<p>参考：</p>

<p>《hadoop安装lzo》
<a href="http://blog.csdn.net/wanglinzi/article/details/12318743">http://blog.csdn.net/wanglinzi/article/details/12318743</a></p>

<p>《lzo安装说明(2)》
<a href="http://www.350351.com/jiagoucunchu/Hadoop/83863_2.html">http://www.350351.com/jiagoucunchu/Hadoop/83863_2.html</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[hadoop报错：Incompatible namespaceIDs]]></title>
    <link href="http://evoupsight.com/blog/2014/02/24/hadoop-error-incompatible-namespaceids/"/>
    <updated>2014-02-24T17:08:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/02/24/hadoop-error-incompatible-namespaceids</id>
    <content type="html"><![CDATA[<p>今天在修改hadoop主机名重新格式化namenode之后，重新启动hadoop，发现datanode无法启动起来。</p>

<p>报错：HADOOP报错<code>Incompatible namespaceIDs</code></p>

<p>查看报告发现没有启动一个datanode</p>

<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$/</span>u01/app/hadoop/bin/hadoop dfsadmin -report
</span><span class='line'>Configured Capacity: 0 <span class="o">(</span>0 KB<span class="o">)</span>
</span><span class='line'>Present Capacity: 0 <span class="o">(</span>0 KB<span class="o">)</span>
</span><span class='line'>DFS Remaining: 0 <span class="o">(</span>0 KB<span class="o">)</span>
</span><span class='line'>DFS Used: 0 <span class="o">(</span>0 KB<span class="o">)</span>
</span><span class='line'>DFS Used%: �%
</span><span class='line'>Under replicated blocks: 0
</span><span class='line'>Blocks with corrupt replicas: 0
</span><span class='line'>Missing blocks: 0
</span><span class='line'>
</span><span class='line'>-------------------------------------------------
</span><span class='line'>Datanodes available: 0 <span class="o">(</span>0 total, 0 dead<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>原来是要求datanode的VERSION文件和namenode的要一致</p>

<p>于是到namenode上看文件</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>hadoop@mdn2 current<span class="o">]</span><span class="nv">$more</span> /u01/app/hadoopTmp/dfs/name/current/VERSION
</span><span class='line'><span class="c">#Mon Feb 24 16:48:12 CST 2014</span>
</span><span class='line'><span class="nv">namespaceID</span><span class="o">=</span>1235115105
</span><span class='line'><span class="nv">cTime</span><span class="o">=</span>0
</span><span class='line'><span class="nv">storageType</span><span class="o">=</span>NAME_NODE
</span><span class='line'><span class="nv">layoutVersion</span><span class="o">=</span>-31
</span></code></pre></td></tr></table></div></figure>


<p>namespaceID为1235115105</p>

<p>到datanode里查看发现不存在</p>

<h3>解决方法两种任选其一：</h3>

<p>1）在datanode的&lt;dfs.data.dir>/current/VERSION中指定一个一模一样的namespaceID=1235115105，然后重启datanode</p>

<p>2）在格式化namenode的时候要清空/tmp目录下所有有关hadoop的目录，不论是namenode还是datanode所在的机器</p>

<h4>参考文章</h4>

<p><a href="http://blog.csdn.net/wanghai__/article/details/5752199">http://blog.csdn.net/wanghai__/article/details/5752199</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[hive初试--导入数据和查询]]></title>
    <link href="http://evoupsight.com/blog/2014/02/20/hive-import-data/"/>
    <updated>2014-02-20T10:50:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/02/20/hive-import-data</id>
    <content type="html"><![CDATA[<p>hive虽然是基于hadoop的map/reduce进行云计算，但是自身需要依赖一个元数据表，要么是derby，要么是mysql，相同点总归是要先导入数据，然后才能进行处理。其原理是把结构化的数据文件映射为一张数据库表，然后将SQL语句转化为MapReduce任务进行运行，以绕过专门开发MapReduce这样一个逆向思维的产物。</p>

<p>Hive不可以改写、插入和删除数据，换句话说hive完全就是用来进行计算的。</p>

<p>Hive的数据是存在hdfs上的,所以数据导入之后除了元数据之外，还有另一份本体数据（通常比较大的）存在hdfs上。</p>

<p>有了基础概念之后，开始正题了。</p>

<!-- more -->


<h3>环境描述</h3>

<p>hadoop0.20.203+hive0.7</p>

<h3>任务描述</h3>

<p>本次目的，是把一张二维表导入到hive中后，然后根据编号查询对应的单词。</p>

<h3>过程描述</h3>

<p>假设有这样一个文件test.txt</p>

<p><img src="http://evoupsight.com/images/evoup/hive_test_txt.png" alt="Alt text" /></p>

<p>(vim党注意：如果你已经把tab键映射为4个空格，那么请进入插入模式后在数字后ctrl+v,然后按下<tab>键，再输入单词，否则无法完成制表符的键入，数据导入失败。)</p>

<p>启动hive建表:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>hive&gt;  CREATE EXTERNAL TABLE MYTEST<span class="o">(</span>id INT, name STRING<span class="o">)</span>
</span><span class='line'>&gt; COMMENT <span class="s1">&#39;this is a test&#39;</span>
</span><span class='line'>&gt; ROW FORMAT DELIMITED FIELDS TERMINATED BY <span class="s1">&#39;\t&#39;</span>
</span><span class='line'>&gt; STORED AS TEXTFILE
</span><span class='line'>&gt;LOCATION <span class="s1">&#39;/data/test&#39;</span>;
</span><span class='line'>OK
</span></code></pre></td></tr></table></div></figure>


<p>注意这一步要求原本的hdfs目录下没有/data/test文件夹，如果有的话，hive是要报错的。
还有存储格式有三种textfile、rcfile和sequencefile。其中多数情况用textfile就可以了，如果要压缩，可以考虑后两者。</p>

<p>进入hadoop，开始导入</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>/bin/hadoop fs -put test.txt /data/test
</span></code></pre></td></tr></table></div></figure>


<p>回到hive，用简单的HQL查询语句查询id为4的记录</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>hive&gt; <span class="k">select</span> * from mytest where <span class="nv">id</span> <span class="o">=</span> 4;
</span><span class='line'>Total MapReduce <span class="nb">jobs</span> <span class="o">=</span> 1
</span><span class='line'>Launching Job 1 out of 1
</span><span class='line'>Number of reduce tasks is <span class="nb">set </span>to 0 since there<span class="err">&#39;</span>s no reduce operator
</span><span class='line'>Starting <span class="nv">Job</span> <span class="o">=</span> job_201402191826_0007, Tracking <span class="nv">URL</span> <span class="o">=</span> http://mdn2.net:50030/jobdetails.jsp?jobid<span class="o">=</span>job_201402191826_0007
</span><span class='line'>Kill <span class="nv">Command</span> <span class="o">=</span> /u01/app/hadoop/bin/../bin/hadoop job  -Dmapred.job.tracker<span class="o">=</span>mdn2.net:9025 -kill job_201402191826_0007
</span><span class='line'>2014-02-20 00:16:34,842 Stage-1 <span class="nv">map</span> <span class="o">=</span> 0%,  <span class="nv">reduce</span> <span class="o">=</span> 0%
</span><span class='line'>2014-02-20 00:16:40,889 Stage-1 <span class="nv">map</span> <span class="o">=</span> 100%,  <span class="nv">reduce</span> <span class="o">=</span> 0%
</span><span class='line'>2014-02-20 00:16:46,936 Stage-1 <span class="nv">map</span> <span class="o">=</span> 100%,  <span class="nv">reduce</span> <span class="o">=</span> 100%
</span><span class='line'>Ended <span class="nv">Job</span> <span class="o">=</span> job_201402191826_0007
</span><span class='line'>OK
</span><span class='line'>4       <span class="k">case</span>
</span><span class='line'>Time taken: 21.36 seconds
</span></code></pre></td></tr></table></div></figure>


<p>hive查询一次需要21秒?没错，这就是MapReduce查询的特点了，换做mysql的话这样查询一次应该是&lt;1秒的。好啦，收工。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[centos5.8下基于hadoop0.20.203的hive0.7安装]]></title>
    <link href="http://evoupsight.com/blog/2014/02/17/hadoop0-dot-20-dot-2-plus-hive0-dot-7/"/>
    <updated>2014-02-17T15:38:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/02/17/hadoop0-dot-20-dot-2-plus-hive0-dot-7</id>
    <content type="html"><![CDATA[<h3>什么是hive</h3>

<blockquote><p>hive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供简单的sql查询功能，可以将sql语句转换为MapReduce任务进行运行。 其优点是学习成本低，可以通过类SQL语句快速实现简单的MapReduce统计，不必开发专门的MapReduce应用，十分适合数据仓库的统计分析。</p></blockquote>

<h3>hive使用场景</h3>

<blockquote><p>HIVE 不适合用于联机(online)事务处理,也不提供实时查询功能。它最适合应用在基于大量不可变数据的批处理作业。</p></blockquote>

<!-- more -->


<h3>hive的安装</h3>

<p>先提一下，之前我的hadoop安装在/u01/app/hadoop目录下，同样的我们下载到改目录下，然后开始安装
注意我的hadoop版本为hadooop-0.20.203.0.tgz，与此匹配的版本为hive0.7.0</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd</span> /u01/app
</span><span class='line'>wget http://archive.apache.org/dist/hive/hive-0.7.1/hive-0.7.1-bin.tar.gz
</span><span class='line'>tar xzf hive-0.7.1-bin.tar.gz
</span><span class='line'>ln -s hive-0.7.1-bin.tar.gz hive
</span></code></pre></td></tr></table></div></figure>


<h4>环境变量设置</h4>

<p>在~/.profile中加入</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">export </span><span class="nv">HIVE_HOME</span><span class="o">=</span>/u01/app/hive
</span><span class='line'><span class="nb">export </span><span class="nv">HIVE_CONF_DIR</span><span class="o">=</span>/u01/app/hive/conf
</span></code></pre></td></tr></table></div></figure>


<p>在系统中指出hive的配置文件所在</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$HIVE_HOME</span>/bin:PATH
</span></code></pre></td></tr></table></div></figure>


<p>这个实现输入hive，hive service就会自动相应，而不用输入hive所在的绝对路径。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">export </span><span class="nv">HIVE_LIB</span><span class="o">=</span><span class="nv">$HIVE_HOME</span>/lib
</span></code></pre></td></tr></table></div></figure>


<p>记得用source让profile生效</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">source</span> ~/.profile
</span></code></pre></td></tr></table></div></figure>


<p>然后是进行hive配置文件的配置</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd</span> /u01/app/hive/conf
</span><span class='line'>cp hive-env.sh.template hive-env.sh
</span><span class='line'>vim hive-env.sh
</span></code></pre></td></tr></table></div></figure>


<h4>安装依赖软件</h4>

<p>发现有2种安装方式，一种是derby,另一种是mysql，这里先介绍mysql方式</p>

<blockquote><p>关于什么是derby: 这是一个apache DB的子项目，是一个完全用java实现的开源关系型数据库。这里就不使用了，我们采用mysql。</p></blockquote>

<h4>安装mysql</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>//卸载老版本的mysql软件包
</span><span class='line'>yum remove mysql mysql-*
</span><span class='line'>//安装mysql5.5的源
</span><span class='line'>rpm -Uvh http://repo.webtatic.com/yum/centos/5/latest.rpm
</span><span class='line'>//安装MySQL客户端的支持包
</span><span class='line'>yum install libmysqlclient15 --enablerepo<span class="o">=</span>webtatic
</span><span class='line'>//安装MySQL 5.5的客户端和服务端
</span><span class='line'>yum install mysql55 mysql55-server --enablerepo<span class="o">=</span>webtatic
</span><span class='line'>//启动MySQL系统服务，更新数据库
</span><span class='line'>/etc/init.d/mysqld restart
</span><span class='line'>mysql_upgrade
</span></code></pre></td></tr></table></div></figure>


<h4>修改mysql用户密码</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># mysql -u root mysql   //默认的没有密码直接进去的</span>
</span><span class='line'>mysql&gt;use mysql;
</span><span class='line'>mysql&gt;desc user;
</span><span class='line'>mysql&gt; GRANT ALL PRIVILEGES ON *.* TO root@<span class="s2">&quot;%&quot;</span> IDENTIFIED BY <span class="s2">&quot;root&quot;</span>;　　//为root添加远程连接的能力。
</span><span class='line'>mysql&gt;update user <span class="nb">set </span><span class="nv">Password</span> <span class="o">=</span> password<span class="o">(</span><span class="s1">&#39;xxxxxx&#39;</span><span class="o">)</span> where <span class="nv">User</span><span class="o">=</span><span class="s1">&#39;root&#39;</span>;
</span><span class='line'>mysql&gt;select Host,User,Password  from user where <span class="nv">User</span><span class="o">=</span><span class="s1">&#39;root&#39;</span>;
</span><span class='line'>mysql&gt;flush privileges;
</span><span class='line'>mysql&gt;exit
</span></code></pre></td></tr></table></div></figure>


<h4>设置mysql为开机自动启动</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo /sbin/chkconfig --add mysqld
</span><span class='line'>sudo /sbin/chkconfig mysqld on
</span></code></pre></td></tr></table></div></figure>


<h4>开始配置</h4>

<p>在conf目录下创建hive-site.xml</p>

<p>创建hive数据库给hive做元数据表</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>create database hive;
</span><span class='line'>grant all privileges on *.* to hive@localhost identified by <span class="s1">&#39;hive&#39;</span>;
</span><span class='line'>flush privileges;
</span></code></pre></td></tr></table></div></figure>


<p>运行hive</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd</span> /u01/app/hive
</span><span class='line'>/bin/hive
</span><span class='line'>Exception in thread <span class="s2">&quot;main&quot;</span> java.lang.NoClassDefFoundError: jline/ArgumentCompletor<span class="nv">$ArgumentDelimiter</span>
</span><span class='line'>        at java.lang.Class.forName0<span class="o">(</span>Native Method<span class="o">)</span>
</span><span class='line'>        at java.lang.Class.forName<span class="o">(</span>Class.java:247<span class="o">)</span>
</span><span class='line'>        at org.apache.hadoop.util.RunJar.main<span class="o">(</span>RunJar.java:149<span class="o">)</span>
</span><span class='line'>Caused by: java.lang.ClassNotFoundException: jline.ArgumentCompletor<span class="nv">$ArgumentDelimiter</span>
</span><span class='line'>        at java.net.URLClassLoader<span class="nv">$1</span>.run<span class="o">(</span>URLClassLoader.java:202<span class="o">)</span>
</span><span class='line'>        at java.security.AccessController.doPrivileged<span class="o">(</span>Native Method<span class="o">)</span>
</span><span class='line'>        at java.net.URLClassLoader.findClass<span class="o">(</span>URLClassLoader.java:190<span class="o">)</span>
</span><span class='line'>        at java.lang.ClassLoader.loadClass<span class="o">(</span>ClassLoader.java:306<span class="o">)</span>
</span><span class='line'>        at java.lang.ClassLoader.loadClass<span class="o">(</span>ClassLoader.java:247<span class="o">)</span>
</span><span class='line'>        ... 3 more
</span></code></pre></td></tr></table></div></figure>


<p>这个只需要把hive/lib下的jline-0.9.94.jar复制到$HADOOP/lib下即可。</p>

<p>再次启动</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>bin/hive
</span><span class='line'>Exception in thread <span class="s2">&quot;main&quot;</span> java.lang.NoClassDefFoundError: org/apache/hadoop/hive/conf/HiveConf
</span><span class='line'>        at java.lang.Class.forName0<span class="o">(</span>Native Method<span class="o">)</span>
</span><span class='line'>        at java.lang.Class.forName<span class="o">(</span>Class.java:247<span class="o">)</span>
</span><span class='line'>        at org.apache.hadoop.util.RunJar.main<span class="o">(</span>RunJar.java:149<span class="o">)</span>
</span><span class='line'>Caused by: java.lang.ClassNotFoundException: org.apache.hadoop.hive.conf.HiveConf
</span><span class='line'>        at java.net.URLClassLoader<span class="nv">$1</span>.run<span class="o">(</span>URLClassLoader.java:202<span class="o">)</span>
</span><span class='line'>        at java.security.AccessController.doPrivileged<span class="o">(</span>Native Method<span class="o">)</span>
</span><span class='line'>        at java.net.URLClassLoader.findClass<span class="o">(</span>URLClassLoader.java:190<span class="o">)</span>
</span><span class='line'>        at java.lang.ClassLoader.loadClass<span class="o">(</span>ClassLoader.java:306<span class="o">)</span>
</span><span class='line'>        at java.lang.ClassLoader.loadClass<span class="o">(</span>ClassLoader.java:247<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>需要修改$HADOOP/conf/的hadoop-env.sh中的</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">export </span><span class="nv">HADOOP_CLASSPATH</span><span class="o">=</span><span class="nv">$HBASE_HOME</span>/hbase-0.90.3.jar:<span class="nv">$HBASE_HOME</span>:<span class="nv">$HBASE_HOME</span>/lib/zookeeper-3.2.2.jar:<span class="nv">$HBASE_HOME</span>/conf
</span></code></pre></td></tr></table></div></figure>


<p>改成</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">export </span><span class="nv">HADOOP_CLASSPATH</span><span class="o">=</span><span class="nv">$HADOOP_CLASSPATH</span>:<span class="nv">$HBASE_HOME</span>/hbase-0.90.3.jar:<span class="nv">$HBASE_HOME</span>:<span class="nv">$HBASE_HOME</span>/lib/zookeeper-3.2.2.jar:<span class="nv">$HBASE_HOME</span>/conf
</span></code></pre></td></tr></table></div></figure>


<p>然后可以启动hive了</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>bin/hive
</span><span class='line'>WARNING: org.apache.hadoop.metrics.jvm.EventCounter is deprecated. Please use org.apache.hadoop.log.metrics.EventCounter in all the log4j.properties files.
</span><span class='line'>Hive <span class="nb">history </span><span class="nv">file</span><span class="o">=</span>/tmp/hadoop/hive_job_log_hadoop_201402170220_1889385824.txt
</span><span class='line'>hive&gt;
</span></code></pre></td></tr></table></div></figure>


<p>有警告，估计是jdk我用的1.7导致的，可以先不管，接下来可以试试hive的操作了。</p>

<p>•建立测试表test</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>&gt; create table <span class="nb">test</span> <span class="o">(</span>key string<span class="o">)</span>;
</span><span class='line'>&gt; show tables;
</span><span class='line'>FAILED: Error in metadata: javax.jdo.JDOFatalInternalException: Error creating transactional connection factory
</span><span class='line'>NestedThrowables:
</span><span class='line'>java.lang.reflect.InvocationTargetException
</span><span class='line'>FAILED: Execution Error, <span class="k">return </span>code 1 from org.apache.hadoop.hive.ql.exec.DDLTask
</span></code></pre></td></tr></table></div></figure>


<p>原来如果mysql用rpm安装，还需要一个jar包mysql-connector-java-5.15-bin.jar，然后拷贝到hive的lib目录下可以。</p>

<p>&#8220;sh</p>

<blockquote><p>show tables;
OK
Time taken: 0.082 seconds</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>一个表也没有，创建表吧
</span><span class='line'>···sh
</span><span class='line'>&gt; create table <span class="nb">test</span> <span class="o">(</span>key string<span class="o">)</span>;
</span><span class='line'>FAILED: Error in metadata: MetaException<span class="o">(</span>message:Got exception: org.apache.hadoop.ipc.RemoteException org.apache.hadoop.hdfs.server.namenode.SafeModeException: Cannot create directory /user/hive/warehouse/test. Name node is in safe mode.
</span></code></pre></td></tr></table></div></figure>


<p>namenode为什么是安全模式？
hadoop启动的时候是在安全模式，查看一下现在的模式状态</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>bin/hadoop dfsadmin –safemode get
</span><span class='line'>ON
</span></code></pre></td></tr></table></div></figure>


<p>那就关了</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>bin/hadoop dfsadmin -safemode leave
</span></code></pre></td></tr></table></div></figure>


<p>再次查看</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>bin/hadoop dfsadmin –safemode get
</span><span class='line'>OFF
</span></code></pre></td></tr></table></div></figure>


<p>已经关了，再次建表测试</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>bin/hive
</span><span class='line'>hive&gt; create table <span class="nb">test</span> <span class="o">(</span>key string<span class="o">)</span>;
</span><span class='line'>OK
</span><span class='line'>Time taken: 0.521 seconds
</span><span class='line'>hive&gt; show tables;
</span><span class='line'>OK
</span><span class='line'><span class="nb">test</span>
</span><span class='line'>Time taken: 0.14 seconds
</span></code></pre></td></tr></table></div></figure>


<h3>参考文章</h3>

<p><a href="http://blog.163.com/huang_zhong_yuan/blog/static/174975283201181371146365/">http://blog.163.com/huang_zhong_yuan/blog/static/174975283201181371146365/</a></p>

<p><a href="http://hi.baidu.com/allense7en/item/db8e5b4fb177aae81e19bcb4">http://hi.baidu.com/allense7en/item/db8e5b4fb177aae81e19bcb4</a></p>

<p><a href="http://www.cnblogs.com/zhanghuijunjava/archive/2013/04/22/hadoop_HDFS.html">http://www.cnblogs.com/zhanghuijunjava/archive/2013/04/22/hadoop_HDFS.html</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[64位freebsd8.1下安装ffmpeg和php扩展]]></title>
    <link href="http://evoupsight.com/blog/2014/02/12/freebsd8-dot-1amd64-install-ffmpeg-and-php-extension/"/>
    <updated>2014-02-12T17:27:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/02/12/freebsd8-dot-1amd64-install-ffmpeg-and-php-extension</id>
    <content type="html"><![CDATA[<p>帮同事解决一个开源音视频转换处理软件ffmpeg在freebsd8.1下安装的问题，我也是装了2个下午，绕了个圈子下载了个没用的扩展浪费时间。</p>

<!-- more -->


<h3>环境freebsd8.1 amd64</h3>

<p>我拿个了干净的系统做试验，安装的时候选择了develop模式和customize，customize里只选择了ports,然后php是装在了/usr/local/php53目录下。</p>

<h3>安装过程描述</h3>

<h4>ffmpeg的安装</h4>

<p>主要采用pkg_add ffmpeg.tbz的方式来安装。
然后看报错的依赖缺少啥一个一个装上去，途中需要的包可以通过下面的命令来获取：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>fetch ftp://ftp.fi.freebsd.org/pub/FreeBSD/ports/amd64/packages-8.1-release/Latest/ffmpeg.tbz
</span><span class='line'>fetch ftp://ftp.fi.freebsd.org/pub/FreeBSD/ports/amd64/packages-8.1-release/Latest/x264.tbz
</span></code></pre></td></tr></table></div></figure>


<p>采用pkg_add快速安装包
安装的时候反正就是不断用下面的语句试探</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo pkg_add ffmpeg.tbz
</span></code></pre></td></tr></table></div></figure>


<p>用pkg_add一个一个装，直到ffmpeg安装完成。</p>

<p>如果你也是这么装，那么全部东西下完，大概有这么多依赖OMG</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>&gt;ls
</span><span class='line'>damageproto.tbz  gpac-libgpac.tbz  libXau.tbz      libdrm.tbz            libvorbis.tbz   png.tbz               xvid.tbz
</span><span class='line'>dri2proto.tbz    jpeg.tbz          libXdamage.tbz  libiconv.tbz          libxcb.tbz      schroedinger.tbz
</span><span class='line'>expat.tbz        kbproto.tbz       libXdmcp.tbz    libogg.tbz            libxml.tbz      x264.tbz
</span><span class='line'>faad2.tbz        libGL.tbz         libXext.tbz     libpthread-stubs.tbz  libxml2.tbz     xextproto.tbz
</span><span class='line'>ffmpeg.tbz       libGLU.tbz        libXfixes.tbz   libtheora.tbz         orc.tbz         xf86vidmodeproto.tbz
</span><span class='line'>fixesproto.tbz   libX11.tbz        libXxf86vm.tbz  libtool.tbz           pkg-config.tbz  xproto.tbz
</span></code></pre></td></tr></table></div></figure>


<p>嫌麻烦的可以先下好软件然后批量装</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>find . -name <span class="s2">&quot;*.tbz&quot;</span> -exec pkg_add <span class="o">{}</span> <span class="se">\;</span>
</span></code></pre></td></tr></table></div></figure>


<p>当然也免不了部分手动来部分包，窃喜~</p>

<hr />

<h4>ffmpeg-php的安装</h4>

<p>装php，./configure的时候出现出错，查看config.log
<code>/usr/bin/ld: cannot find -liconv</code>
需要再用pkg_add安装libxml，重新安装libiconv，用port安装，谈到要安装libtool213,再用pkg_add去装，卸掉libiconv，重新用port安装，下载php5.3编译通过，再去下载ffmpeg-php，用phpize的方式编译成动态库，会报告少autoconf，此时在到port里安装autoconf213，会让安装perl，等待安装完成就是。</p>

<p>下载正确的扩展,不要用sf那个2005年的扩展，不能用。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>fetch http://downloads.sourceforge.net/project/ffmpeg-php/ffmpeg-php/0.6.0/ffmpeg-php-0.6.0.tbz2
</span><span class='line'>tar xjf ffmpeg-php-0.6.0.tbz2
</span><span class='line'><span class="nb">cd </span>ffmpeg-php
</span><span class='line'>phpize
</span></code></pre></td></tr></table></div></figure>


<p>在phpize的时候可能出现</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">[</span>evoup@freebsd81amd64 ffmpeg<span class="o">]</span>&gt;/usr/local/php53/bin/phpize
</span><span class='line'>Configuring <span class="k">for</span>:
</span><span class='line'>PHP Api Version:         20090626
</span><span class='line'>Zend Module Api No:      20090626
</span><span class='line'>Zend Extension Api No:   220090626
</span><span class='line'>Cannot find autoconf. Please check your autoconf installation and the
</span><span class='line'><span class="nv">$PHP_AUTOCONF</span> environment variable. Then, rerun this script.
</span></code></pre></td></tr></table></div></figure>


<p>此时需要在环境变量中指定好autoconf和autoheader的路径，我是加载.cshrc文件中</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>setenv PHP_AUTOCONF <span class="s2">&quot;/usr/local/bin/autoconf&quot;</span>
</span><span class='line'>setenv PHP_AUTOHEADER <span class="s2">&quot;/usr/local/bin/autoheader&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>完事之后不要忘记重载~/.cshrc</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">source</span> ~/.cshrc
</span></code></pre></td></tr></table></div></figure>


<p>phpize完了之后可以开始configure了</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>./configure --with-php-cofig<span class="o">=</span>/usr/local/php53/bin/php-config
</span><span class='line'>/usr/local/include/ffmpeg/avcodec.h:30:30: error: libavutil/avutil.h: No such file or directory
</span></code></pre></td></tr></table></div></figure>


<p>其实这个是ffmpeg安装好应该有的库</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>locate avutil.h
</span><span class='line'>/usr/home/evoup/software/libavutil/avutil.h
</span><span class='line'>/usr/local/include/ffmpeg/avutil.h
</span><span class='line'>/usr/local/include/libavutil/avutil.h
</span></code></pre></td></tr></table></div></figure>


<p>怎么装上去？嘿嘿，直接把相关的路径做软连接</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo ln -s /usr/local/include/libavcodec/ /usr/include/libavcodec/
</span><span class='line'>sudo ln -s /usr/local/include/libavcodec/ /usr/include/libavcodec
</span><span class='line'>sudo ln -s /usr/local/include/libavdevice/ /usr/include/libavdevice
</span><span class='line'>sudo ln -s /usr/local/include/libavfilter/ /usr/include/libavfilter
</span><span class='line'>sudo ln -s /usr/local/include/libavformat/ /usr/include/libavformat
</span><span class='line'>sudo ln -s /usr/local/include/libavutil/ /usr/include/libavutil
</span></code></pre></td></tr></table></div></figure>


<p>然后再次</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>make
</span><span class='line'>sudo make install
</span><span class='line'>Installing shared extensions:     /usr/local/php53/lib/php/extensions/no-debug-non-zts-20090626/
</span></code></pre></td></tr></table></div></figure>


<p>安装ok,接下来加载到php,要做的是看下php的ini位置，放进去就是</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>/usr/local/php53/bin/php -i | grep Conf
</span><span class='line'>Configure <span class="nv">Command</span> <span class="o">=</span>&gt;  <span class="s1">&#39;./configure&#39;</span>  <span class="s1">&#39;--prefix=/usr/local/php53&#39;</span>
</span><span class='line'>Configuration File <span class="o">(</span>php.ini<span class="o">)</span> <span class="nv">Path</span> <span class="o">=</span>&gt; /usr/local/php53/lib
</span><span class='line'>Loaded Configuration <span class="nv">File</span> <span class="o">=</span>&gt; /usr/local/php53/lib/php.ini
</span><span class='line'>Configuration
</span></code></pre></td></tr></table></div></figure>


<p>说明在/usr/local/php53/lib下，于是把编译好的so移到该目录下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo mv /usr/local/php53/lib/php/extensions/no-debug-non-zts-20090626/ffmpeg.so /usr/local/php53/lib
</span></code></pre></td></tr></table></div></figure>


<p>最后在php.ini中指定</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">extension</span><span class="o">=</span>ffmpeg.so
</span></code></pre></td></tr></table></div></figure>


<hr />

<p>观察劳动成果</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>/usr/local/php53/bin/php -i | grep ffmpeg
</span><span class='line'>ffmpeg
</span><span class='line'>ffmpeg-php <span class="nv">version</span> <span class="o">=</span>&gt; 0.6.0-svn
</span><span class='line'>ffmpeg-php built <span class="nv">on</span> <span class="o">=</span>&gt; Feb 12 2014 17:10:47
</span><span class='line'>ffmpeg-php gd <span class="nv">support</span>  <span class="o">=</span>&gt; disabled
</span><span class='line'>ffmpeg libavcodec <span class="nv">version</span> <span class="o">=</span>&gt; Lavc52.20.1
</span><span class='line'>ffmpeg libavformat <span class="nv">version</span> <span class="o">=</span>&gt; Lavf52.31.0
</span><span class='line'>ffmpeg <span class="nv">swscaler</span> <span class="o">=</span>&gt; disabled
</span><span class='line'>ffmpeg.allow_persistent <span class="o">=</span>&gt; <span class="nv">0</span> <span class="o">=</span>&gt; 0
</span><span class='line'>ffmpeg.show_warnings <span class="o">=</span>&gt; <span class="nv">0</span> <span class="o">=</span>&gt; 0
</span></code></pre></td></tr></table></div></figure>


<p>没问题收工。</p>

<p>参考互联网文章《编译FFMpeg和FFMpeg-php》linux版的</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[VS2010 LINK:fatal error LNK1123]]></title>
    <link href="http://evoupsight.com/blog/2014/02/10/vs2010-link-fatal-error-lnk1123/"/>
    <updated>2014-02-10T15:22:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/02/10/vs2010-link-fatal-error-lnk1123</id>
    <content type="html"><![CDATA[<p>因为要看cocostudio的实例代码，在原有vs2010的基础上又安装了vs2012，出现了项目不能编译的问题OMG
<code>LINK : fatal error LNK1123: 转换到 COFF 期间失败: 文件无效或损坏</code>
以下为解决方法：</p>

<!-- more -->


<blockquote><p>VS2010在经历一些更新后，建立Win32 Console Project时会出“error LNK1123” 错误，解决方案为将 项目|项目属性|配置属性|清单工具|输入和输出|嵌入清单 “是”改为“否”即可，但是没新建一个项目都要这样设置一次。
在建立VS2010 Win32 Project项目时，按照上面解决方案依然发生了“error LNK1123”错误，经过上网查资料，解决方案为：
第一步：与上相同。
第二步：将 项目|项目属性|配置属性|连接器|清单文件|嵌入清单 “是”改为“否”。
第三步：一般计算机经过上两步设置就能解决问题了，但是如果还有问题，那就按一下方法解决：
计算机是否为64bit操作系统，如是，继续2。
查找是否有两个cvtres.exe。一个是C:\Program Files (x86)\Microsoft Visual Studio 10.0\VC\bin\cvtres.exe， 另一个是C:\Windows\Microsoft.NET\Framework\v4.0.30319\cvtres.exe。右键属性|详细信息 查看两者版本号，删除/重命名较旧的版本，或者重新设置Path变量。
删除或者重命名比较旧的版本的cvtres.exe即可。</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[octopress2报错undefined method `[] for nill:NilClass]]></title>
    <link href="http://evoupsight.com/blog/2014/02/09/octopress2-undefined-method-for-nill-nilclass/"/>
    <updated>2014-02-09T22:32:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/02/09/octopress2-undefined-method-for-nill-nilclass</id>
    <content type="html"><![CDATA[<p>今天在用octopress生成博客静态页的时候，出现如下警告
<code>Liquid Exception: undefined method '[]' for nil:NilClass</code>
看下错误上下文先，上次记得这个问题是括号不能连写导致的，这次又是为啥呢？</p>

<!-- more -->


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake generate
</span><span class='line'>## Generating Site with Jekyll
</span><span class='line'>unchanged sass/screen.scss
</span><span class='line'>Configuration from E:/octopress2/evoup.github.com/_config.yml
</span><span class='line'>Building site: source -&gt; public
</span><span class='line'>## Generating Categories..
</span><span class='line'> =&gt; Creating Categories Tag Cloud
</span><span class='line'> =&gt; Creating Categories Sidebar
</span><span class='line'>Liquid Exception: undefined method `[]' for nil:NilClass in 2014-02-08-cocos2d-x
</span><span class='line'>-cocos2d-iphone-cocos2d-html5-sprite-and-animation-summary.markdown
</span><span class='line'>E:/octopress2/evoup.github.com/plugins/pygments_code.rb:14:in `highlight'
</span><span class='line'>E:/octopress2/evoup.github.com/plugins/code_block.rb:82:in `render'
</span><span class='line'>c:/Ruby193/lib/ruby/gems/1.9.1/gems/liquid-2.3.0/lib/liquid/block.rb:94:in `bloc
</span><span class='line'>k in render_all'
</span><span class='line'>c:/Ruby193/lib/ruby/gems/1.9.1/gems/liquid-2.3.0/lib/liquid/block.rb:92:in `coll
</span><span class='line'>ect'
</span><span class='line'>c:/Ruby193/lib/ruby/gems/1.9.1/gems/liquid-2.3.0/lib/liquid/block.rb:92:in `rend
</span><span class='line'>er_all'
</span><span class='line'>c:/Ruby193/lib/ruby/gems/1.9.1/gems/liquid-2.3.0/lib/liquid/block.rb:82:in `rend</span></code></pre></td></tr></table></div></figure>


<p>是看来是语法高亮的语法问题，认为代码有错，2个括号居然不能分开写：</p>

<blockquote><p>sprite->setPosition( ccp(100, 240) ); //设置坐标为x=100,y=240
<br/>
必须写成sprite->setPosition(ccp(100, 240)); //设置坐标为x=100,y=240</p></blockquote>

<p>以下问题发现在这个ruby版本
ruby 1.9.3p484 (2013-11-22) [i386-mingw32]</p>

<p>但奇怪的是公司里的环境没有问题，先记一笔备忘。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[cocos2d-x cocos2d-iphone cocos2d-html5下加载精灵的总结]]></title>
    <link href="http://evoupsight.com/blog/2014/02/08/cocos2d-x-cocos2d-iphone-cocos2d-html5-load-sprite-summary/"/>
    <updated>2014-02-08T13:10:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/02/08/cocos2d-x-cocos2d-iphone-cocos2d-html5-load-sprite-summary</id>
    <content type="html"><![CDATA[<p>加载精灵的几种套路，以下总结下cocos2d-x v2.2.2、cocos2d-iphone v0.99b和cocos2d-html5 v2.2.2三个平台下的创建显示图片和帧动画的方法：</p>

<!-- more -->


<blockquote><p><i>直接从图片创建：</i></p></blockquote>

<figure class='code'><figcaption><span>cocos2d-x </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="n">CCSprite</span> <span class="o">*</span><span class="n">sprite</span><span class="o">=</span><span class="n">CCSprite</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;res/pic.png&quot;</span><span class="p">);</span> <span class="c1">//从pic.png创建一个精灵</span>
</span><span class='line'><span class="n">sprite</span><span class="o">-&gt;</span><span class="n">setPosition</span><span class="p">(</span><span class="n">ccp</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">240</span><span class="p">));</span> <span class="c1">//设置坐标为x=100,y=240</span>
</span><span class='line'><span class="n">sprite</span><span class="o">-&gt;</span><span class="n">setScale</span><span class="p">(</span><span class="mf">0.5</span><span class="p">);</span> <span class="c1">//缩小50%</span>
</span><span class='line'><span class="k">this</span><span class="o">-&gt;</span><span class="n">addChild</span><span class="p">(</span><span class="n">sprite</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span> <span class="c1">//加载到this场景对象下</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>cocos2d-iphone </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">CCSprite</span> <span class="o">*</span><span class="n">sprite</span> <span class="o">=</span> <span class="p">[</span><span class="n">CCSprite</span> <span class="nl">spriteWithFile:</span><span class="s">@&quot;res/pic.png&quot;</span><span class="p">];</span> <span class="c1">//从pic.png创建一个精灵</span>
</span><span class='line'><span class="n">sprite</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">ccp</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">240</span><span class="p">);</span> <span class="c1">//设置坐标为x=100,y=240</span>
</span><span class='line'><span class="n">sprite</span><span class="p">.</span><span class="n">scale</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">//缩小50%</span>
</span><span class='line'><span class="p">[</span><span class="n">self</span> <span class="nl">addChild:</span><span class="n">sprite</span> <span class="nl">z:</span><span class="mi">0</span><span class="p">];</span> <span class="c1">//加载到self场景对象下</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>cocos2d-html5 </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">sprite</span><span class="p">;</span> <span class="c1">//定义sprite变量</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">sprite</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Sprite</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;res/pic.png&quot;</span><span class="p">);</span> <span class="c1">//从pic.png创建一个精灵</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="k">new</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">240</span><span class="p">));</span> <span class="c1">//设置坐标为x=100,y=240</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">scale</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="c1">//缩小50%</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">//加载到this场景对象下</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<blockquote><p><i>batchnode显示大量精灵：</i>
<br />注意：batchnode的限制是所有添加到它里面的CCSprite节点的Z轴顺序必须相同，且须使用相同纹理。</p></blockquote>

<figure class='code'><figcaption><span>cocos2d-x </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="n">CCSpriteBatchNode</span> <span class="o">*</span> <span class="n">batchNode</span> <span class="o">=</span> <span class="n">CCSpriteBatchNode</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;pic.png&quot;</span><span class="p">);</span> <span class="c1">//创建批渲染对象</span>
</span><span class='line'><span class="k">this</span><span class="o">-&gt;</span><span class="n">addChild</span><span class="p">(</span><span class="n">batchNode</span><span class="p">);</span> <span class="c1">//批渲染对象加载到self场景对象下</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">CCSprite</span> <span class="o">*</span><span class="n">sprite</span> <span class="o">=</span> <span class="n">CCSprite</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;pic.png&quot;</span><span class="p">);</span> <span class="c1">//载入图片到精灵，方法效率看起来可以优化（code来自《cocos2d-x游戏开发之旅》）</span>
</span><span class='line'>  <span class="n">batchNode</span><span class="o">-&gt;</span><span class="n">addChild</span><span class="p">(</span><span class="n">sprite</span><span class="p">);</span> <span class="c1">//将精灵添加到批渲染对象</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>cocos2d-iphone </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">CCSpriteBatchNode</span> <span class="o">*</span> <span class="n">batchNode</span> <span class="o">=</span> <span class="p">[</span><span class="n">CCSpriteBatchNode</span> <span class="nl">batchNodeWithFile:</span>
</span><span class='line'>    <span class="s">@&quot;pic.png&quot;</span><span class="p">];</span> <span class="c1">//创建批渲染对象</span>
</span><span class='line'><span class="p">[</span><span class="n">self</span> <span class="nl">addChild:</span><span class="n">batch</span><span class="p">];</span> <span class="c1">//批渲染对象加载到self场景对象下</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">CCSprite</span> <span class="o">*</span><span class="n">sprite</span> <span class="o">=</span> <span class="p">[</span><span class="n">CCSpriteBatchNode</span> <span class="nl">batchNodeWithFile:</span><span class="s">@&quot;pic.png&quot;</span><span class="p">];</span> <span class="c1">//载入图片到精灵</span>
</span><span class='line'>  <span class="p">[</span><span class="n">batchNode</span> <span class="nl">addChild:</span><span class="n">sprite</span><span class="p">];</span> <span class="c1">//将精灵添加到批渲染对象</span>
</span><span class='line'><span class="p">}</span>  
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>cocos2d-html5 </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//首先定义好资源</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">batchNode</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">SpriteBatchNode</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;pic.png&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span> <span class="c1">//定义批渲染对象</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">batchNode</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span> <span class="c1">//把批渲染节点加到this场景对象</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//载入100个精灵并分别加到批渲染节点</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">sprite</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Sprite</span><span class="p">.</span><span class="nx">createWithTexture</span><span class="p">(</span><span class="nx">batchNode</span><span class="p">.</span><span class="nx">getTexture</span><span class="p">(),</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">121</span><span class="p">));</span>
</span><span class='line'>    <span class="nx">batchNode</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">sprite</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<blockquote><p><i>batchnode加framecache结合显示单帧图片</i></p></blockquote>

<figure class='code'><figcaption><span>cocos2d-x </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="n">CCSpriteBatchNode</span> <span class="o">*</span><span class="n">batchNode</span> <span class="o">=</span> <span class="n">CCSpriteBatchNode</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;resource.png&quot;</span><span class="p">);</span> <span class="c1">//创建批渲染对象</span>
</span><span class='line'><span class="k">this</span><span class="o">-&gt;</span><span class="n">addChild</span><span class="p">(</span><span class="n">batchNode</span><span class="p">);</span> <span class="c1">//批渲染对象加载到this场景对象下</span>
</span><span class='line'><span class="n">CCSpriteFrameCache</span><span class="o">::</span><span class="n">sharedSpriteFrameCache</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">addSpriteFramesWithFile</span><span class="p">(</span><span class="s">&quot;resources.plist&quot;</span><span class="p">);</span> <span class="c1">//帧缓冲加入plist打包好的文件，用texture packer软件可以打包</span>
</span><span class='line'><span class="n">CCSprite</span> <span class="o">*</span> <span class="n">sprite</span> <span class="o">=</span> <span class="n">CCSprite</span><span class="o">::</span><span class="n">createWithSpriteFrameName</span><span class="p">(</span><span class="s">&quot;resources_00.png&quot;</span><span class="p">);</span> <span class="c1">//读取单帧到精灵</span>
</span><span class='line'><span class="n">batchNode</span><span class="o">-&gt;</span><span class="n">addChild</span><span class="p">(</span><span class="n">sprite</span><span class="p">);</span> <span class="c1">//加到批渲染对象</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>cocos2d-iphone </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">[[</span><span class="n">CCSpriteFrameCache</span> <span class="n">sharedSpriteFrameCache</span><span class="p">]</span> <span class="nl">addSpriteFramesWithFile:</span>
</span><span class='line'>     <span class="s">@&quot;res/resources.plist&quot;</span><span class="p">];</span> <span class="c1">//加载resource.plist文件到精灵帧缓冲区</span>
</span><span class='line'><span class="n">CCSpriteBatchNode</span> <span class="o">*</span><span class="n">spriteSheet</span> <span class="o">=</span> <span class="p">[</span><span class="n">CCSpriteBatchNode</span> <span class="nl">batchNodeWithFile:</span><span class="s">@&quot;resources.png&quot;</span><span class="p">];</span> <span class="c1">//从精灵批渲染节点返会一个精灵表</span>
</span><span class='line'><span class="p">[</span><span class="n">self</span> <span class="nl">addChild:</span><span class="n">spriteSheet</span> <span class="nl">z:</span><span class="mi">1</span><span class="p">];</span> <span class="c1">//把精灵表加载到self场景对象下，并设置Z轴顺序为1</span>
</span><span class='line'><span class="n">self</span><span class="p">.</span><span class="n">sprite</span> <span class="o">=</span> <span class="p">[</span><span class="n">CCSprite</span> <span class="nl">spriteWithSpriteFrameName:</span><span class="s">@&quot;resource_00.png&quot;</span><span class="p">];</span> <span class="c1">//再从缓冲加载单帧图片给精灵</span>
</span><span class='line'><span class="p">[</span><span class="n">spriteSheet</span> <span class="nl">addChild:</span><span class="n">sprite</span><span class="p">];</span> <span class="c1">//精灵表将该精灵呈现出来   </span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>cocos2d-html5 </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">spriteFrameCache</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">SpriteFrameCache</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">();</span>
</span><span class='line'><span class="nx">spriteFrameCache</span><span class="p">.</span><span class="nx">addSpriteFrames</span><span class="p">(</span><span class="s2">&quot;res/resources.plist&quot;</span><span class="p">,</span><span class="s2">&quot;res/resources.png&quot;</span><span class="p">);</span> <span class="c1">//从精灵批渲染节点返会一个精灵表</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">sprite</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Sprite</span><span class="p">.</span><span class="nx">createWithSpriteFrameName</span><span class="p">(</span><span class="s2">&quot;resource_00.png&quot;</span><span class="p">);</span> <span class="c1">//将单帧精灵图片添加到this场景对象</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">batchNode</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">SpriteBatchNode</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;res/resources.png&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">batchNode</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">);</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">batchNode</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[cocos2d-html5-2.2.2初探]]></title>
    <link href="http://evoupsight.com/blog/2014/01/23/cocos2d-html52-dot-2-2-first-exploration/"/>
    <updated>2014-01-23T13:14:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/01/23/cocos2d-html52-dot-2-2-first-exploration</id>
    <content type="html"><![CDATA[<p>准备用最新的cocos2d-html5 2.2.2的框架作为游戏开发引擎，整个引擎还是逻辑相当清晰好理解。</p>

<p>本文部分参考v2.1.1这篇分析文章
<a href="http://blog.csdn.net/honghaier/article/details/8642553">http://blog.csdn.net/honghaier/article/details/8642553</a></p>

<p>翻了几篇官网几篇文章，发现对应的教程没有同步起来，比如说这篇：
<a href="http://www.gamefromscratch.com/post/2012/06/08/Cocos2D-HTML-Tutorial-3All-about-sprites-and-positioning.aspx">http://www.gamefromscratch.com/post/2012/06/08/Cocos2D-HTML-Tutorial-3All-about-sprites-and-positioning.aspx</a></p>

<!-- more -->


<p>其间有这么一段代码</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">s</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">engineDir</span> <span class="o">+</span> <span class="s1">&#39;platform/jsloader.js&#39;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看到在cocos2d目录下没有这个文件，OMG! 淡定缓一缓神，让我们耐心点，这里教你一步一步来掌了解2.2.2版本的api来给原来的教程动手术,我们首先来讲解HelloWorld：</p>

<p>首先看2.2.2的helloworld的代码分布情况：</p>

<p><img src="http://evoupsight.com/images/evoup/cocos2d-html5_2.2.2_code_layout.png" alt="Alt text" /></p>

<p>其中项目必须的文件有cocos2d（cocos2d引擎）、extensions（GUI的扩展）、external（外部引擎如box2d）、lib（cocos2d基本库）。</p>

<p>接下来在根目录下仿照HelloHTML5World中的布局开始做一个项目，创建一个叫做helloworld的文件夹。</p>

<p>看一下运行截图
<img src="http://evoupsight.com/images/evoup/cocos2d-html52.2.2helloworld.png" alt="Alt text" /></p>

<hr />

<p>首先是在该文件夹下创建第一个文件index.html</p>

<figure class='code'><figcaption><span>index.html </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;title&gt;</span>hello cocos2d-html5<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;icon&quot;</span> <span class="na">type=</span><span class="s">&quot;iamge/GIF&quot;</span> <span class="na">href=</span><span class="s">&quot;res/favicon.ico&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;user-scalable=no&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;apple-mobile-web-app-capable&quot;</span> <span class="na">content=</span><span class="s">&quot;yes&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;full-screen&quot;</span> <span class="na">content=</span><span class="s">&quot;yes&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;screen-orientation&quot;</span> <span class="na">content=</span><span class="s">&quot;portrait&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;x5-fullscreen&quot;</span> <span class="na">content=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;360-fullscreen&quot;</span> <span class="na">content=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;style&gt;</span>
</span><span class='line'>        <span class="nt">body</span><span class="o">,</span> <span class="nt">canvas</span><span class="o">,</span> <span class="nt">div</span> <span class="p">{</span>
</span><span class='line'>            <span class="o">-</span><span class="n">moz</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>            <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>            <span class="o">-</span><span class="n">ms</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>            <span class="o">-</span><span class="n">khtml</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>            <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">tap</span><span class="o">-</span><span class="n">highlight</span><span class="o">-</span><span class="k">color</span><span class="o">:</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="nt">&lt;/style&gt;</span>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body</span> <span class="na">style=</span><span class="s">&quot;padding:0; margin: 0; background: #000;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;canvas</span> <span class="na">id=</span><span class="s">&quot;gameCanvas&quot;</span> <span class="na">width=</span><span class="s">&quot;800&quot;</span> <span class="na">height=</span><span class="s">&quot;450&quot;</span><span class="nt">&gt;&lt;/canvas&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;cocos2d.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>解释:</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;user-scalable=no&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>viewport这个是移动端的meta设置，content设置为user-scalable=no代表在移动设备上 不可缩放。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;apple-mobile-web-app-capable&quot;</span> <span class="na">content=</span><span class="s">&quot;yes&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>apple-mobile-web-app-capable这个是移动端的参数，全屏模式下content设置为yes，否则不用设置。可以通过window.navigator.standalone属性来得知是否网页是否处于全屏模式。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;full-screen&quot;</span> <span class="na">content=</span><span class="s">&quot;yes&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>这个是给某些浏览器的全屏设置，比如说ucweb</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;screen-orientation&quot;</span> <span class="na">content=</span><span class="s">&quot;portrait&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>screen-orientation这个meta参数代表移动端的屏幕朝向，有2个portrait和landscape，分别代表竖向和横向,这portrait是竖向了。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;x5-fullscreen&quot;</span> <span class="na">content=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>这个是腾讯qq浏览器的全屏</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;360-fullscreen&quot;</span> <span class="na">content=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>360浏览器的全屏</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;style&gt;</span>
</span><span class='line'>    <span class="nt">body</span><span class="o">,</span> <span class="nt">canvas</span><span class="o">,</span> <span class="nt">div</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">-</span><span class="n">moz</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>        <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>        <span class="o">-</span><span class="n">ms</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>        <span class="o">-</span><span class="n">khtml</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">select</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>        <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">tap</span><span class="o">-</span><span class="n">highlight</span><span class="o">-</span><span class="k">color</span><span class="o">:</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="nt">&lt;/style&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>其中-moz-user-select、-webkit-user-select、-ms-user-select和-khtml-user-select都取值none，代表文字都不选中。而-webkit-tap-highlight-color: rgba(0,0,0,0);其中rgba的最后一个参数0代表点击一个链接或者通过JavaScript定义可点击元素的时候禁止出现灰色背景。
最后从同域引入cocos2d.js。</p>

<hr />

<p>接着创建第二个文件cocos2d.js</p>

<figure class='code'><figcaption><span>cocos2d.js </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nb">document</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">COCOS2D_DEBUG</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="c1">//0 to turn debug off, 1 for basic debug, and 2 for full debug</span>
</span><span class='line'>        <span class="nx">box2d</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">chipmunk</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">showFPS</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">frameRate</span><span class="o">:</span><span class="mi">60</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">loadExtension</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">renderMode</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>       <span class="c1">//Choose of RenderMode: 0(default), 1(Canvas only), 2(WebGL only)</span>
</span><span class='line'>        <span class="nx">tag</span><span class="o">:</span><span class="s1">&#39;gameCanvas&#39;</span><span class="p">,</span> <span class="c1">//the dom element to run cocos2d on</span>
</span><span class='line'>        <span class="nx">engineDir</span><span class="o">:</span><span class="s1">&#39;../cocos2d/&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="c1">//SingleEngineFile:&#39;&#39;,</span>
</span><span class='line'>        <span class="nx">appFiles</span><span class="o">:</span><span class="p">[</span>
</span><span class='line'>            <span class="s1">&#39;src/resource.js&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="s1">&#39;src/myApp.js&#39;</span><span class="c1">//add your own files in order here</span>
</span><span class='line'>        <span class="p">]</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">).</span><span class="nx">getContext</span><span class="p">){</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">s</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&lt;h2&gt;Your browser does not support HTML5 canvas!&lt;/h2&gt;&#39;</span> <span class="o">+</span>
</span><span class='line'>            <span class="s1">&#39;&lt;p&gt;Google Chrome is a browser that combines a minimal design with sophisticated technology to make the web faster, safer, and easier.Click the logo to download.&lt;/p&gt;&#39;</span> <span class="o">+</span>
</span><span class='line'>            <span class="s1">&#39;&lt;a href=&quot;http://www.google.com/chrome&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;http://www.google.com/intl/zh-CN/chrome/assets/common/images/chrome_logo_2x.png&quot; border=&quot;0&quot;/&gt;&lt;/a&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">tag</span><span class="p">).</span><span class="nx">parentNode</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">p</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">p</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">border</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">p</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">tag</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">d</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">//first load engine file if specified</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="cm">/*********Delete this section if you have packed all files into one*******/</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">SingleEngineFile</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">engineDir</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">s</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">SingleEngineFile</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">engineDir</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">SingleEngineFile</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">s</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">engineDir</span> <span class="o">+</span> <span class="s1">&#39;jsloader.js&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;You must specify either the single engine file OR the engine directory in &quot;cocos2d.js&quot;&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="cm">/*********Delete this section if you have packed all files into one*******/</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">//s.src = &#39;Packed_Release_File.js&#39;; //IMPORTANT: Un-comment this line if you have packed all files into one</span>
</span><span class='line'>
</span><span class='line'>        <span class="nb">document</span><span class="p">.</span><span class="nx">ccConfig</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">s</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;cocos2d-html5&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">d</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">//else if single file specified, load singlefile</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">})();</span>
</span></code></pre></td></tr></table></div></figure>


<h4>解释:</h4>

<p>这整个就是一个匿名函数,然后调用的写法。</p>

<p>首先创建一个局部变量d，赋值为document</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nb">document</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后创建一个c对象，提供全部配置信息</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">COCOS2D_DEBUG</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="c1">//0 to turn debug off, 1 for basic debug, and 2 for full debug</span>
</span><span class='line'>    <span class="nx">box2d</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">chipmunk</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">showFPS</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">frameRate</span><span class="o">:</span><span class="mi">60</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">loadExtension</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">renderMode</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>       <span class="c1">//Choose of RenderMode: 0(default), 1(Canvas only), 2(WebGL only)</span>
</span><span class='line'>    <span class="nx">tag</span><span class="o">:</span><span class="s1">&#39;gameCanvas&#39;</span><span class="p">,</span> <span class="c1">//the dom element to run cocos2d on</span>
</span><span class='line'>    <span class="nx">engineDir</span><span class="o">:</span><span class="s1">&#39;../cocos2d/&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c1">//SingleEngineFile:&#39;&#39;,</span>
</span><span class='line'>    <span class="nx">appFiles</span><span class="o">:</span><span class="p">[</span>
</span><span class='line'>        <span class="s1">&#39;src/resource.js&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;src/myApp.js&#39;</span><span class="c1">//add your own files in order here</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>其中:
COCOS2D_DEBUG为调试等级（0关闭，1基本，2完全）；
box2d为是否采用box2d物理引擎，这里不使用设置为no；
chipmunk为一款物理引擎，同样不使用；
showFPS是否显示FPS，是；
loadExtension是否加载扩展，否；
renderMode渲染，0为默认，1为仅Canvas方式，2为仅WebGL方式;
tag为运行cocos2d的dom元素;
engineDir为cocos2d的引擎目录;
appFiles为一个列表，目前存2个文件的地址，src/resource.js和src/myApp.js;</p>

<p>下面这段为html5探测代码，如果探测失败，会出出现一个google的chrome浏览器的logo</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">).</span><span class="nx">getContext</span><span class="p">){</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">s</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&lt;h2&gt;Your browser does not support HTML5 canvas!&lt;/h2&gt;&#39;</span> <span class="o">+</span>
</span><span class='line'>        <span class="s1">&#39;&lt;p&gt;Google Chrome is a browser that combines a minimal design with sophisticated technology to make the web faster, safer, and easier.Click the logo to download.&lt;/p&gt;&#39;</span> <span class="o">+</span>
</span><span class='line'>        <span class="s1">&#39;&lt;a href=&quot;http://www.google.com/chrome&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;http://www.google.com/intl/zh-CN/chrome/assets/common/images/chrome_logo_2x.png&quot; border=&quot;0&quot;/&gt;&lt;/a&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">tag</span><span class="p">).</span><span class="nx">parentNode</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">p</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">p</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">border</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">p</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">tag</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">d</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>再看下一段</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//first load engine file if specified</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="cm">/*********Delete this section if you have packed all files into one*******/</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">SingleEngineFile</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">engineDir</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">s</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">SingleEngineFile</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">engineDir</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">SingleEngineFile</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">s</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">engineDir</span> <span class="o">+</span> <span class="s1">&#39;jsloader.js&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;You must specify either the single engine file OR the engine directory in &quot;cocos2d.js&quot;&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="cm">/*********Delete this section if you have packed all files into one*******/</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//s.src = &#39;Packed_Release_File.js&#39;; //IMPORTANT: Un-comment this line if you have packed all files into one</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">document</span><span class="p">.</span><span class="nx">ccConfig</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">s</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;cocos2d-html5&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">d</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//else if single file specified, load singlefile</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>这段创建了DOMContentLoaded事件侦听器，干掉全部DOM对象。SingleEngineFile这个参数是如果要把cocos2d这个文件夹下的引擎程序打包成一个文件，则需要指定这个文件的路径。指定好了引擎路径engineDir为../cocos2d这个文件夹，然后加载jsloader.js(这个文件的作用是加载cocos2d需要用到的所有js文件，包括cocos2d.js,main.js,myApp.js),然后把配置文件存到document.ccConfig元素中去。
接着把cocos2d-html5这个id赋到创建到script标签上，然后加载到body标签中。</p>

<hr />

<p>接着创建第三个文件&mdash;主程序文件main.js,注意这还不是实现逻辑，而是cocos2d-html5初始化的套路。</p>

<figure class='code'><figcaption><span>main.js </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">cocos2dApp</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">config</span><span class="o">:</span><span class="nb">document</span><span class="p">[</span><span class="s1">&#39;ccConfig&#39;</span><span class="p">],</span>
</span><span class='line'>    <span class="nx">ctor</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">scene</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">startScene</span> <span class="o">=</span> <span class="nx">scene</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">cc</span><span class="p">.</span><span class="nx">COCOS2D_DEBUG</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">[</span><span class="s1">&#39;COCOS2D_DEBUG&#39;</span><span class="p">];</span>
</span><span class='line'>        <span class="nx">cc</span><span class="p">.</span><span class="nx">initDebugSetting</span><span class="p">();</span>
</span><span class='line'>        <span class="nx">cc</span><span class="p">.</span><span class="nx">setup</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]);</span>
</span><span class='line'>        <span class="nx">cc</span><span class="p">.</span><span class="nx">AppController</span><span class="p">.</span><span class="nx">shareAppController</span><span class="p">().</span><span class="nx">didFinishLaunchingWithOptions</span><span class="p">();</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">applicationDidFinishLaunching</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">RenderDoesnotSupport</span><span class="p">()){</span>
</span><span class='line'>            <span class="c1">//show Information to user</span>
</span><span class='line'>            <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Browser doesn&#39;t support WebGL&quot;</span><span class="p">);</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="c1">// initialize director</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">director</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Director</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">cc</span><span class="p">.</span><span class="nx">EGLView</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">resizeWithBrowserSize</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">cc</span><span class="p">.</span><span class="nx">EGLView</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">setDesignResolutionSize</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">RESOLUTION_POLICY</span><span class="p">.</span><span class="nx">SHOW_ALL</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// turn on display FPS</span>
</span><span class='line'>        <span class="nx">director</span><span class="p">.</span><span class="nx">setDisplayStats</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">[</span><span class="s1">&#39;showFPS&#39;</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// set FPS. the default value is 1.0/60 if you don&#39;t call this</span>
</span><span class='line'>        <span class="nx">director</span><span class="p">.</span><span class="nx">setAnimationInterval</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">[</span><span class="s1">&#39;frameRate&#39;</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//load resources</span>
</span><span class='line'>        <span class="nx">cc</span><span class="p">.</span><span class="nx">LoaderScene</span><span class="p">.</span><span class="nx">preload</span><span class="p">(</span><span class="nx">g_resources</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">director</span><span class="p">.</span><span class="nx">replaceScene</span><span class="p">(</span><span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">startScene</span><span class="p">());</span>
</span><span class='line'>        <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myApp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cocos2dApp</span><span class="p">(</span><span class="nx">HelloWorldScene</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>主要的功能都在cc.Application.extend中实现。首先config配置参数为document[&lsquo;ccConfig&rsquo;]
然后看ctor：（顾名思义：config to run 配置转为启动）以scene为参数的匿名函数，先调用_super()方法这个引擎方法进行初始化，然后指定startScene开始场景为scene。调试等级cc.COCOS2D_DEBUG为cocos2d.js中指定的调试等级，cc.initDebugSetting为初始化调试设置，cc.setup(this.config[&lsquo;tag&rsquo;])在名为tag的dom对象上创建cavas,cc.AppController.shareAppController().didFinishLaunchingWithOptions();这个是仿照cocos2d-iphone的函数命名的启动函数（顾名思义：就是启动结束会加载的函数）。</p>

<p>在正式进入写代码之前，稍等再看一下applicationDidFinishLaunching这个函数</p>

<p>先检查渲染是否支持，不支持就弹出“Browser doesn`t support WebGL”</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="k">if</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">RenderDoesnotSupport</span><span class="p">()){</span>
</span><span class='line'>    <span class="c1">//show Information to user</span>
</span><span class='line'>    <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Browser doesn&#39;t support WebGL&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>初始化director</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// initialize director</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">director</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Director</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>重置浏览器大小</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">cc</span><span class="p">.</span><span class="nx">EGLView</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">resizeWithBrowserSize</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'><span class="nx">cc</span><span class="p">.</span><span class="nx">EGLView</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">setDesignResolutionSize</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">RESOLUTION_POLICY</span><span class="p">.</span><span class="nx">SHOW_ALL</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>打开显卡FPS</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// turn on display FPS</span>
</span><span class='line'><span class="nx">director</span><span class="p">.</span><span class="nx">setDisplayStats</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">[</span><span class="s1">&#39;showFPS&#39;</span><span class="p">]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>默认设置fps为1秒60帧</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// set FPS. the default value is 1.0/60 if you don&#39;t call this</span>
</span><span class='line'><span class="nx">director</span><span class="p">.</span><span class="nx">setAnimationInterval</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">[</span><span class="s1">&#39;frameRate&#39;</span><span class="p">]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>导演类的replaceScene方法来替换场景为startScene</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//load resources</span>
</span><span class='line'><span class="nx">cc</span><span class="p">.</span><span class="nx">LoaderScene</span><span class="p">.</span><span class="nx">preload</span><span class="p">(</span><span class="nx">g_resources</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">director</span><span class="p">.</span><span class="nx">replaceScene</span><span class="p">(</span><span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">startScene</span><span class="p">());</span>
</span><span class='line'><span class="p">},</span> <span class="k">this</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>最后实例化app</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myApp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cocos2dApp</span><span class="p">(</span><span class="nx">HelloWorldScene</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<p>在正式步入工程文件之前，别急，创建一个src文件夹，然后在该文件夹下创建一个resource.js</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">s_HelloWorld</span> <span class="o">=</span> <span class="s2">&quot;res/HelloWorld.png&quot;</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">s_CloseNormal</span> <span class="o">=</span> <span class="s2">&quot;res/CloseNormal.png&quot;</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">s_CloseSelected</span> <span class="o">=</span> <span class="s2">&quot;res/CloseSelected.png&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">g_resources</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>    <span class="c1">//image</span>
</span><span class='line'>    <span class="p">{</span><span class="nx">src</span><span class="o">:</span><span class="nx">s_HelloWorld</span><span class="p">},</span>
</span><span class='line'>    <span class="p">{</span><span class="nx">src</span><span class="o">:</span><span class="nx">s_CloseNormal</span><span class="p">},</span>
</span><span class='line'>    <span class="p">{</span><span class="nx">src</span><span class="o">:</span><span class="nx">s_CloseSelected</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//plist</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//fnt</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//tmx</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//bgm</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//effect</span>
</span><span class='line'><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后在和src相同父目录下创建一个叫做res文件夹，把如下3个文件放入其中：</p>

<p>HelloWorld.png</p>

<p><img src="http://evoupsight.com/images/evoup/cocos2d-html5-res/HelloWorld.png" alt="Alt text" /></p>

<p>CloseNormal.png</p>

<p><img src="http://evoupsight.com/images/evoup/cocos2d-html5-res/CloseNormal.png" alt="Alt text" /></p>

<p>CloseSelected.png</p>

<p><img src="http://evoupsight.com/images/evoup/cocos2d-html5-res/CloseSelected.png" alt="Alt text" /></p>

<p>这就完成了资源文件的定义和提供。</p>

<hr />

<p>终于到工程主文件了，在src下创建一个叫做myApp.js的文件</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">Helloworld</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Layer</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">isMouseDown</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">helloImg</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">helloLabel</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">circle</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">sprite</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">init</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//////////////////////////////</span>
</span><span class='line'>        <span class="c1">// 1. super init first</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">/////////////////////////////</span>
</span><span class='line'>        <span class="c1">// 2. add a menu item with &quot;X&quot; image, which is clicked to quit the program</span>
</span><span class='line'>        <span class="c1">//    you may modify it.</span>
</span><span class='line'>        <span class="c1">// ask director the window size</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Director</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">getWinSize</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// add a &quot;close&quot; icon to exit the progress. it&#39;s an autorelease object</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">closeItem</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">MenuItemImage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
</span><span class='line'>            <span class="s2">&quot;res/CloseNormal.png&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;res/CloseSelected.png&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">history</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>            <span class="p">},</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">closeItem</span><span class="p">.</span><span class="nx">setAnchorPoint</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">menu</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Menu</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">closeItem</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">menu</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">menu</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">closeItem</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="nx">size</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">/////////////////////////////</span>
</span><span class='line'>        <span class="c1">// 3. add your codes below...</span>
</span><span class='line'>        <span class="c1">// add a label shows &quot;Hello World&quot;</span>
</span><span class='line'>        <span class="c1">// create and initialize a label</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">helloLabel</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">LabelTTF</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">,</span> <span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">// position the label on the center of the screen</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">helloLabel</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="nx">size</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">// add the label as a child to this layer</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">helloLabel</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">lazyLayer</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Layer</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">lazyLayer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// add &quot;HelloWorld&quot; splash screen&quot;</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Sprite</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;res/HelloWorld.png&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="nx">size</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">size</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">setScale</span><span class="p">(</span><span class="mf">0.5</span><span class="p">);</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">setRotation</span><span class="p">(</span><span class="mi">180</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">lazyLayer</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">rotateToA</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">RotateTo</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">scaleToA</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">ScaleTo</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">runAction</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">Sequence</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">rotateToA</span><span class="p">,</span> <span class="nx">scaleToA</span><span class="p">));</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">helloLabel</span><span class="p">.</span><span class="nx">runAction</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">Spawn</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">MoveBy</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">p</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">size</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">40</span><span class="p">)),</span><span class="nx">cc</span><span class="p">.</span><span class="nx">TintTo</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">0</span><span class="p">)));</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">setTouchEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="c1">// a selector callback</span>
</span><span class='line'>    <span class="nx">menuCloseCallback</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">sender</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">cc</span><span class="p">.</span><span class="nx">Director</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">end</span><span class="p">();</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">onTouchesBegan</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">touches</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">isMouseDown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">onTouchesMoved</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">touches</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isMouseDown</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nx">touches</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1">//this.circle.setPosition(touches[0].getLocation().x, touches[0].getLocation().y);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">onTouchesEnded</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">touches</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">isMouseDown</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">onTouchesCancelled</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">touches</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;onTouchesCancelled&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">HelloWorldScene</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Scene</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">onEnter</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">layer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Helloworld</span><span class="p">();</span>
</span><span class='line'>        <span class="nx">layer</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">layer</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h4>分析</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">isMouseDown</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
</span><span class='line'><span class="nx">helloImg</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
</span><span class='line'><span class="nx">helloLabel</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
</span><span class='line'><span class="nx">circle</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
</span><span class='line'><span class="nx">sprite</span><span class="o">:</span><span class="kc">null</span><span class="p">,</span>
</span></code></pre></td></tr></table></div></figure>


<p>这是对接下来用到的成员变量的定义</p>

<p>再看接下来的代码</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">init</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//首先初始化超类</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//获取屏宽</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Director</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">getWinSize</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//添加一个关闭按钮到菜单项</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">closeItem</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">MenuItemImage</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
</span><span class='line'>        <span class="s2">&quot;res/CloseNormal.png&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;res/CloseSelected.png&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">history</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>        <span class="p">},</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//设置锚点，默认就是0.5，0.5</span>
</span><span class='line'>    <span class="nx">closeItem</span><span class="p">.</span><span class="nx">setAnchorPoint</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//创建关闭按钮</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">menu</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Menu</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">closeItem</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//设置菜单项位置</span>
</span><span class='line'>    <span class="nx">menu</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//添加菜单项到当前层上</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">menu</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//设置菜单的位置为屏幕右下角</span>
</span><span class='line'>    <span class="nx">closeItem</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="nx">size</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//创建一个叫做helloworld的文本标签</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">helloLabel</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">LabelTTF</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">,</span> <span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//把文本标签放到屏幕中央位置</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">helloLabel</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="nx">size</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//添加该文本标签放到当前层上</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">helloLabel</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//创建一个新层lazylay并放入当前层</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">lazyLayer</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Layer</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">lazyLayer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// 添加一个能旋转的helloworld精灵</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Sprite</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s2">&quot;res/HelloWorld.png&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="nx">size</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">size</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//先缩小50%且倒过来</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">setScale</span><span class="p">(</span><span class="mf">0.5</span><span class="p">);</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">setRotation</span><span class="p">(</span><span class="mi">180</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//添加到lazyLayer层</span>
</span><span class='line'>    <span class="nx">lazyLayer</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//定义2个动作分别为旋转2秒到0度和缩放2秒无x轴y轴缩放</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">rotateToA</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">RotateTo</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">scaleToA</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">ScaleTo</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//让helloworld精灵依次运行这2个动作</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">sprite</span><span class="p">.</span><span class="nx">runAction</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">Sequence</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">rotateToA</span><span class="p">,</span> <span class="nx">scaleToA</span><span class="p">));</span>
</span><span class='line'>    <span class="c1">//使文本标签同时运行ccMoveBy动作（后面讲）和CCTintTo动作（使文字）</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">helloLabel</span><span class="p">.</span><span class="nx">runAction</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">Spawn</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">MoveBy</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">p</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">size</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">40</span><span class="p">)),</span><span class="nx">cc</span><span class="p">.</span><span class="nx">TintTo</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">0</span><span class="p">)));</span>
</span><span class='line'>    <span class="c1">//设置为支持触碰</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">setTouchEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p>需要注意的是
1) cc.Sequence代表依次运行动作，而cc.Spawn代表同时运行动作
2) CCMoveTo是“移动到这里”；而CCMoveBy则是“相对于之前点再移动”，比如说说这里需要两个坐标pos1（x1，y1），pos2（x2，y2），用CCMoveTo的话，就是将对象由pos1移动到pos2，而CCMOveBy则是对象的终坐标是在pos1的基础上再加上（矢量相加）pos2，终坐标pos3=pos1+pos2。</p>

<p>接下来是一些触碰事件的回调函数</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//点击关闭按钮的回调函数，退出实例</span>
</span><span class='line'><span class="nx">menuCloseCallback</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">sender</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">cc</span><span class="p">.</span><span class="nx">Director</span><span class="p">.</span><span class="nx">getInstance</span><span class="p">().</span><span class="nx">end</span><span class="p">();</span>
</span><span class='line'><span class="p">},</span>
</span><span class='line'><span class="c1">//按下按钮的状态</span>
</span><span class='line'><span class="nx">onTouchesBegan</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">touches</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">isMouseDown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="p">},</span>
</span><span class='line'><span class="c1">//按下按钮移动时</span>
</span><span class='line'><span class="nx">onTouchesMoved</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">touches</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isMouseDown</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">touches</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">//this.circle.setPosition(touches[0].getLocation().x, touches[0].getLocation().y);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">},</span>
</span><span class='line'><span class="c1">//放开按钮的状态</span>
</span><span class='line'><span class="nx">onTouchesEnded</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">touches</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">isMouseDown</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'><span class="p">},</span>
</span><span class='line'><span class="c1">//离开按钮的状态</span>
</span><span class='line'><span class="nx">onTouchesCancelled</span><span class="o">:</span><span class="kd">function</span> <span class="p">(</span><span class="nx">touches</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;onTouchesCancelled&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>最后</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">HelloWorldScene</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">Scene</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">onEnter</span><span class="o">:</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">layer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Helloworld</span><span class="p">();</span>
</span><span class='line'>        <span class="nx">layer</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="nx">layer</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>进入了之后就把这个layer再加载到场景上，初步分析终了，等完成一个项目之后再来接着写点东西。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Win7上Android模拟器上安装apk软件]]></title>
    <link href="http://evoupsight.com/blog/2014/01/20/win7-install-apk-on-android-emulator/"/>
    <updated>2014-01-20T14:56:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/01/20/win7-install-apk-on-android-emulator</id>
    <content type="html"><![CDATA[<h3>前提</h3>

<p>在android模拟器上安装apk文件（android安装包）很简单,要求2个前提：</p>

<pre><code>    1）已经安装好了ADK（android sdk）

    2）配置好virtual device
</code></pre>

<!-- more -->


<h3>准备工作</h3>

<p>假设您已经安装好了ADK，运行Eclipse选择Window菜单：</p>

<p><img src="http://evoupsight.com/images/evoup/android_emulator_install_apk_first.png" alt="Alt text" /></p>

<p>选择下方的Android Virtual Device Manager->new,我们创建一个android2.2的通用虚拟设备，屏幕选最小的我这里方便截图（一般会选择3.7WVGA,后期根据自己的需要可以做任意选择），然后取名这个模拟器为testAVD。</p>

<p><img src="http://evoupsight.com/images/evoup/android_emulator_create_new_one.png" alt="Alt text" /></p>

<p>点击OK完成，然后选择testAVD并Start启动模拟器，然后选择launch。第一次启动很慢，至于到底需要多少时间取决于机器的性能。</p>

<p><img src="http://evoupsight.com/images/evoup/android_emulator_starting.png" alt="Alt text" /></p>

<p>这样就算进去了</p>

<p><img src="http://evoupsight.com/images/evoup/android_emulator_entered.png" alt="Alt text" /></p>

<h3>安装apk</h3>

<p>进入ADK的platform_tools目录下，运行<code>adb install apk文件</code>就可以完成安装。</p>

<p>以安装微信安卓版本为例，假设我下载到了C:\weixin510android360.apk</p>

<p><img src="http://evoupsight.com/images/evoup/android_emulator_entered.png" alt="Alt text" /></p>

<p>我这里比较慢，可能是因为选择的模拟器内存参数没有调大导致的。</p>

<p><img src="http://evoupsight.com/images/evoup/android_emulator_install_apk.png" alt="Alt text" /></p>

<p>等待安装完成吧</p>

<p><img src="http://evoupsight.com/images/evoup/android_emulator_install_apk_done.png" alt="Alt text" /></p>

<p><img src="http://evoupsight.com/images/evoup/android_emulator_install_apk_done2.png" alt="Alt text" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[android webview helloworld分析]]></title>
    <link href="http://evoupsight.com/blog/2014/01/19/android-webview-helloworld/"/>
    <updated>2014-01-19T17:05:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/01/19/android-webview-helloworld</id>
    <content type="html"><![CDATA[<h3>加载示例代码</h3>

<p>官方示例代码
<a href="https://code.google.com/p/apps-for-android/source/browse/#git%2FSamples%2FWebViewDemo">https://code.google.com/p/apps-for-android/source/browse/#git%2FSamples%2FWebViewDemo</a></p>

<p>运行Eclipse(本文提到的eclipse版本是Eclipse ide for java developer KEPLER)，选择File->Import&hellip;&ndash;>Android->Existing Android Code Into Workspace,Next，在Root Directory中选择解压的目录下的Samples文件夹下的WebViewDemo。</p>

<p>如果直接run，会出现错误<code>Project has no project.properties file! Edit the project properties to set one.</code>。
这时只要右键项目属性properties &ndash;> android &ndash;> Project Build Target 把里面的Androidx.x改为对应的google APIs版本。google APIs是android apis的超集，Android只是其中一个用于移动设备的OS，可以有限的调用一些google api。</p>

<h3>分析app部分代码</h3>

<p>请看示例java代码</p>

<!-- more -->




<figure class='code'><figcaption><span>WebViewDemo.java </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">webviewdemo</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.os.Handler</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.webkit.JsResult</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.webkit.WebChromeClient</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.webkit.WebSettings</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.webkit.WebView</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Demonstrates how to embed a WebView in your activity. Also demonstrates how</span>
</span><span class='line'><span class="cm"> * to have javascript in the WebView call into the activity, and how the activity </span>
</span><span class='line'><span class="cm"> * can invoke javascript.</span>
</span><span class='line'><span class="cm"> * &lt;p&gt;</span>
</span><span class='line'><span class="cm"> * In this example, clicking on the android in the WebView will result in a call into</span>
</span><span class='line'><span class="cm"> * the activities code in {@link DemoJavaScriptInterface#clickOnAndroid()}. This code</span>
</span><span class='line'><span class="cm"> * will turn around and invoke javascript using the {@link WebView#loadUrl(String)}</span>
</span><span class='line'><span class="cm"> * method.</span>
</span><span class='line'><span class="cm"> * &lt;p&gt;</span>
</span><span class='line'><span class="cm"> * Obviously all of this could have been accomplished without calling into the activity</span>
</span><span class='line'><span class="cm"> * and then back into javascript, but this code is intended to show how to set up the </span>
</span><span class='line'><span class="cm"> * code paths for this sort of communication.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebViewDemo</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">LOG_TAG</span> <span class="o">=</span> <span class="s">&quot;WebViewDemo&quot;</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">WebView</span> <span class="n">mWebView</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Handler</span> <span class="n">mHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">icicle</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">icicle</span><span class="o">);</span>
</span><span class='line'>        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">main</span><span class="o">);</span>
</span><span class='line'>        <span class="n">mWebView</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">webview</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">WebSettings</span> <span class="n">webSettings</span> <span class="o">=</span> <span class="n">mWebView</span><span class="o">.</span><span class="na">getSettings</span><span class="o">();</span>
</span><span class='line'>        <span class="n">webSettings</span><span class="o">.</span><span class="na">setSavePassword</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>        <span class="n">webSettings</span><span class="o">.</span><span class="na">setSaveFormData</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>        <span class="n">webSettings</span><span class="o">.</span><span class="na">setJavaScriptEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>        <span class="n">webSettings</span><span class="o">.</span><span class="na">setSupportZoom</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">mWebView</span><span class="o">.</span><span class="na">setWebChromeClient</span><span class="o">(</span><span class="k">new</span> <span class="n">MyWebChromeClient</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">mWebView</span><span class="o">.</span><span class="na">addJavascriptInterface</span><span class="o">(</span><span class="k">new</span> <span class="n">DemoJavaScriptInterface</span><span class="o">(),</span> <span class="s">&quot;demo&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">mWebView</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="s">&quot;file:///android_asset/demo.html&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">final</span> <span class="kd">class</span> <span class="nc">DemoJavaScriptInterface</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">DemoJavaScriptInterface</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/**</span>
</span><span class='line'><span class="cm">         * This is not called on the UI thread. Post a runnable to invoke</span>
</span><span class='line'><span class="cm">         * loadUrl on the UI thread.</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clickOnAndroid</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">mHandler</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">mWebView</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="s">&quot;javascript:wave()&quot;</span><span class="o">);</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">});</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Provides a hook for calling &quot;alert&quot; from javascript. Useful for</span>
</span><span class='line'><span class="cm">     * debugging your javascript.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">final</span> <span class="kd">class</span> <span class="nc">MyWebChromeClient</span> <span class="kd">extends</span> <span class="n">WebChromeClient</span> <span class="o">{</span>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onJsAlert</span><span class="o">(</span><span class="n">WebView</span> <span class="n">view</span><span class="o">,</span> <span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">,</span> <span class="n">JsResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">LOG_TAG</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>            <span class="n">result</span><span class="o">.</span><span class="na">confirm</span><span class="o">();</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>首先需要搞懂Activity这个核心概念，基本上是进行android的活动对象事件调度的类，我们看一下android api中的activity的生命周期：</p>

<p><img src="http://evoupsight.com/images/evoup/activity_lifecycle.png" alt="Alt text" /></p>

<p>它有以下7个方法可以被重写：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Activity</span> <span class="kd">extends</span> <span class="n">ApplicationContext</span> <span class="o">{</span>
</span><span class='line'>       <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>       <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onStart</span><span class="o">();</span>
</span><span class='line'>       <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onRestart</span><span class="o">();</span>
</span><span class='line'>       <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onResume</span><span class="o">();</span>
</span><span class='line'>       <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onPause</span><span class="o">();</span>
</span><span class='line'>       <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onStop</span><span class="o">();</span>
</span><span class='line'>       <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">();</span>
</span><span class='line'>   <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>也就是onCreate创建，onStart开始、onRestart重启、onResume恢复、onPause暂停、onStop停止和onDestory销毁时，这些方法都能够被重写，不难看出这些方法和Activity生命周期是息息相关的。
本例子就只要重写onCreate即可，看代码：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">icicle</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">icicle</span><span class="o">);</span>
</span><span class='line'>    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">main</span><span class="o">);</span>
</span><span class='line'>    <span class="n">mWebView</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">webview</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">WebSettings</span> <span class="n">webSettings</span> <span class="o">=</span> <span class="n">mWebView</span><span class="o">.</span><span class="na">getSettings</span><span class="o">();</span>
</span><span class='line'>    <span class="n">webSettings</span><span class="o">.</span><span class="na">setSavePassword</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>  
</span><span class='line'>    <span class="n">webSettings</span><span class="o">.</span><span class="na">setSaveFormData</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>    <span class="n">webSettings</span><span class="o">.</span><span class="na">setJavaScriptEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>    <span class="n">webSettings</span><span class="o">.</span><span class="na">setSupportZoom</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">mWebView</span><span class="o">.</span><span class="na">setWebChromeClient</span><span class="o">(</span><span class="k">new</span> <span class="n">MyWebChromeClient</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">mWebView</span><span class="o">.</span><span class="na">addJavascriptInterface</span><span class="o">(</span><span class="k">new</span> <span class="n">DemoJavaScriptInterface</span><span class="o">(),</span> <span class="s">&quot;demo&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">mWebView</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="s">&quot;file:///android_asset/demo.html&quot;</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>其中R.java这个为android的资源类，工程自动会维护这里暂时不用去考虑。首先是调用超类的onCreate方法来必要的初始化。然后设置试图为资源类的main。再来从资源类的webview中找到Id返回WebView类型的对象mWebView这个变量中。然后是WebSettings类对象webSettings的参数设置，这里setSavePassword和setSaveFormData代表不要保存表单控件的数据和密码，setJavaScriptEnabled设置为允许webview调用JavaScript，setSupportZoom设置为不允许缩放。由于要用到JavaScript，所以需要调用setWebChromeClient。</p>

<p>我们需要仔细看下addJavascriptInterface这个函数的说明</p>

<blockquote><p>Injects the supplied Java object into this WebView. The object is injected into the JavaScript context of the main frame, using the supplied name. This allows the Java object&rsquo;s methods to be accessed from JavaScript. For applications targeted to API level JELLY_BEAN_MR1 and above, only public methods that are annotated with JavascriptInterface can be accessed from JavaScript. For applications targeted to API level JELLY_BEAN or below, all public methods (including the inherited ones) can be accessed, see the important security note below for implications.</p></blockquote>

<p>我给翻译了下：它注入提供的Java对象到这个WebView。对象使用提供的名字注入JavaScript上下文的主要框架。这允许从JavaScript访问Java对象的方法。针对应用程序API级别在JELLY_BEAN_MR1以上的,只有JavascriptInterface的公共方法与注释可以从JavaScript访问。针对应用程序API级别或低于JELLY_BEAN的,所有公共方法(包括继承的)可以访问,参见下面重要的安全注意影响。</p>

<p>再看下2个参数，前一个为注入webview的Java对象（DemoJavaScriptInterface），后一个为暴露给JavaScript的对象名字（demo），本例中除了webview把点击消息传递给html，html中的JavaScript也要和webview交互，在哪里交互？伟大的google为我们想到JavaScript的顶层window对象，在下面动态创建了一个子对象，这里就是第二个参数demo，这个等等到了html再讲。</p>

<p>马上来看第一个参数的实现</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">final</span> <span class="kd">class</span> <span class="nc">DemoJavaScriptInterface</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">DemoJavaScriptInterface</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * This is not called on the UI thread. Post a runnable to invoke</span>
</span><span class='line'><span class="cm">     * loadUrl on the UI thread.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clickOnAndroid</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">mHandler</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">mWebView</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="s">&quot;javascript:wave()&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>直接一个构造函数什么都不做，然后直接用句柄提交实现了Runnable类的引用，再深入Runnable探究下</p>

<blockquote><p>The Runnable interface should be implemented by any class whose instances are intended to be executed by a thread. The class must define a method of no arguments called run.</p></blockquote>

<p>Runnable就一个方法，run给实现了就行，这里是直接调用demo.html页面里的JavaScript的wave方法。</p>

<p>看下一段代码</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Provides a hook for calling &quot;alert&quot; from javascript. Useful for</span>
</span><span class='line'><span class="cm"> * debugging your javascript.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">final</span> <span class="kd">class</span> <span class="nc">MyWebChromeClient</span> <span class="kd">extends</span> <span class="n">WebChromeClient</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onJsAlert</span><span class="o">(</span><span class="n">WebView</span> <span class="n">view</span><span class="o">,</span> <span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">,</span> <span class="n">JsResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">LOG_TAG</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>        <span class="n">result</span><span class="o">.</span><span class="na">confirm</span><span class="o">();</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里是对刚才指定的WebChromeClient对象MyWebChromeClient，进行onJsAlert的重写，可以看到其实就是在打印日志。</p>

<hr />

<h3>分析html部分代码</h3>

<p>app代码完了，再来看html</p>

<figure class='code'><figcaption><span>demo.html </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">language=</span><span class="s">&quot;javascript&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="cm">/* This function is invoked by the activity */</span>
</span><span class='line'>      <span class="kd">function</span> <span class="nx">wave</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;droid&quot;</span><span class="p">).</span><span class="nx">src</span><span class="o">=</span><span class="s2">&quot;android_waving.png&quot;</span><span class="p">;</span>
</span><span class='line'>          <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'>      <span class="c">&lt;!-- Calls into the javascript interface for the activity --&gt;</span>
</span><span class='line'>      <span class="nt">&lt;a</span> <span class="na">onClick=</span><span class="s">&quot;window.demo.clickOnAndroid()&quot;</span><span class="nt">&gt;&lt;div</span> <span class="na">style=</span><span class="s">&quot;width:80px;</span>
</span><span class='line'><span class="s">          margin:0px auto;</span>
</span><span class='line'><span class="s">          padding:10px;</span>
</span><span class='line'><span class="s">          text-align:center;</span>
</span><span class='line'><span class="s">          border:2px solid #202020;&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>              <span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">&quot;droid&quot;</span> <span class="na">src=</span><span class="s">&quot;android_normal.png&quot;</span><span class="nt">/&gt;&lt;br&gt;</span>
</span><span class='line'>              Click me!
</span><span class='line'>      <span class="nt">&lt;/div&gt;&lt;/a&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>注意看window.demo.clickOnAndroid这个JavaScript方法，刚刚我们在app代码里用addJavascriptInterface方法生成好了一个window.demo对象，就是通过这个对象，就可以调用app内置方法来实现网页的跳转。</p>

<h4>小结</h4>

<p>到此程序分析完毕,整个交互过程还是比较容易理解，就是先继承一个Activity类，关联好html页面，实现onCreate方法，在其中指定好app方法以及为javascript暴露对象名，然后进入html调用暴露的对象名及其方法进行跳转。</p>

<hr />

<p>最后，打开应用程序，它看起来应该像这样:)</p>

<p><img src="http://evoupsight.com/images/evoup/android_webview_sample.png" alt="Alt text" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Win7 Android开发环境搭建之一(SDK+ADT)]]></title>
    <link href="http://evoupsight.com/blog/2014/01/17/android-adt-development-deloy/"/>
    <updated>2014-01-17T17:48:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/01/17/android-adt-development-deloy</id>
    <content type="html"><![CDATA[<p>最近有个HTML5的项目需要部署在android里，先研究下基本功，安装时还是遇到一些问题，如有的文章过时了，自己连搜索测试带整理写了一片文章备查。</p>

<!-- more -->


<h3>一、安装JDK</h3>

<p>安装JDK，我这里的windows7平台，先下载jdk7，然后安装，我的安装路径为C:\Program Files\Java\jdk1.7.0_25\。
安装完成后设置环境变量
开始->搜索程序和文件输入环境变量->编辑系统环境变量->添加以下环境变量：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>JAVA_HOME值为：C:<span class="se">\P</span>rogram Files<span class="se">\J</span>ava<span class="se">\j</span>dk1.7.0_25<span class="se">\</span>
</span><span class='line'>CLASSPATH值为：.;%JAVA_HOME%<span class="se">\l</span>ib<span class="se">\t</span>ools.jar;%JAVA_HOME%<span class="se">\l</span>ib<span class="se">\d</span>t.jar;%JAVA_HOME%<span class="se">\b</span>in;
</span><span class='line'>PATH值为：追加%JAVA_HOME%<span class="se">\b</span>in;
</span></code></pre></td></tr></table></div></figure>


<h3>二、安装Eclipse</h3>

<p>可以直接去www.eclipse.org下载，64位Windows平台下的下载地址：</p>

<p><a href="http://mirror.bit.edu.cn/eclipse/technology/epp/downloads/release/kepler/SR1/eclipse-cpp-kepler-SR1-win32-x86_64.zip">http://mirror.bit.edu.cn/eclipse/technology/epp/downloads/release/kepler/SR1/eclipse-cpp-kepler-SR1-win32-x86_64.zip</a></p>

<p>下载完成解压即可使用。见下图：
<img src="http://evoupsight.com/images/evoup/eclipse_dir.png" alt="Alt text" /></p>

<h3>三、安装SDK</h3>

<p>首先去下载SDK,这个是等等用来和eclipse的adt插件关联的。</p>

<p>  下载地址如下：
  <a href="http://dl.google.com/android/adt/adt-bundle-windows-x86_64-20131030.zip">http://dl.google.com/android/adt/adt-bundle-windows-x86_64-20131030.zip</a></p>

<p>下载完成后我把它解压到C:\android\adt-bundle-windows-x86_64-20131030,运行adt-bundle-windows-x86_64-20131030下的SDK Manager.exe，勾选几个必要的API版本，Android4.2.2(API17)还有Android2.2(API8)，然后点击Install 11 package开始安装</p>

<p><img src="http://evoupsight.com/images/evoup/adt_wait.png" alt="Alt text" /></p>

<p>如果速度慢，可以尝试用goagent代理进行加速,这里就提一下而以。</p>

<p><img src="http://evoupsight.com/images/evoup/adt_use_proxy.png" alt="Alt text" /></p>

<p>等待下载完成</p>

<p><img src="http://evoupsight.com/images/evoup/adt_done.png" alt="Alt text" /></p>

<h3>SDK配置</h3>

<p>接着把tools的路径C:\android\adt-bundle-windows-x86_64-20131030\sdk\tools追加到环境变量PATH中去。
要测试安装sdk是否成功，只需要运行cmd，然后输入</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>android -h
</span></code></pre></td></tr></table></div></figure>


<p>观察是否有输出正常信息，见下图：
<img src="http://evoupsight.com/images/evoup/adt_installed.png" alt="Alt text" /></p>

<p>有其他教程说要设置SDK Location变量，我配置时发现其实不需要，估计是老版本了。</p>

<h3>Eclipse的ADT Package安装</h3>

<p>打开Eclipse，指定好工程的位置</p>

<p><img src="http://evoupsight.com/images/evoup/adt_project_dir.png" alt="Alt text" /></p>

<p>选择 Help &lt; Install New Software 菜单。点击右上角的 Add 按钮，弹出 Add Repository 对话框，在 Name 一栏填写：“ADT Plugin”，在 Location 一栏填写：<a href="https://dl-ssl.google.com/android/eclipse/">https://dl-ssl.google.com/android/eclipse/</a></p>

<p>点击 OK。如果不能获取插件信息，就把 https 换成 http 试试。</p>

<p>然后整个勾选Developer Tools（最小安装的话至少要选择其下Android DDMS和Android Development Tools），点击Next，一路接受条款，等待安装插件完毕,中途可能出现安装警告，确认即可。</p>

<p><img src="http://evoupsight.com/images/evoup/eclipse_adt_warning.png" alt="Alt text" /></p>

<p>之后重启Eclipse。</p>

<h3>Eclipse的ADT插件的配置</h3>

<p>安装完ADT插件并重启好Eclipse后，点击 Window &lt; Preferences 菜单，点击左侧菜单中的 Android，再点击右侧 Browse&hellip;，选择第3步中Android SDK的安装目录，设置完成后，点击 OK。</p>

<p><img src="http://evoupsight.com/images/evoup/eclipse_adt_config.png" alt="Alt text" /></p>

<p>这样 Android 开发环境就搭建好了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[git clone失败警告unprotected private key file]]></title>
    <link href="http://evoupsight.com/blog/2014/01/16/git-clone-fail-cause-unprotected-private-key-file/"/>
    <updated>2014-01-16T23:41:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/01/16/git-clone-fail-cause-unprotected-private-key-file</id>
    <content type="html"><![CDATA[<h3>起因</h3>

<p>今天在clone项目的时候发生了很奇怪的错误，而且居然是有的项目可以clone，有的不行，都是git协议。错误如下：</p>

<!-- more -->


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>git clone git@github.com:someone/case.git
</span><span class='line'>Cloning into <span class="s1">&#39;case&#39;</span>...
</span><span class='line'>Warning: Permanently added the RSA host key <span class="k">for </span>IP address <span class="s1">&#39;192.30.252.129&#39;</span> to t
</span><span class='line'>he list of known hosts.
</span><span class='line'>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
</span><span class='line'>@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @
</span><span class='line'>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
</span><span class='line'>Permissions 0644 <span class="k">for</span> <span class="s1">&#39;/c/Users/Administrator/.ssh/id_rsa&#39;</span> are too open.
</span><span class='line'>It is recommended that your private key files are NOT accessible by others.
</span><span class='line'>This private key will be ignored.
</span><span class='line'>bad permissions: ignore key: /c/Users/Administrator/.ssh/id_rsa
</span><span class='line'>Permission denied <span class="o">(</span>publickey<span class="o">)</span>.
</span><span class='line'>fatal: Could not <span class="nb">read </span>from remote repository.
</span><span class='line'>
</span><span class='line'>Please make sure you have the correct access rights
</span><span class='line'>and the repository exists.
</span></code></pre></td></tr></table></div></figure>


<h3>排查</h3>

<p>显示是私钥权限不正确导致的，然后定位到git-bash所使用的sh.exe程序，用管理员模式运行</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>chmod 0600 /c/Users/Administrator/.ssh/id_rsa
</span></code></pre></td></tr></table></div></figure>


<p>尝试几次都没法收回group和other的r权限（r+w+rw=2<sup>2</sup>+2<sup>1</sup>+2<sup>0</sup>，我这里是4，2<sup>2</sup>所以是r）
最后发现是因为装git windows的时候选择了第一种方式和cygwin正好冲突了，如果装了cygwin的基础上再安装git windows要在git windows的安装选项里选第二种方式；还有一种可能是和tortoise git冲突了，尚未确认。
最后删除cygwin重装git-bash可以正常clone了。</p>

<h3>延伸</h3>

<p>git windows还有第三种安装方式，第三种比较危险，会覆盖windows指令，一般不采取，如果以后不打算用cygwin的话，直接第一种方式安装就可以了。</p>

<p>附：正常的权限掩码，来自一台freebsd</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>-rw-r--r--   authorized_keys
</span><span class='line'>-rw-------   config
</span><span class='line'>-rw-------   id_dsa
</span><span class='line'>-rw-------   id_dsa.pub
</span><span class='line'>-rw-------   id_rsa
</span><span class='line'>-rw-r--r--   id_rsa.pub
</span><span class='line'>-rw-------   known_hosts
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[cocos2d-x初心者阶段学习之一]]></title>
    <link href="http://evoupsight.com/blog/2014/01/14/cocos2d-x-v2.2-newbie-learning-note-1/"/>
    <updated>2014-01-14T14:24:00+08:00</updated>
    <id>http://evoupsight.com/blog/2014/01/14/cocos2d-x-v2.2-newbie-learning-note-1</id>
    <content type="html"><![CDATA[<h3>序言</h3>

<p>通过一个阶段的cocos2d-iphone的学习，对Objective-C（以下简称oc）做到基本了解，也有一个游戏小demo。但在摸索的过程中，发现这门语言稍让人感觉不爽的是oc里实例变量的绑定，除此之外oc基本上是一门比较优雅的语言。试水已经告捷，考虑到市面上大多采用cocos2d-x，还有cocostudio这一套的东西，应该是时候投入该框架的学习。</p>

<!-- more -->


<h5>本文参考</h5>

<p><a href="http://www.raywenderlich.com/33752/cocos2d-x-tutorial-for-ios-and-android-space-game">http://www.raywenderlich.com/33752/cocos2d-x-tutorial-for-ios-and-android-space-game</a></p>

<p>我这里不同的是在windows环境下编译win32项目，使用vc2010+cocos2d-x2.2.2开发，然后动手术加载一个飞船。</p>

<h3>加载精灵</h3>

<h4>准备工作</h4>

<p>首先需要把精灵对应的资源文件，也就是图片ccz和plist文件，这里是Sprites.plist和Sprites.pvr.ccz
然后创建出一个HelloWorld项目，然后进入vc2010后，双击HelloWorldScene.h进入加一个精灵。
可以看到有pvr.ccz文件，这是texturepacker产生的文件，这个先了解一下，就目前来说，只要知道是pvr.ccz是打包后的图片资源就可以了。
然后把资源拷贝到Resources文件夹里去，如果项目里没有，可以右键，新建筛选器，然后制定其名字为Resources。
（但是在项目管理器里无法看到，如何添加？TODO）</p>

<h4>添加代码</h4>

<p>在头文件中添加</p>

<figure class='code'><figcaption><span>HelloWorldScene.h </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="k">private</span><span class="o">:</span>
</span><span class='line'>  <span class="n">cocos2d</span><span class="o">::</span><span class="n">CCSpriteBatchNode</span> <span class="o">*</span> <span class="n">_batchNode</span><span class="p">;</span>
</span><span class='line'>  <span class="n">cocos2d</span><span class="o">::</span><span class="n">CCSprite</span> <span class="o">*</span> <span class="n">_ship</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>为什么需要2行代码？因为一个是批渲染对象，用来涵盖全部用到的资源，以及对应的区块坐标关系（补一句：具体的坐标可以通过用vim等文本编辑器查看plist文件得知，当然更专业的方式是采用接下来会提到的texturepacker这个工具直接查看和编辑）；另外一个是实际我们需要的精灵。</p>

<p>然后切换到源文件HelloWorldScene.cpp在init方法中添加如下代码：</p>

<figure class='code'><figcaption><span>HelloWorldScene.cpp </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="n">_batchNode</span> <span class="o">=</span> <span class="n">CCSpriteBatchNode</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;Sprites.pvr.ccz&quot;</span><span class="p">);</span>
</span><span class='line'><span class="k">this</span><span class="o">-&gt;</span><span class="n">addChild</span><span class="p">(</span><span class="n">_batchNode</span><span class="p">);</span>
</span><span class='line'><span class="n">CCSpriteFrameCache</span><span class="o">::</span><span class="n">sharedSpriteFrameCache</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">addSpriteFramesWithFile</span><span class="p">(</span><span class="s">&quot;Sprites.plist&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">_ship</span> <span class="o">=</span> <span class="n">CCSprite</span><span class="o">::</span><span class="n">createWithSpriteFrameName</span><span class="p">(</span><span class="s">&quot;SpaceFlier_sm_1.png&quot;</span><span class="p">);</span>
</span><span class='line'><span class="n">CCSize</span> <span class="n">winSize</span> <span class="o">=</span> <span class="n">CCDirector</span><span class="o">::</span><span class="n">sharedDirector</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getWinSize</span><span class="p">();</span>
</span><span class='line'><span class="n">_ship</span><span class="o">-&gt;</span><span class="n">setPosition</span><span class="p">(</span><span class="n">ccp</span><span class="p">(</span><span class="n">winSize</span><span class="p">.</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">winSize</span><span class="p">.</span><span class="n">height</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">));</span>
</span><span class='line'><span class="n">_batchNode</span><span class="o">-&gt;</span><span class="n">addChild</span><span class="p">(</span><span class="n">_ship</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>简单的分析</h4>

<p>按流程分析下吧，内存稍微提一下。
首先是获得一个CCSpriteBatchNode的批节点的指针，这一步其实已经把资源加载到了内存中了。
addChild把批节点加载到了类所指代的CCLayer层，需要注意this指针，在oc里就是self，指向的类是HelloWorld,继承自CCLayer。
接着，确定帧和帧缓冲的关系，通过用addSpriteFramesWithFile函数读取plist文件来实现。
然后调用CCSprite::createWithSpriteFrameName方法，通过阅读其方法的源代码，其实是在CCSpriteFrameCache中寻找FrameName，如果找到了就返回那个CCSprite，而在实际上精灵已经加载到了内存中了，方法的最后返回CCSprite指针，就是飞船精灵了。
只差一步，就可以显示飞船了，使用getWinSize获取屏幕分辨率。然后用setPosition设置飞船精灵的位置，最后用批节点的addChild把它显示出来，后面的参数1代表的是Z深度,数字越大显示在遮挡关系的越上部分。</p>

<h4>编译看结果</h4>

<p>可以看到，除了cocos2d-x默认GUI一个椰子头背景和右下角的关闭按钮之外，画面上还多了一艘太空飞船，目的达成。下篇学习如何移动和发射子弹。</p>

<p><img src="http://evoupsight.com/images/evoup/cocos2d-x_addsprite.png" alt="Alt text" /></p>

<h4>参考阅读</h4>

<p><a href="http://www.cocos2d-x.org/wiki/Chapter_2_-_How_to_Add_a_sprite">http://www.cocos2d-x.org/wiki/Chapter_2_-_How_to_Add_a_sprite</a></p>
]]></content>
  </entry>
  
</feed>
