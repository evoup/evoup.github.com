---
layout: post
title: "局域网计算机和vmware虚拟机互ping"
date: 2013-10-22 13:35
comments: true
categories:       [freebsd]
---

##情景描述
在公司的WIN7电脑上装了vmware进行服务端的开发，通过socket和client端进行通信。现在局域网中有若干台服务器安装了客户端要与vmware虚拟机上的server端进行通讯。由于不是处于一个网段，无法互相ping得地址，进而不能交互，以下为解决问题的过程笔录。
<!-- more -->

##我的环境
```
  ,____________________
  |                   |  ,''''''''''''''''''|   ,------------------Y
  |   gateway         |  |   gateway        |   |   gateway        |
  |                   |__|                  |   |                  |
      172.16.27.38    |  |  172.16.27.1     |   |  172.16.30.254   |
  |                   |  |                  |   |                  |
  `.................../  L__________________|   |__________________J
           |                                              |
           |                                              |
           |                                              |
           |                                              |
           |                                              |
           |                                              |
   ,_______|______                                        |
   |             |        ,''''''''''''''`.        ,'''''''''''''`.
   |             |        |               |        |              |
   | WIN7        |        |   freebsd8    |        |   freebsd9   |
   |             |        |               |        |              |
   | VMWARE Host |        | VMWARE client |        |              |
   |             |'''''''''               |        |              |
   |             |        |     server    |        |    client    |
   | 172.16.27.37|        |192.168.216.145|        |172.16.30.184 |
   |             |        |               |        |              |
   |             |        |               |        |              |
   |             |        |               |        |              |
   '`'''''''''''''        `---------------'        '`''''''''''''''
```
A）WIN7 vmware所在宿主机的网卡，地址为172.16.27.37/24(24代表子网掩码为255.255.255.0),默认网关172.16.27.38

B）freebsd8 服务器所在的vmware上原有一块NAT网卡em0，地址为192.168.216.145,一开始采用DHCP配置

C）freebsd9 客户端上只有一块网卡epair38b,地址为172.16.30.184,默认网关为172.16.30.254

记录：

##实现A和B互通
A到B，VMWARE直接就实现了。
B到A，需要添加一块bridge方式的网卡em0。使用sysinstall添加后，配置为172.16.27.59/24,默认网关172.16.27.38

##实现A和C互通
A到C，网络规划的时候直接就通了，不在同一网关，在win7的网卡属性TCP/IPv4属性的高级TCP/IP设置中，选IP设置选项卡，然后在默认网关中添加C所在的网关172.16.30.254
C到A，网络规划的时候指定了，/etc/resolv.conf中nameserver 172.16.27.1，另一个网关也直接能通到A，只需要打开WIN7的ping防火墙即可，可以google之。

##实现B和C互通
B到C，经过以上操作已经可以了。
C到B，同上。



